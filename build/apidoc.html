<div class="apidocDiv">
<style>
/*csslint
*/
.apidocDiv {
    background: #fff;
    font-family: Arial, Helvetica, sans-serif;
}
.apidocDiv a[href] {
    color: #33f;
    font-weight: bold;
    text-decoration: none;
}
.apidocDiv a[href]:hover {
    text-decoration: underline;
}
.apidocCodeCommentSpan {
    background: #bbf;
    color: #000;
    display: block;
}
.apidocCodeKeywordSpan {
    color: #d00;
    font-weight: bold;
}
.apidocCodePre {
    background: #eef;
    border: 1px solid;
    color: #777;
    padding: 5px;
    white-space: pre-wrap;
}
.apidocFooterDiv {
    margin-top: 20px;
    text-align: center;
}
.apidocModuleLi {
    margin-top: 10px;
}
.apidocSectionDiv {
    border-top: 1px solid;
    margin-top: 20px;
}
.apidocSignatureSpan {
    color: #777;
    font-weight: bold;
}
</style>
<h1>api documentation for
    <a

        href="http://ghost.org"

    >ghost (v0.11.8)</a>
</h1>
<h4>Just a blogging platform.</h4>
<div class="apidocSectionDiv"><a
    href="#apidoc.tableOfContents"
    id="apidoc.tableOfContents"
><h1>table of contents</h1></a><ol>

    <li class="apidocModuleLi"><a href="#apidoc.module.ghost">module ghost</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.ghost">
            function <span class="apidocSignatureSpan"></span>ghost
            <span class="apidocSignatureSpan">(options)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.GhostMailer">
            function <span class="apidocSignatureSpan">ghost.</span>GhostMailer
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.SchedulingDefault">
            function <span class="apidocSignatureSpan">ghost.</span>SchedulingDefault
            <span class="apidocSignatureSpan">(options)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.base">
            function <span class="apidocSignatureSpan">ghost.</span>base
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.dependencies">
            function <span class="apidocSignatureSpan">ghost.</span>dependencies
            <span class="apidocSignatureSpan">(appPath)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.ghost_server">
            function <span class="apidocSignatureSpan">ghost.</span>ghost_server
            <span class="apidocSignatureSpan">(rootApp)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.local_file_store">
            function <span class="apidocSignatureSpan">ghost.</span>local_file_store
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.page_url">
            function <span class="apidocSignatureSpan">ghost.</span>page_url
            <span class="apidocSignatureSpan">(page, options)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.permissions">
            function <span class="apidocSignatureSpan">ghost.</span>permissions
            <span class="apidocSignatureSpan">(appPath)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.read_themes">
            function <span class="apidocSignatureSpan">ghost.</span>read_themes
            <span class="apidocSignatureSpan">(dir)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.sandbox">
            function <span class="apidocSignatureSpan">ghost.</span>sandbox
            <span class="apidocSignatureSpan">(opts)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.update_check">
            function <span class="apidocSignatureSpan">ghost.</span>update_check
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">ghost.</span>GhostMailer.prototype</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">ghost.</span>SchedulingDefault.prototype</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">ghost.</span>accesstoken</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">ghost.</span>admin</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">ghost.</span>app</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">ghost.</span>app_field</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">ghost.</span>app_setting</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">ghost.</span>auth</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">ghost.</span>auth_strategies</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">ghost.</span>authentication</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">ghost.</span>base.prototype</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">ghost.</span>client</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">ghost.</span>client_trusted_domain</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">ghost.</span>clients</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">ghost.</span>configuration</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">ghost.</span>db</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">ghost.</span>dependencies.prototype</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">ghost.</span>effective</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">ghost.</span>filters</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">ghost.</span>ghost_server.prototype</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">ghost.</span>ghost_url</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">ghost.</span>gravatar</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">ghost.</span>i18n</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">ghost.</span>image_size_from_url</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">ghost.</span>labs</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">ghost.</span>loader</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">ghost.</span>local_file_store.prototype</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">ghost.</span>mail</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">ghost.</span>notifications</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">ghost.</span>oauth</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">ghost.</span>permission</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">ghost.</span>permissions.prototype</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">ghost.</span>post</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">ghost.</span>posts</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">ghost.</span>pretty_urls</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">ghost.</span>refreshtoken</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">ghost.</span>role</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">ghost.</span>roles</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">ghost.</span>sandbox.prototype</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">ghost.</span>schedules</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">ghost.</span>settings</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">ghost.</span>slack</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">ghost.</span>slugs</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">ghost.</span>social_urls</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">ghost.</span>spam_prevention</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">ghost.</span>startup_check</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">ghost.</span>subscriber</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">ghost.</span>subscribers</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">ghost.</span>tag</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">ghost.</span>tags</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">ghost.</span>template</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">ghost.</span>theme_handler</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">ghost.</span>themes</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">ghost.</span>upload</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">ghost.</span>url</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">ghost.</span>user</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">ghost.</span>users</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">ghost.</span>utils</span>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.ghost.GhostMailer">module ghost.GhostMailer</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.GhostMailer.GhostMailer">
            function <span class="apidocSignatureSpan">ghost.</span>GhostMailer
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.ghost.GhostMailer.prototype">module ghost.GhostMailer.prototype</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.GhostMailer.prototype.from">
            function <span class="apidocSignatureSpan">ghost.GhostMailer.prototype.</span>from
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.GhostMailer.prototype.getDomain">
            function <span class="apidocSignatureSpan">ghost.GhostMailer.prototype.</span>getDomain
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.GhostMailer.prototype.send">
            function <span class="apidocSignatureSpan">ghost.GhostMailer.prototype.</span>send
            <span class="apidocSignatureSpan">(message)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.ghost.SchedulingDefault">module ghost.SchedulingDefault</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.SchedulingDefault.SchedulingDefault">
            function <span class="apidocSignatureSpan">ghost.</span>SchedulingDefault
            <span class="apidocSignatureSpan">(options)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.SchedulingDefault.super_">
            function <span class="apidocSignatureSpan">ghost.SchedulingDefault.</span>super_
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.ghost.SchedulingDefault.prototype">module ghost.SchedulingDefault.prototype</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.SchedulingDefault.prototype._addJob">
            function <span class="apidocSignatureSpan">ghost.SchedulingDefault.prototype.</span>_addJob
            <span class="apidocSignatureSpan">(object)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.SchedulingDefault.prototype._deleteJob">
            function <span class="apidocSignatureSpan">ghost.SchedulingDefault.prototype.</span>_deleteJob
            <span class="apidocSignatureSpan">(object)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.SchedulingDefault.prototype._execute">
            function <span class="apidocSignatureSpan">ghost.SchedulingDefault.prototype.</span>_execute
            <span class="apidocSignatureSpan">(jobs)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.SchedulingDefault.prototype._pingUrl">
            function <span class="apidocSignatureSpan">ghost.SchedulingDefault.prototype.</span>_pingUrl
            <span class="apidocSignatureSpan">(object)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.SchedulingDefault.prototype.reschedule">
            function <span class="apidocSignatureSpan">ghost.SchedulingDefault.prototype.</span>reschedule
            <span class="apidocSignatureSpan">(object)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.SchedulingDefault.prototype.run">
            function <span class="apidocSignatureSpan">ghost.SchedulingDefault.prototype.</span>run
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.SchedulingDefault.prototype.schedule">
            function <span class="apidocSignatureSpan">ghost.SchedulingDefault.prototype.</span>schedule
            <span class="apidocSignatureSpan">(object)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.SchedulingDefault.prototype.unschedule">
            function <span class="apidocSignatureSpan">ghost.SchedulingDefault.prototype.</span>unschedule
            <span class="apidocSignatureSpan">(object)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.ghost.accesstoken">module ghost.accesstoken</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.accesstoken.Accesstoken">
            function <span class="apidocSignatureSpan">ghost.accesstoken.</span>Accesstoken
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.accesstoken.Accesstokens">
            function <span class="apidocSignatureSpan">ghost.accesstoken.</span>Accesstokens
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.ghost.admin">module ghost.admin</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.admin.index">
            function <span class="apidocSignatureSpan">ghost.admin.</span>index
            <span class="apidocSignatureSpan">(req, res)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.ghost.app">module ghost.app</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.app.App">
            function <span class="apidocSignatureSpan">ghost.app.</span>App
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.app.Apps">
            function <span class="apidocSignatureSpan">ghost.app.</span>Apps
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.ghost.app_field">module ghost.app_field</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.app_field.AppField">
            function <span class="apidocSignatureSpan">ghost.app_field.</span>AppField
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.app_field.AppFields">
            function <span class="apidocSignatureSpan">ghost.app_field.</span>AppFields
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.ghost.app_setting">module ghost.app_setting</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.app_setting.AppSetting">
            function <span class="apidocSignatureSpan">ghost.app_setting.</span>AppSetting
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.app_setting.AppSettings">
            function <span class="apidocSignatureSpan">ghost.app_setting.</span>AppSettings
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.ghost.auth">module ghost.auth</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.auth.authenticateClient">
            function <span class="apidocSignatureSpan">ghost.auth.</span>authenticateClient
            <span class="apidocSignatureSpan">(req, res, next)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.auth.authenticateUser">
            function <span class="apidocSignatureSpan">ghost.auth.</span>authenticateUser
            <span class="apidocSignatureSpan">(req, res, next)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.auth.requiresAuthorizedUser">
            function <span class="apidocSignatureSpan">ghost.auth.</span>requiresAuthorizedUser
            <span class="apidocSignatureSpan">(req, res, next)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.auth.requiresAuthorizedUserPublicAPI">
            function <span class="apidocSignatureSpan">ghost.auth.</span>requiresAuthorizedUserPublicAPI
            <span class="apidocSignatureSpan">(req, res, next)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.ghost.auth_strategies">module ghost.auth_strategies</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.auth_strategies.bearerStrategy">
            function <span class="apidocSignatureSpan">ghost.auth_strategies.</span>bearerStrategy
            <span class="apidocSignatureSpan">(accessToken, done)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.auth_strategies.clientPasswordStrategy">
            function <span class="apidocSignatureSpan">ghost.auth_strategies.</span>clientPasswordStrategy
            <span class="apidocSignatureSpan">(clientId, clientSecret, done)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.ghost.authentication">module ghost.authentication</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.authentication.acceptInvitation">
            function <span class="apidocSignatureSpan">ghost.authentication.</span>acceptInvitation
            <span class="apidocSignatureSpan">(invitation)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.authentication.generateResetToken">
            function <span class="apidocSignatureSpan">ghost.authentication.</span>generateResetToken
            <span class="apidocSignatureSpan">(resetRequest)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.authentication.isInvitation">
            function <span class="apidocSignatureSpan">ghost.authentication.</span>isInvitation
            <span class="apidocSignatureSpan">(options)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.authentication.isSetup">
            function <span class="apidocSignatureSpan">ghost.authentication.</span>isSetup
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.authentication.onSetupStep3">
            function <span class="apidocSignatureSpan">ghost.authentication.</span>onSetupStep3
            <span class="apidocSignatureSpan">(data)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.authentication.resetPassword">
            function <span class="apidocSignatureSpan">ghost.authentication.</span>resetPassword
            <span class="apidocSignatureSpan">(resetRequest)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.authentication.revoke">
            function <span class="apidocSignatureSpan">ghost.authentication.</span>revoke
            <span class="apidocSignatureSpan">(tokenDetails, options)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.authentication.setup">
            function <span class="apidocSignatureSpan">ghost.authentication.</span>setup
            <span class="apidocSignatureSpan">(setupDetails)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.authentication.updateSetup">
            function <span class="apidocSignatureSpan">ghost.authentication.</span>updateSetup
            <span class="apidocSignatureSpan">(setupDetails, options)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.ghost.base">module ghost.base</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.base.base">
            function <span class="apidocSignatureSpan">ghost.</span>base
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.ghost.base.prototype">module ghost.base.prototype</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.base.prototype.generateUnique">
            function <span class="apidocSignatureSpan">ghost.base.prototype.</span>generateUnique
            <span class="apidocSignatureSpan">(store, dir, name, ext, i)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.base.prototype.getSanitizedFileName">
            function <span class="apidocSignatureSpan">ghost.base.prototype.</span>getSanitizedFileName
            <span class="apidocSignatureSpan">(fileName)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.base.prototype.getTargetDir">
            function <span class="apidocSignatureSpan">ghost.base.prototype.</span>getTargetDir
            <span class="apidocSignatureSpan">(baseDir)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.base.prototype.getUniqueFileName">
            function <span class="apidocSignatureSpan">ghost.base.prototype.</span>getUniqueFileName
            <span class="apidocSignatureSpan">(store, image, targetDir)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.ghost.client">module ghost.client</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.client.Client">
            function <span class="apidocSignatureSpan">ghost.client.</span>Client
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.client.Clients">
            function <span class="apidocSignatureSpan">ghost.client.</span>Clients
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.ghost.client_trusted_domain">module ghost.client_trusted_domain</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.client_trusted_domain.ClientTrustedDomain">
            function <span class="apidocSignatureSpan">ghost.client_trusted_domain.</span>ClientTrustedDomain
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.client_trusted_domain.ClientTrustedDomains">
            function <span class="apidocSignatureSpan">ghost.client_trusted_domain.</span>ClientTrustedDomains
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.ghost.clients">module ghost.clients</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.clients.read">
            function <span class="apidocSignatureSpan">ghost.clients.</span>read
            <span class="apidocSignatureSpan">(options)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.ghost.configuration">module ghost.configuration</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.configuration.read">
            function <span class="apidocSignatureSpan">ghost.configuration.</span>read
            <span class="apidocSignatureSpan">(options)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.ghost.db">module ghost.db</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.db.deleteAllContent">
            function <span class="apidocSignatureSpan">ghost.db.</span>deleteAllContent
            <span class="apidocSignatureSpan">(options)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.db.exportContent">
            function <span class="apidocSignatureSpan">ghost.db.</span>exportContent
            <span class="apidocSignatureSpan">(options)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.db.importContent">
            function <span class="apidocSignatureSpan">ghost.db.</span>importContent
            <span class="apidocSignatureSpan">(options)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.ghost.dependencies">module ghost.dependencies</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.dependencies.dependencies">
            function <span class="apidocSignatureSpan">ghost.</span>dependencies
            <span class="apidocSignatureSpan">(appPath)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.ghost.dependencies.prototype">module ghost.dependencies.prototype</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.dependencies.prototype.install">
            function <span class="apidocSignatureSpan">ghost.dependencies.prototype.</span>install
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.dependencies.prototype.spawnCommand">
            function <span class="apidocSignatureSpan">ghost.dependencies.prototype.</span>spawnCommand
            <span class="apidocSignatureSpan">(command, args, opt)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.ghost.effective">module ghost.effective</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.effective.app">
            function <span class="apidocSignatureSpan">ghost.effective.</span>app
            <span class="apidocSignatureSpan">(appName)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.effective.user">
            function <span class="apidocSignatureSpan">ghost.effective.</span>user
            <span class="apidocSignatureSpan">(id)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.ghost.filters">module ghost.filters</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.filters.Filters">
            function <span class="apidocSignatureSpan">ghost.filters.</span>Filters
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">ghost.</span>filters</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">ghost.filters.</span>filterCallbacks</span>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.ghost.ghost_server">module ghost.ghost_server</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.ghost_server.ghost_server">
            function <span class="apidocSignatureSpan">ghost.</span>ghost_server
            <span class="apidocSignatureSpan">(rootApp)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.ghost.ghost_server.prototype">module ghost.ghost_server.prototype</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.ghost_server.prototype.closeConnections">
            function <span class="apidocSignatureSpan">ghost.ghost_server.prototype.</span>closeConnections
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.ghost_server.prototype.connection">
            function <span class="apidocSignatureSpan">ghost.ghost_server.prototype.</span>connection
            <span class="apidocSignatureSpan">(socket)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.ghost_server.prototype.hammertime">
            function <span class="apidocSignatureSpan">ghost.ghost_server.prototype.</span>hammertime
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.ghost_server.prototype.logShutdownMessages">
            function <span class="apidocSignatureSpan">ghost.ghost_server.prototype.</span>logShutdownMessages
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.ghost_server.prototype.logStartMessages">
            function <span class="apidocSignatureSpan">ghost.ghost_server.prototype.</span>logStartMessages
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.ghost_server.prototype.restart">
            function <span class="apidocSignatureSpan">ghost.ghost_server.prototype.</span>restart
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.ghost_server.prototype.start">
            function <span class="apidocSignatureSpan">ghost.ghost_server.prototype.</span>start
            <span class="apidocSignatureSpan">(externalApp)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.ghost_server.prototype.stop">
            function <span class="apidocSignatureSpan">ghost.ghost_server.prototype.</span>stop
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.ghost.ghost_url">module ghost.ghost_url</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.ghost_url.init">
            function <span class="apidocSignatureSpan">ghost.ghost_url.</span>init
            <span class="apidocSignatureSpan">(options)</span>
            </a>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">ghost.ghost_url.</span>url</span>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.ghost.gravatar">module ghost.gravatar</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.gravatar.lookup">
            function <span class="apidocSignatureSpan">ghost.gravatar.</span>lookup
            <span class="apidocSignatureSpan">(userData, timeout)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.ghost.i18n">module ghost.i18n</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.i18n.findString">
            function <span class="apidocSignatureSpan">ghost.i18n.</span>findString
            <span class="apidocSignatureSpan">(msgPath)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.i18n.init">
            function <span class="apidocSignatureSpan">ghost.i18n.</span>init
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.i18n.t">
            function <span class="apidocSignatureSpan">ghost.i18n.</span>t
            <span class="apidocSignatureSpan">(path, bindings)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.ghost.image_size_from_url">module ghost.image_size_from_url</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.image_size_from_url.getImageSizeFromUrl">
            function <span class="apidocSignatureSpan">ghost.image_size_from_url.</span>getImageSizeFromUrl
            <span class="apidocSignatureSpan">(imagePath)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.ghost.labs">module ghost.labs</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.labs.subscribers">
            function <span class="apidocSignatureSpan">ghost.labs.</span>subscribers
            <span class="apidocSignatureSpan">(req, res, next)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.ghost.loader">module ghost.loader</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.loader.activateAppByName">
            function <span class="apidocSignatureSpan">ghost.loader.</span>activateAppByName
            <span class="apidocSignatureSpan">(name)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.loader.installAppByName">
            function <span class="apidocSignatureSpan">ghost.loader.</span>installAppByName
            <span class="apidocSignatureSpan">(name)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.ghost.local_file_store">module ghost.local_file_store</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.local_file_store.local_file_store">
            function <span class="apidocSignatureSpan">ghost.</span>local_file_store
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.local_file_store.super_">
            function <span class="apidocSignatureSpan">ghost.local_file_store.</span>super_
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.ghost.local_file_store.prototype">module ghost.local_file_store.prototype</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.local_file_store.prototype.delete">
            function <span class="apidocSignatureSpan">ghost.local_file_store.prototype.</span>delete
            <span class="apidocSignatureSpan">(fileName, targetDir)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.local_file_store.prototype.exists">
            function <span class="apidocSignatureSpan">ghost.local_file_store.prototype.</span>exists
            <span class="apidocSignatureSpan">(filename)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.local_file_store.prototype.save">
            function <span class="apidocSignatureSpan">ghost.local_file_store.prototype.</span>save
            <span class="apidocSignatureSpan">(image, targetDir)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.local_file_store.prototype.serve">
            function <span class="apidocSignatureSpan">ghost.local_file_store.prototype.</span>serve
            <span class="apidocSignatureSpan">(options)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.ghost.mail">module ghost.mail</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.mail.send">
            function <span class="apidocSignatureSpan">ghost.mail.</span>send
            <span class="apidocSignatureSpan">(object, options)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.mail.sendTest">
            function <span class="apidocSignatureSpan">ghost.mail.</span>sendTest
            <span class="apidocSignatureSpan">(options)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.ghost.notifications">module ghost.notifications</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.notifications.add">
            function <span class="apidocSignatureSpan">ghost.notifications.</span>add
            <span class="apidocSignatureSpan">(object, options)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.notifications.browse">
            function <span class="apidocSignatureSpan">ghost.notifications.</span>browse
            <span class="apidocSignatureSpan">(options)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.notifications.destroy">
            function <span class="apidocSignatureSpan">ghost.notifications.</span>destroy
            <span class="apidocSignatureSpan">(options)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.notifications.destroyAll">
            function <span class="apidocSignatureSpan">ghost.notifications.</span>destroyAll
            <span class="apidocSignatureSpan">(options)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.ghost.oauth">module ghost.oauth</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.oauth.generateAccessToken">
            function <span class="apidocSignatureSpan">ghost.oauth.</span>generateAccessToken
            <span class="apidocSignatureSpan">(req, res, next)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.oauth.init">
            function <span class="apidocSignatureSpan">ghost.oauth.</span>init
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.ghost.page_url">module ghost.page_url</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.page_url.page_url">
            function <span class="apidocSignatureSpan">ghost.</span>page_url
            <span class="apidocSignatureSpan">(page, options)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.page_url.deprecated">
            function <span class="apidocSignatureSpan">ghost.page_url.</span>deprecated
            <span class="apidocSignatureSpan">(pageNum, options)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.ghost.permission">module ghost.permission</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.permission.Permission">
            function <span class="apidocSignatureSpan">ghost.permission.</span>Permission
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.permission.Permissions">
            function <span class="apidocSignatureSpan">ghost.permission.</span>Permissions
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.ghost.permissions">module ghost.permissions</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.permissions.permissions">
            function <span class="apidocSignatureSpan">ghost.</span>permissions
            <span class="apidocSignatureSpan">(appPath)</span>
            </a>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">ghost.permissions.</span>DefaultPermissions</span>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.ghost.permissions.prototype">module ghost.permissions.prototype</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.permissions.prototype.checkPackageContentsExists">
            function <span class="apidocSignatureSpan">ghost.permissions.prototype.</span>checkPackageContentsExists
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.permissions.prototype.getPackageContents">
            function <span class="apidocSignatureSpan">ghost.permissions.prototype.</span>getPackageContents
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.permissions.prototype.read">
            function <span class="apidocSignatureSpan">ghost.permissions.prototype.</span>read
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.ghost.post">module ghost.post</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.post.Post">
            function <span class="apidocSignatureSpan">ghost.post.</span>Post
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.post.Posts">
            function <span class="apidocSignatureSpan">ghost.post.</span>Posts
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.ghost.posts">module ghost.posts</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.posts.add">
            function <span class="apidocSignatureSpan">ghost.posts.</span>add
            <span class="apidocSignatureSpan">(object, options)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.posts.browse">
            function <span class="apidocSignatureSpan">ghost.posts.</span>browse
            <span class="apidocSignatureSpan">(options)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.posts.destroy">
            function <span class="apidocSignatureSpan">ghost.posts.</span>destroy
            <span class="apidocSignatureSpan">(options)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.posts.edit">
            function <span class="apidocSignatureSpan">ghost.posts.</span>edit
            <span class="apidocSignatureSpan">(object, options)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.posts.read">
            function <span class="apidocSignatureSpan">ghost.posts.</span>read
            <span class="apidocSignatureSpan">(options)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.ghost.pretty_urls">module ghost.pretty_urls</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.pretty_urls.0">
            function <span class="apidocSignatureSpan">ghost.pretty_urls.</span>0
            <span class="apidocSignatureSpan">( req, res, next )</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.pretty_urls.1">
            function <span class="apidocSignatureSpan">ghost.pretty_urls.</span>1
            <span class="apidocSignatureSpan">(req, res, next)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.ghost.read_themes">module ghost.read_themes</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.read_themes.read_themes">
            function <span class="apidocSignatureSpan">ghost.</span>read_themes
            <span class="apidocSignatureSpan">(dir)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.read_themes.active">
            function <span class="apidocSignatureSpan">ghost.read_themes.</span>active
            <span class="apidocSignatureSpan">(dir, name)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.ghost.refreshtoken">module ghost.refreshtoken</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.refreshtoken.Refreshtoken">
            function <span class="apidocSignatureSpan">ghost.refreshtoken.</span>Refreshtoken
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.refreshtoken.Refreshtokens">
            function <span class="apidocSignatureSpan">ghost.refreshtoken.</span>Refreshtokens
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.ghost.role">module ghost.role</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.role.Role">
            function <span class="apidocSignatureSpan">ghost.role.</span>Role
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.role.Roles">
            function <span class="apidocSignatureSpan">ghost.role.</span>Roles
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.ghost.roles">module ghost.roles</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.roles.browse">
            function <span class="apidocSignatureSpan">ghost.roles.</span>browse
            <span class="apidocSignatureSpan">(options)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.ghost.sandbox">module ghost.sandbox</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.sandbox.sandbox">
            function <span class="apidocSignatureSpan">ghost.</span>sandbox
            <span class="apidocSignatureSpan">(opts)</span>
            </a>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">ghost.sandbox.</span>defaults</span>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.ghost.sandbox.prototype">module ghost.sandbox.prototype</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.sandbox.prototype.loadApp">
            function <span class="apidocSignatureSpan">ghost.sandbox.prototype.</span>loadApp
            <span class="apidocSignatureSpan">(appPath)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.sandbox.prototype.loadModule">
            function <span class="apidocSignatureSpan">ghost.sandbox.prototype.</span>loadModule
            <span class="apidocSignatureSpan">(modulePath)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.ghost.schedules">module ghost.schedules</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.schedules.getScheduledPosts">
            function <span class="apidocSignatureSpan">ghost.schedules.</span>getScheduledPosts
            <span class="apidocSignatureSpan">(options)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.schedules.publishPost">
            function <span class="apidocSignatureSpan">ghost.schedules.</span>publishPost
            <span class="apidocSignatureSpan">(object, options)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.ghost.settings">module ghost.settings</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.settings.browse">
            function <span class="apidocSignatureSpan">ghost.settings.</span>browse
            <span class="apidocSignatureSpan">(options)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.settings.edit">
            function <span class="apidocSignatureSpan">ghost.settings.</span>edit
            <span class="apidocSignatureSpan">(object, options)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.settings.read">
            function <span class="apidocSignatureSpan">ghost.settings.</span>read
            <span class="apidocSignatureSpan">(options)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.settings.updateSettingsCache">
            function <span class="apidocSignatureSpan">ghost.settings.</span>updateSettingsCache
            <span class="apidocSignatureSpan">(settings, options)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.ghost.slack">module ghost.slack</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.slack.sendTest">
            function <span class="apidocSignatureSpan">ghost.slack.</span>sendTest
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.ghost.slugs">module ghost.slugs</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.slugs.generate">
            function <span class="apidocSignatureSpan">ghost.slugs.</span>generate
            <span class="apidocSignatureSpan">(options)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.ghost.social_urls">module ghost.social_urls</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.social_urls.facebookUrl">
            function <span class="apidocSignatureSpan">ghost.social_urls.</span>facebookUrl
            <span class="apidocSignatureSpan">(username)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.social_urls.twitterUrl">
            function <span class="apidocSignatureSpan">ghost.social_urls.</span>twitterUrl
            <span class="apidocSignatureSpan">(username)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.ghost.spam_prevention">module ghost.spam_prevention</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.spam_prevention.forgotten">
            function <span class="apidocSignatureSpan">ghost.spam_prevention.</span>forgotten
            <span class="apidocSignatureSpan">(req, res, next)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.spam_prevention.resetCounter">
            function <span class="apidocSignatureSpan">ghost.spam_prevention.</span>resetCounter
            <span class="apidocSignatureSpan">(email)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.spam_prevention.signin">
            function <span class="apidocSignatureSpan">ghost.spam_prevention.</span>signin
            <span class="apidocSignatureSpan">(req, res, next)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.ghost.startup_check">module ghost.startup_check</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.startup_check.builtFilesExist">
            function <span class="apidocSignatureSpan">ghost.startup_check.</span>builtFilesExist
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.startup_check.check">
            function <span class="apidocSignatureSpan">ghost.startup_check.</span>check
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.startup_check.contentPath">
            function <span class="apidocSignatureSpan">ghost.startup_check.</span>contentPath
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.startup_check.mail">
            function <span class="apidocSignatureSpan">ghost.startup_check.</span>mail
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.startup_check.nodeEnv">
            function <span class="apidocSignatureSpan">ghost.startup_check.</span>nodeEnv
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.startup_check.nodeVersion">
            function <span class="apidocSignatureSpan">ghost.startup_check.</span>nodeVersion
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.startup_check.packages">
            function <span class="apidocSignatureSpan">ghost.startup_check.</span>packages
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.startup_check.sqlite">
            function <span class="apidocSignatureSpan">ghost.startup_check.</span>sqlite
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.ghost.subscriber">module ghost.subscriber</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.subscriber.Subscriber">
            function <span class="apidocSignatureSpan">ghost.subscriber.</span>Subscriber
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.subscriber.Subscribers">
            function <span class="apidocSignatureSpan">ghost.subscriber.</span>Subscribers
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.ghost.subscribers">module ghost.subscribers</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.subscribers.add">
            function <span class="apidocSignatureSpan">ghost.subscribers.</span>add
            <span class="apidocSignatureSpan">(object, options)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.subscribers.browse">
            function <span class="apidocSignatureSpan">ghost.subscribers.</span>browse
            <span class="apidocSignatureSpan">(options)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.subscribers.destroy">
            function <span class="apidocSignatureSpan">ghost.subscribers.</span>destroy
            <span class="apidocSignatureSpan">(options)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.subscribers.edit">
            function <span class="apidocSignatureSpan">ghost.subscribers.</span>edit
            <span class="apidocSignatureSpan">(object, options)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.subscribers.exportCSV">
            function <span class="apidocSignatureSpan">ghost.subscribers.</span>exportCSV
            <span class="apidocSignatureSpan">(options)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.subscribers.importCSV">
            function <span class="apidocSignatureSpan">ghost.subscribers.</span>importCSV
            <span class="apidocSignatureSpan">(options)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.subscribers.read">
            function <span class="apidocSignatureSpan">ghost.subscribers.</span>read
            <span class="apidocSignatureSpan">(options)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.ghost.tag">module ghost.tag</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.tag.Tag">
            function <span class="apidocSignatureSpan">ghost.tag.</span>Tag
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.tag.Tags">
            function <span class="apidocSignatureSpan">ghost.tag.</span>Tags
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.ghost.tags">module ghost.tags</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.tags.add">
            function <span class="apidocSignatureSpan">ghost.tags.</span>add
            <span class="apidocSignatureSpan">(object, options)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.tags.browse">
            function <span class="apidocSignatureSpan">ghost.tags.</span>browse
            <span class="apidocSignatureSpan">(options)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.tags.destroy">
            function <span class="apidocSignatureSpan">ghost.tags.</span>destroy
            <span class="apidocSignatureSpan">(options)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.tags.edit">
            function <span class="apidocSignatureSpan">ghost.tags.</span>edit
            <span class="apidocSignatureSpan">(object, options)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.tags.read">
            function <span class="apidocSignatureSpan">ghost.tags.</span>read
            <span class="apidocSignatureSpan">(options)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.ghost.template">module ghost.template</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.template.execute">
            function <span class="apidocSignatureSpan">ghost.template.</span>execute
            <span class="apidocSignatureSpan">(name, context, options)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.ghost.theme_handler">module ghost.theme_handler</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.theme_handler.activateTheme">
            function <span class="apidocSignatureSpan">ghost.theme_handler.</span>activateTheme
            <span class="apidocSignatureSpan">(blogApp, activeTheme)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.theme_handler.configHbsForContext">
            function <span class="apidocSignatureSpan">ghost.theme_handler.</span>configHbsForContext
            <span class="apidocSignatureSpan">(req, res, next)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.theme_handler.ghostLocals">
            function <span class="apidocSignatureSpan">ghost.theme_handler.</span>ghostLocals
            <span class="apidocSignatureSpan">(req, res, next)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.theme_handler.updateActiveTheme">
            function <span class="apidocSignatureSpan">ghost.theme_handler.</span>updateActiveTheme
            <span class="apidocSignatureSpan">(req, res, next)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.ghost.themes">module ghost.themes</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.themes.destroy">
            function <span class="apidocSignatureSpan">ghost.themes.</span>destroy
            <span class="apidocSignatureSpan">(options)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.themes.download">
            function <span class="apidocSignatureSpan">ghost.themes.</span>download
            <span class="apidocSignatureSpan">(options)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.themes.upload">
            function <span class="apidocSignatureSpan">ghost.themes.</span>upload
            <span class="apidocSignatureSpan">(options)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.ghost.update_check">module ghost.update_check</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.update_check.update_check">
            function <span class="apidocSignatureSpan">ghost.</span>update_check
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.update_check.showUpdateNotification">
            function <span class="apidocSignatureSpan">ghost.update_check.</span>showUpdateNotification
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.ghost.upload">module ghost.upload</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.upload.add">
            function <span class="apidocSignatureSpan">ghost.upload.</span>add
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.ghost.url">module ghost.url</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.url.apiUrl">
            function <span class="apidocSignatureSpan">ghost.url.</span>apiUrl
            <span class="apidocSignatureSpan">(options)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.url.getBaseUrl">
            function <span class="apidocSignatureSpan">ghost.url.</span>getBaseUrl
            <span class="apidocSignatureSpan">(secure)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.url.setConfig">
            function <span class="apidocSignatureSpan">ghost.url.</span>setConfig
            <span class="apidocSignatureSpan">(config)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.url.urlFor">
            function <span class="apidocSignatureSpan">ghost.url.</span>urlFor
            <span class="apidocSignatureSpan">(context, data, absolute)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.url.urlJoin">
            function <span class="apidocSignatureSpan">ghost.url.</span>urlJoin
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.url.urlPathForPost">
            function <span class="apidocSignatureSpan">ghost.url.</span>urlPathForPost
            <span class="apidocSignatureSpan">(post)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.ghost.user">module ghost.user</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.user.User">
            function <span class="apidocSignatureSpan">ghost.user.</span>User
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.user.Users">
            function <span class="apidocSignatureSpan">ghost.user.</span>Users
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.ghost.users">module ghost.users</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.users.add">
            function <span class="apidocSignatureSpan">ghost.users.</span>add
            <span class="apidocSignatureSpan">(object, options)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.users.browse">
            function <span class="apidocSignatureSpan">ghost.users.</span>browse
            <span class="apidocSignatureSpan">(options)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.users.changePassword">
            function <span class="apidocSignatureSpan">ghost.users.</span>changePassword
            <span class="apidocSignatureSpan">(object, options)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.users.destroy">
            function <span class="apidocSignatureSpan">ghost.users.</span>destroy
            <span class="apidocSignatureSpan">(options)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.users.edit">
            function <span class="apidocSignatureSpan">ghost.users.</span>edit
            <span class="apidocSignatureSpan">(object, options)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.users.read">
            function <span class="apidocSignatureSpan">ghost.users.</span>read
            <span class="apidocSignatureSpan">(options)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.users.transferOwnership">
            function <span class="apidocSignatureSpan">ghost.users.</span>transferOwnership
            <span class="apidocSignatureSpan">(object, options)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.ghost.utils">module ghost.utils</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.utils.applyPublicPermissions">
            function <span class="apidocSignatureSpan">ghost.utils.</span>applyPublicPermissions
            <span class="apidocSignatureSpan">(docName, method, options)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.utils.checkFileExists">
            function <span class="apidocSignatureSpan">ghost.utils.</span>checkFileExists
            <span class="apidocSignatureSpan">(fileData)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.utils.checkFileIsValid">
            function <span class="apidocSignatureSpan">ghost.utils.</span>checkFileIsValid
            <span class="apidocSignatureSpan">(fileData, types, extensions)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.utils.checkObject">
            function <span class="apidocSignatureSpan">ghost.utils.</span>checkObject
            <span class="apidocSignatureSpan">(object, docName, editId)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.utils.convertOptions">
            function <span class="apidocSignatureSpan">ghost.utils.</span>convertOptions
            <span class="apidocSignatureSpan">(allowedIncludes)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.utils.detectPublicContext">
            function <span class="apidocSignatureSpan">ghost.utils.</span>detectPublicContext
            <span class="apidocSignatureSpan">(options)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.utils.handlePermissions">
            function <span class="apidocSignatureSpan">ghost.utils.</span>handlePermissions
            <span class="apidocSignatureSpan">(docName, method)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.utils.handlePublicPermissions">
            function <span class="apidocSignatureSpan">ghost.utils.</span>handlePublicPermissions
            <span class="apidocSignatureSpan">(docName, method)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.utils.prepareFields">
            function <span class="apidocSignatureSpan">ghost.utils.</span>prepareFields
            <span class="apidocSignatureSpan">(fields)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.utils.prepareInclude">
            function <span class="apidocSignatureSpan">ghost.utils.</span>prepareInclude
            <span class="apidocSignatureSpan">(include, allowedIncludes)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.utils.trimAndLowerCase">
            function <span class="apidocSignatureSpan">ghost.utils.</span>trimAndLowerCase
            <span class="apidocSignatureSpan">(params)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.utils.validate">
            function <span class="apidocSignatureSpan">ghost.utils.</span>validate
            <span class="apidocSignatureSpan">(docName, extras)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ghost.utils.validateOptions">
            function <span class="apidocSignatureSpan">ghost.utils.</span>validateOptions
            <span class="apidocSignatureSpan">(options)</span>
            </a>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">ghost.utils.</span>browseDefaultOptions</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">ghost.utils.</span>dataDefaultOptions</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">ghost.utils.</span>globalDefaultOptions</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">ghost.utils.</span>idDefaultOptions</span>

        </li>

    </ol></li>

</ol></div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.ghost" id="apidoc.module.ghost">module ghost</a></h1>


    <h2>
        <a href="#apidoc.element.ghost.ghost" id="apidoc.element.ghost.ghost">
        function <span class="apidocSignatureSpan"></span>ghost
        <span class="apidocSignatureSpan">(options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function makeGhost(options) {
    options = options || {};

    return server(options);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ghost.GhostMailer" id="apidoc.element.ghost.GhostMailer">
        function <span class="apidocSignatureSpan">ghost.</span>GhostMailer
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function GhostMailer() {
    var transport = config.mail &#x26;&#x26; config.mail.transport || &#x27;direct&#x27;,
        options = config.mail &#x26;&#x26; _.clone(config.mail.options) || {};

    this.state = {};

    this.transport = nodemailer.createTransport(transport, options);

    this.state.usingDirect = transport === &#x27;direct&#x27;;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
apiMail;

/**
 * Send mail helper
 */
function sendMail(object) {
if (!(mailer instanceof mail.GhostMailer) || testing) {
    mailer = new mail.<span class="apidocCodeKeywordSpan">GhostMailer</span>();
}

return mailer.send(object.mail[0].message).catch(function (err) {
    if (mailer.state.usingDirect) {
        notifications.add(
            {notifications: [{
                type: &#x27;warn&#x27;,
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ghost.SchedulingDefault" id="apidoc.element.ghost.SchedulingDefault">
        function <span class="apidocSignatureSpan">ghost.</span>SchedulingDefault
        <span class="apidocSignatureSpan">(options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function SchedulingDefault(options) {
    SchedulingBase.call(this, options);

    this.runTimeoutInMs = 1000 * 60 * 5;
    this.offsetInMinutes = 10;
    this.beforePingInMs = -50;
    this.retryTimeoutInMs = 1000 * 5;

    this.allJobs = {};
    this.deletedJobs = {};
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ghost.base" id="apidoc.element.ghost.base">
        function <span class="apidocSignatureSpan">ghost.</span>base
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function StorageBase() {
    Object.defineProperty(this, &#x27;requiredFns&#x27;, {
        value: [&#x27;exists&#x27;, &#x27;save&#x27;, &#x27;serve&#x27;, &#x27;delete&#x27;],
        writable: false
    });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ghost.dependencies" id="apidoc.element.ghost.dependencies">
        function <span class="apidocSignatureSpan">ghost.</span>dependencies
        <span class="apidocSignatureSpan">(appPath)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function AppDependencies(appPath) {
    this.appPath = appPath;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ghost.ghost_server" id="apidoc.element.ghost.ghost_server">
        function <span class="apidocSignatureSpan">ghost.</span>ghost_server
        <span class="apidocSignatureSpan">(rootApp)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function GhostServer(rootApp) {
    this.rootApp = rootApp;
    this.httpServer = null;
    this.connections = {};
    this.connectionId = 0;

    // Expose config module for use externally.
    this.config = config;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ghost.local_file_store" id="apidoc.element.ghost.local_file_store">
        function <span class="apidocSignatureSpan">ghost.</span>local_file_store
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function LocalFileStore() {
    BaseStore.call(this);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ghost.page_url" id="apidoc.element.ghost.page_url">
        function <span class="apidocSignatureSpan">ghost.</span>page_url
        <span class="apidocSignatureSpan">(page, options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">page_url = function (page, options) {
    if (!options) {
        options = page;
        page = 1;
    }
    return getPaginatedUrl(page, options.data.root);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ghost.permissions" id="apidoc.element.ghost.permissions">
        function <span class="apidocSignatureSpan">ghost.</span>permissions
        <span class="apidocSignatureSpan">(appPath)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function AppPermissions(appPath) {
    this.appPath = appPath;
    this.packagePath = path.join(this.appPath, &#x27;package.json&#x27;);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ghost.read_themes" id="apidoc.element.ghost.read_themes">
        function <span class="apidocSignatureSpan">ghost.</span>read_themes
        <span class="apidocSignatureSpan">(dir)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function readThemes(dir) {
    return packages
        .read.all(dir)
        .then(populateTemplates);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ghost.sandbox" id="apidoc.element.ghost.sandbox">
        function <span class="apidocSignatureSpan">ghost.</span>sandbox
        <span class="apidocSignatureSpan">(opts)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function AppSandbox(opts) {
    this.opts = _.defaults(opts || {}, AppSandbox.defaults);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ghost.update_check" id="apidoc.element.ghost.update_check">
        function <span class="apidocSignatureSpan">ghost.</span>update_check
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function updateCheck() {
    // The check will not happen if:
    // 1. updateCheck is defined as false in config.js
    // 2. we&#x27;ve already done a check this session
    // 3. we&#x27;re not in production or development mode
    // TODO: need to remove config.updateCheck in favor of config.privacy.updateCheck in future version (it is now deprecated)
    if (config.updateCheck === false || config.isPrivacyDisabled(&#x27;useUpdateCheck&#x27;) || _.indexOf(allowedCheckEnvironments, process
.env.NODE_ENV) === -1) {
        // No update check
        return Promise.resolve();
    } else {
        return api.settings.read(_.extend({key: &#x27;nextUpdateCheck&#x27;}, internal)).then(function then(result) {
            var nextUpdateCheck = result.settings[0];

            if (nextUpdateCheck &#x26;&#x26; nextUpdateCheck.value &#x26;&#x26; nextUpdateCheck.value &#x3e; moment().unix()) {
                // It&#x27;s not time to check yet
                return;
            } else {
                // We need to do a check
                return updateCheckRequest()
                    .then(updateCheckResponse)
                    .catch(updateCheckError);
            }
        }).catch(updateCheckError);
    }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>






















































































































</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.ghost.GhostMailer" id="apidoc.module.ghost.GhostMailer">module ghost.GhostMailer</a></h1>


    <h2>
        <a href="#apidoc.element.ghost.GhostMailer.GhostMailer" id="apidoc.element.ghost.GhostMailer.GhostMailer">
        function <span class="apidocSignatureSpan">ghost.</span>GhostMailer
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function GhostMailer() {
    var transport = config.mail &#x26;&#x26; config.mail.transport || &#x27;direct&#x27;,
        options = config.mail &#x26;&#x26; _.clone(config.mail.options) || {};

    this.state = {};

    this.transport = nodemailer.createTransport(transport, options);

    this.state.usingDirect = transport === &#x27;direct&#x27;;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
apiMail;

/**
 * Send mail helper
 */
function sendMail(object) {
if (!(mailer instanceof mail.GhostMailer) || testing) {
    mailer = new mail.<span class="apidocCodeKeywordSpan">GhostMailer</span>();
}

return mailer.send(object.mail[0].message).catch(function (err) {
    if (mailer.state.usingDirect) {
        notifications.add(
            {notifications: [{
                type: &#x27;warn&#x27;,
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.ghost.GhostMailer.prototype" id="apidoc.module.ghost.GhostMailer.prototype">module ghost.GhostMailer.prototype</a></h1>


    <h2>
        <a href="#apidoc.element.ghost.GhostMailer.prototype.from" id="apidoc.element.ghost.GhostMailer.prototype.from">
        function <span class="apidocSignatureSpan">ghost.GhostMailer.prototype.</span>from
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">from = function () {
    var from = config.mail &#x26;&#x26; (config.mail.from || config.mail.fromaddress),
        defaultBlogTitle;

    // If we don&#x27;t have a from address at all
    if (!from) {
        // Default to ghost@[blog.url]
        from = &#x27;ghost@&#x27; + this.getDomain();
    }

    // If we do have a from address, and it&#x27;s just an email
    if (validator.isEmail(from)) {
        defaultBlogTitle = config.theme.title ? config.theme.title : i18n.t(&#x27;common.mail.title&#x27;, {domain: this.getDomain()});

        from = &#x27;&#x22;&#x27; + defaultBlogTitle + &#x27;&#x22; &#x3c;&#x27; + from + &#x27;&#x3e;&#x27;;
    }

    return from;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    date = date === null ? undefined : date;

    var f = options.hash.format || &#x27;MMM DD, YYYY&#x27;,
        timeago = options.hash.timeago,
        timeNow = moment().tz(timezone);

    if (timeago) {
        date = timezone ?  moment(date).tz(timezone).<span class="apidocCodeKeywordSpan">from</span>(timeNow) : moment(date).fromNow
();
    } else {
        date = timezone ? moment(date).tz(timezone).format(f) : moment(date).format(f);
    }

    return date;
};
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ghost.GhostMailer.prototype.getDomain" id="apidoc.element.ghost.GhostMailer.prototype.getDomain">
        function <span class="apidocSignatureSpan">ghost.GhostMailer.prototype.</span>getDomain
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">getDomain = function () {
    var domain = config.url.match(new RegExp(&#x27;^https?://([^/:?#]+)(?:[/:?#]|$)&#x27;, &#x27;i&#x27;));
    return domain &#x26;&#x26; domain[1];
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
GhostMailer.prototype.from = function () {
    var from = config.mail &#x26;&#x26; (config.mail.from || config.mail.fromaddress),
defaultBlogTitle;

    // If we don&#x27;t have a from address at all
    if (!from) {
// Default to ghost@[blog.url]
from = &#x27;ghost@&#x27; + this.<span class="apidocCodeKeywordSpan">getDomain</span>();
    }

    // If we do have a from address, and it&#x27;s just an email
    if (validator.isEmail(from)) {
defaultBlogTitle = config.theme.title ? config.theme.title : i18n.t(&#x27;common.mail.title&#x27;, {domain: this.getDomain()});

from = &#x27;&#x22;&#x27; + defaultBlogTitle + &#x27;&#x22; &#x3c;&#x27; + from + &#x27;&#x3e;&#x27;;
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ghost.GhostMailer.prototype.send" id="apidoc.element.ghost.GhostMailer.prototype.send">
        function <span class="apidocSignatureSpan">ghost.GhostMailer.prototype.</span>send
        <span class="apidocSignatureSpan">(message)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">send = function (message) {
    var self = this,
        to;

    // important to clone message as we modify it
    message = _.clone(message) || {};
    to = message.to || false;

    if (!(message &#x26;&#x26; message.subject &#x26;&#x26; message.html &#x26;&#x26; message.to)) {
        return Promise.reject(new Error(i18n.t(&#x27;errors.mail.incompleteMessageData.error&#x27;)));
    }

    message = _.extend(message, {
        from: self.from(),
        to: to,
        generateTextFromHTML: true,
        encoding: &#x27;base64&#x27;
    });

    return new Promise(function (resolve, reject) {
        self.transport.sendMail(message, function (error, response) {
            if (error) {
                return reject(new Error(error));
            }

            if (self.transport.transportType !== &#x27;DIRECT&#x27;) {
                return resolve(response);
            }

            response.statusHandler.once(&#x27;failed&#x27;, function (data) {
                var reason = i18n.t(&#x27;errors.mail.failedSendingEmail.error&#x27;);

                if (data.error &#x26;&#x26; data.error.errno === &#x27;ENOTFOUND&#x27;) {
                    reason += i18n.t(&#x27;errors.mail.noMailServerAtAddress.error&#x27;, {domain: data.domain});
                }
                reason += &#x27;.&#x27;;
                return reject(new Error(reason));
            });

            response.statusHandler.once(&#x27;requeue&#x27;, function (data) {
                var errorMessage = i18n.t(&#x27;errors.mail.messageNotSent.error&#x27;);

                if (data.error &#x26;&#x26; data.error.message) {
                    errorMessage += i18n.t(&#x27;errors.general.moreInfo&#x27;, {info: data.error.message});
                }

                return reject(new Error(errorMessage));
            });

            response.statusHandler.once(&#x27;sent&#x27;, function () {
                return resolve(i18n.t(&#x27;notices.mail.messageSent&#x27;));
            });
        });
    });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
                    html: content.html,
                    text: content.text
                },
                options: {}
            }]
        };

        return apiMail.<span class="apidocCodeKeywordSpan">send</span>(payload, {context: {internal: true}});
    });
}

function formatResponse() {
    return {
        passwordreset: [
            {message: i18n.t(&#x27;common.api.authentication.mail.checkEmailForInstructions&#x27;)}
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.ghost.SchedulingDefault" id="apidoc.module.ghost.SchedulingDefault">module ghost.SchedulingDefault</a></h1>


    <h2>
        <a href="#apidoc.element.ghost.SchedulingDefault.SchedulingDefault" id="apidoc.element.ghost.SchedulingDefault.SchedulingDefault">
        function <span class="apidocSignatureSpan">ghost.</span>SchedulingDefault
        <span class="apidocSignatureSpan">(options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function SchedulingDefault(options) {
    SchedulingBase.call(this, options);

    this.runTimeoutInMs = 1000 * 60 * 5;
    this.offsetInMinutes = 10;
    this.beforePingInMs = -50;
    this.retryTimeoutInMs = 1000 * 5;

    this.allJobs = {};
    this.deletedJobs = {};
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ghost.SchedulingDefault.super_" id="apidoc.element.ghost.SchedulingDefault.super_">
        function <span class="apidocSignatureSpan">ghost.SchedulingDefault.</span>super_
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function SchedulingBase() {
    Object.defineProperty(this, &#x27;requiredFns&#x27;, {
        value: [&#x27;schedule&#x27;, &#x27;unschedule&#x27;, &#x27;reschedule&#x27;, &#x27;run&#x27;],
        writable: false
    });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.ghost.SchedulingDefault.prototype" id="apidoc.module.ghost.SchedulingDefault.prototype">module ghost.SchedulingDefault.prototype</a></h1>


    <h2>
        <a href="#apidoc.element.ghost.SchedulingDefault.prototype._addJob" id="apidoc.element.ghost.SchedulingDefault.prototype._addJob">
        function <span class="apidocSignatureSpan">ghost.SchedulingDefault.prototype.</span>_addJob
        <span class="apidocSignatureSpan">(object)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_addJob = function (object) {
    var timestamp = moment(object.time).valueOf(),
        keys = [],
        sortedJobs = {},
        instantJob = {},
        i = 0;

    // CASE: should have been already pinged or should be pinged soon
    if (moment(timestamp).diff(moment(), &#x27;minutes&#x27;) &#x3c; this.offsetInMinutes) {
        instantJob[timestamp] = [object];
        this._execute(instantJob);
        return;
    }

    // CASE: are there jobs already scheduled for the same time?
    if (!this.allJobs[timestamp]) {
        this.allJobs[timestamp] = [];
    }

    this.allJobs[timestamp].push(object);

    keys = Object.keys(this.allJobs);
    keys.sort();

    for (i = 0; i &#x3c; keys.length; i = i + 1) {
        sortedJobs[keys[i]] = this.allJobs[keys[i]];
    }

    this.allJobs = sortedJobs;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

util.inherits(SchedulingDefault, SchedulingBase);

/**
 * add to list
 */
SchedulingDefault.prototype.schedule = function (object) {
    this.<span class="apidocCodeKeywordSpan">_addJob</span>(object);
};

/**
 * remove from list
 * add to list
 */
SchedulingDefault.prototype.reschedule = function (object) {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ghost.SchedulingDefault.prototype._deleteJob" id="apidoc.element.ghost.SchedulingDefault.prototype._deleteJob">
        function <span class="apidocSignatureSpan">ghost.SchedulingDefault.prototype.</span>_deleteJob
        <span class="apidocSignatureSpan">(object)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_deleteJob = function (object) {
    if (!object.time) {
        return;
    }

    var deleteKey = object.url + &#x27;_&#x27; + moment(object.time).valueOf();

    if (!this.deletedJobs[deleteKey]) {
        this.deletedJobs[deleteKey] = [];
    }

    this.deletedJobs[deleteKey].push(object);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
};

/**
* remove from list
* add to list
*/
SchedulingDefault.prototype.reschedule = function (object) {
   this.<span class="apidocCodeKeywordSpan">_deleteJob</span>({time: object.extra.oldTime, url: object.url});
   this._addJob(object);
};

/**
* remove from list
* deletion happens right before execution
*/
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ghost.SchedulingDefault.prototype._execute" id="apidoc.element.ghost.SchedulingDefault.prototype._execute">
        function <span class="apidocSignatureSpan">ghost.SchedulingDefault.prototype.</span>_execute
        <span class="apidocSignatureSpan">(jobs)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_execute = function (jobs) {
    var keys = Object.keys(jobs),
        self = this;

    keys.forEach(function (timestamp) {
        var timeout = null,
            diff = moment(Number(timestamp)).diff(moment());

        // awake a little before
        timeout = setTimeout(function () {
            clearTimeout(timeout);

            (function retry() {
                var immediate = setImmediate(function () {
                    clearImmediate(immediate);

                    if (moment().diff(moment(Number(timestamp))) &#x3c;= self.beforePingInMs) {
                        return retry();
                    }

                    var toExecute = jobs[timestamp];
                    delete jobs[timestamp];

                    toExecute.forEach(function (job) {
                        var deleteKey = job.url + &#x27;_&#x27; + moment(job.time).valueOf();

                        if (self.deletedJobs[deleteKey]) {
                            if (self.deletedJobs[deleteKey].length === 1) {
                                delete self.deletedJobs[deleteKey];
                            } else {
                                self.deletedJobs[deleteKey].pop();
                            }

                            return;
                        }

                        self._pingUrl(job);
                    });
                });
            })();
        }, diff - 200);
    });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
            }

            // break!
            return false;
        });

        clearTimeout(timeout);
        self.<span class="apidocCodeKeywordSpan">_execute</span>(nextJobs);

        // recursive!
        self.run();
    }, self.runTimeoutInMs);
};

/**
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ghost.SchedulingDefault.prototype._pingUrl" id="apidoc.element.ghost.SchedulingDefault.prototype._pingUrl">
        function <span class="apidocSignatureSpan">ghost.SchedulingDefault.prototype.</span>_pingUrl
        <span class="apidocSignatureSpan">(object)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_pingUrl = function (object) {
    var url = object.url,
        time = object.time,
        httpMethod = object.extra ? object.extra.httpMethod : &#x27;PUT&#x27;,
        tries = object.tries || 0,
        maxTries = 30,
        req = request[httpMethod.toLowerCase()](url),
        self = this, timeout;

    if (moment(time).isBefore(moment())) {
        if (httpMethod === &#x27;GET&#x27;) {
            req.query(&#x27;force=true&#x27;);
        } else {
            req.send({
                force: true
            });
        }
    }

    req.end(function (err, response) {
        if (err) {
            // CASE: post/page was deleted already
            if (response &#x26;&#x26; response.status === 404) {
                return;
            }

            // CASE: blog is in maintenance mode, retry
            if (response &#x26;&#x26; response.status === 503 &#x26;&#x26; tries &#x3c; maxTries) {
                timeout = setTimeout(function pingAgain() {
                    clearTimeout(timeout);

                    object.tries = tries + 1;
                    self._pingUrl(object);
                }, self.retryTimeoutInMs);
            }

            errors.logError(err);
        }
    });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
                            } else {
                                self.deletedJobs[deleteKey].pop();
                            }

                            return;
                        }

                        self.<span class="apidocCodeKeywordSpan">_pingUrl</span>(job);
                    });
                });
            })();
        }, diff - 200);
    });
};
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ghost.SchedulingDefault.prototype.reschedule" id="apidoc.element.ghost.SchedulingDefault.prototype.reschedule">
        function <span class="apidocSignatureSpan">ghost.SchedulingDefault.prototype.</span>reschedule
        <span class="apidocSignatureSpan">(object)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">reschedule = function (object) {
    this._deleteJob({time: object.extra.oldTime, url: object.url});
    this._addJob(object);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ghost.SchedulingDefault.prototype.run" id="apidoc.element.ghost.SchedulingDefault.prototype.run">
        function <span class="apidocSignatureSpan">ghost.SchedulingDefault.prototype.</span>run
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">run = function () {
    var self = this,
        timeout = null;

    timeout = setTimeout(function () {
        var times = Object.keys(self.allJobs),
            nextJobs = {};

        times.every(function (time) {
            if (moment(Number(time)).diff(moment(), &#x27;minutes&#x27;) &#x3c;= self.offsetInMinutes) {
                nextJobs[time] = self.allJobs[time];
                delete self.allJobs[time];
                return true;
            }

            // break!
            return false;
        });

        clearTimeout(timeout);
        self._execute(nextJobs);

        // recursive!
        self.run();
    }, self.runTimeoutInMs);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
                options: {
                    livereload: true
                }
            }
        }
    });

    grunt.task.<span class="apidocCodeKeywordSpan">run</span>(&#x27;watch:docs&#x27;);
});

// ## Testing

// Ghost has an extensive set of test suites. The following section documents the various types of tests
// and how to run them.
//
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ghost.SchedulingDefault.prototype.schedule" id="apidoc.element.ghost.SchedulingDefault.prototype.schedule">
        function <span class="apidocSignatureSpan">ghost.SchedulingDefault.prototype.</span>schedule
        <span class="apidocSignatureSpan">(object)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">schedule = function (object) {
    this._addJob(object);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ghost.SchedulingDefault.prototype.unschedule" id="apidoc.element.ghost.SchedulingDefault.prototype.unschedule">
        function <span class="apidocSignatureSpan">ghost.SchedulingDefault.prototype.</span>unschedule
        <span class="apidocSignatureSpan">(object)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">unschedule = function (object) {
    this._deleteJob(object);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.ghost.accesstoken" id="apidoc.module.ghost.accesstoken">module ghost.accesstoken</a></h1>


    <h2>
        <a href="#apidoc.element.ghost.accesstoken.Accesstoken" id="apidoc.element.ghost.accesstoken.Accesstoken">
        function <span class="apidocSignatureSpan">ghost.accesstoken.</span>Accesstoken
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">Accesstoken = function () {
  return Parent.apply(this, arguments);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ghost.accesstoken.Accesstokens" id="apidoc.element.ghost.accesstoken.Accesstokens">
        function <span class="apidocSignatureSpan">ghost.accesstoken.</span>Accesstokens
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">Accesstokens = function () {
  return Parent.apply(this, arguments);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.ghost.admin" id="apidoc.module.ghost.admin">module ghost.admin</a></h1>


    <h2>
        <a href="#apidoc.element.ghost.admin.index" id="apidoc.element.ghost.admin.index">
        function <span class="apidocSignatureSpan">ghost.admin.</span>index
        <span class="apidocSignatureSpan">(req, res)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function index(req, res) {
<span class="apidocCodeCommentSpan">    /*jslint unparam:true*/
</span>
    function renderIndex() {
        var configuration,
            fetch = {
                configuration: api.configuration.read().then(function (res) { return res.configuration[0]; }),
                client: api.clients.read({slug: &#x27;ghost-admin&#x27;}).then(function (res) { return res.clients[0]; })
            };

        return Promise.props(fetch).then(function renderIndex(result) {
            configuration = result.configuration;

            configuration.clientId = {value: result.client.slug, type: &#x27;string&#x27;};
            configuration.clientSecret = {value: result.client.secret, type: &#x27;string&#x27;};

            res.render(&#x27;default&#x27;, {
                configuration: configuration
            });
        });
    }

    updateCheck().then(function then() {
        return updateCheck.showUpdateNotification();
    }).then(function then(updateVersion) {
        if (!updateVersion) {
            return;
        }

        var notification = {
            status: &#x27;alert&#x27;,
            type: &#x27;info&#x27;,
            location: &#x27;upgrade.new-version-available&#x27;,
            dismissible: false,
            message: i18n.t(&#x27;notices.controllers.newVersionAvailable&#x27;,
                            {version: updateVersion, link: &#x27;&#x3c;a href=&#x22;http://support.ghost.org/how-to-upgrade/&#x22; target=&#x22;_blank&#x22;&#x3e;Click
 here&#x3c;/a&#x3e;&#x27;})};

        return api.notifications.browse({context: {internal: true}}).then(function then(results) {
            if (!_.some(results.notifications, {message: notification.message})) {
                return api.notifications.add({notifications: [notification]}, {context: {internal: true}});
            }
        });
    }).finally(function noMatterWhat() {
        renderIndex();
    }).catch(errors.logError);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.ghost.app" id="apidoc.module.ghost.app">module ghost.app</a></h1>


    <h2>
        <a href="#apidoc.element.ghost.app.App" id="apidoc.element.ghost.app.App">
        function <span class="apidocSignatureSpan">ghost.app.</span>App
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">App = function () {
  return Parent.apply(this, arguments);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ghost.app.Apps" id="apidoc.element.ghost.app.Apps">
        function <span class="apidocSignatureSpan">ghost.app.</span>Apps
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">Apps = function () {
  return Parent.apply(this, arguments);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.ghost.app_field" id="apidoc.module.ghost.app_field">module ghost.app_field</a></h1>


    <h2>
        <a href="#apidoc.element.ghost.app_field.AppField" id="apidoc.element.ghost.app_field.AppField">
        function <span class="apidocSignatureSpan">ghost.app_field.</span>AppField
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">AppField = function () {
  return Parent.apply(this, arguments);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ghost.app_field.AppFields" id="apidoc.element.ghost.app_field.AppFields">
        function <span class="apidocSignatureSpan">ghost.app_field.</span>AppFields
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">AppFields = function () {
  return Parent.apply(this, arguments);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.ghost.app_setting" id="apidoc.module.ghost.app_setting">module ghost.app_setting</a></h1>


    <h2>
        <a href="#apidoc.element.ghost.app_setting.AppSetting" id="apidoc.element.ghost.app_setting.AppSetting">
        function <span class="apidocSignatureSpan">ghost.app_setting.</span>AppSetting
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">AppSetting = function () {
  return Parent.apply(this, arguments);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ghost.app_setting.AppSettings" id="apidoc.element.ghost.app_setting.AppSettings">
        function <span class="apidocSignatureSpan">ghost.app_setting.</span>AppSettings
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">AppSettings = function () {
  return Parent.apply(this, arguments);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.ghost.auth" id="apidoc.module.ghost.auth">module ghost.auth</a></h1>


    <h2>
        <a href="#apidoc.element.ghost.auth.authenticateClient" id="apidoc.element.ghost.auth.authenticateClient">
        function <span class="apidocSignatureSpan">ghost.auth.</span>authenticateClient
        <span class="apidocSignatureSpan">(req, res, next)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function authenticateClient(req, res, next) {
    // skip client authentication if bearer token is present
    if (isBearerAutorizationHeader(req)) {
        return next();
    }

    if (req.query &#x26;&#x26; req.query.client_id) {
        req.body.client_id = req.query.client_id;
    }

    if (req.query &#x26;&#x26; req.query.client_secret) {
        req.body.client_secret = req.query.client_secret;
    }

    if (!req.body.client_id || !req.body.client_secret) {
        errors.logError(
            i18n.t(&#x27;errors.middleware.auth.clientAuthenticationFailed&#x27;),
            i18n.t(&#x27;errors.middleware.auth.clientCredentialsNotProvided&#x27;),
            i18n.t(&#x27;errors.middleware.auth.forInformationRead&#x27;, {url: &#x27;http://api.ghost.org/docs/client-authentication&#x27;})
        );
        return errors.handleAPIError(new errors.UnauthorizedError(i18n.t(&#x27;errors.middleware.auth.accessDenied&#x27;)), req, res, next
);
    }

    return passport.authenticate([&#x27;oauth2-client-password&#x27;], {session: false, failWithError: false},
        function authenticate(err, client) {
            if (err) {
                return next(err); // will generate a 500 error
            }

            // req.body needs to be null for GET requests to build options correctly
            delete req.body.client_id;
            delete req.body.client_secret;

            if (!client) {
                errors.logError(
                    i18n.t(&#x27;errors.middleware.auth.clientAuthenticationFailed&#x27;),
                    i18n.t(&#x27;errors.middleware.auth.clientCredentialsNotValid&#x27;),
                    i18n.t(&#x27;errors.middleware.auth.forInformationRead&#x27;, {url: &#x27;http://api.ghost.org/docs/client-authentication&#x27;})
                );
                return errors.handleAPIError(new errors.UnauthorizedError(i18n.t(&#x27;errors.middleware.auth.accessDenied&#x27;)), req, res
, next);
            }

            req.client = client;

            events.emit(&#x27;client.authenticated&#x27;, client);
            return next(null, client);
        }
    )(req, res, next);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ghost.auth.authenticateUser" id="apidoc.element.ghost.auth.authenticateUser">
        function <span class="apidocSignatureSpan">ghost.auth.</span>authenticateUser
        <span class="apidocSignatureSpan">(req, res, next)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function authenticateUser(req, res, next) {
    return passport.authenticate(&#x27;bearer&#x27;, {session: false, failWithError: false},
        function authenticate(err, user, info) {
            if (err) {
                return next(err); // will generate a 500 error
            }

            if (user) {
                req.authInfo = info;
                req.user = user;

                events.emit(&#x27;user.authenticated&#x27;, user);
                return next(null, user, info);
            } else if (isBearerAutorizationHeader(req)) {
                return errors.handleAPIError(new errors.UnauthorizedError(i18n.t(&#x27;errors.middleware.auth.accessDenied&#x27;)), req, res
, next);
            } else if (req.client) {
                req.user = {id: 0};
                return next();
            }

            return errors.handleAPIError(new errors.UnauthorizedError(i18n.t(&#x27;errors.middleware.auth.accessDenied&#x27;)), req, res,
next);
        }
    )(req, res, next);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ghost.auth.requiresAuthorizedUser" id="apidoc.element.ghost.auth.requiresAuthorizedUser">
        function <span class="apidocSignatureSpan">ghost.auth.</span>requiresAuthorizedUser
        <span class="apidocSignatureSpan">(req, res, next)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function requiresAuthorizedUser(req, res, next) {
    if (req.user &#x26;&#x26; req.user.id) {
        return next();
    } else {
        return errors.handleAPIError(new errors.NoPermissionError(i18n.t(&#x27;errors.middleware.auth.pleaseSignIn&#x27;)), req, res, next
);
    }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ghost.auth.requiresAuthorizedUserPublicAPI" id="apidoc.element.ghost.auth.requiresAuthorizedUserPublicAPI">
        function <span class="apidocSignatureSpan">ghost.auth.</span>requiresAuthorizedUserPublicAPI
        <span class="apidocSignatureSpan">(req, res, next)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function requiresAuthorizedUserPublicAPI(req, res, next) {
    if (labs.isSet(&#x27;publicAPI&#x27;) === true) {
        return next();
    } else {
        if (req.user &#x26;&#x26; req.user.id) {
            return next();
        } else {
            return errors.handleAPIError(new errors.NoPermissionError(i18n.t(&#x27;errors.middleware.auth.pleaseSignIn&#x27;)), req, res,
next);
        }
    }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.ghost.auth_strategies" id="apidoc.module.ghost.auth_strategies">module ghost.auth_strategies</a></h1>


    <h2>
        <a href="#apidoc.element.ghost.auth_strategies.bearerStrategy" id="apidoc.element.ghost.auth_strategies.bearerStrategy">
        function <span class="apidocSignatureSpan">ghost.auth_strategies.</span>bearerStrategy
        <span class="apidocSignatureSpan">(accessToken, done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function bearerStrategy(accessToken, done) {
    return models.Accesstoken.findOne({token: accessToken})
        .then(function then(model) {
            if (model) {
                var token = model.toJSON();
                if (token.expires &#x3e; Date.now()) {
                    return models.User.findOne({id: token.user_id})
                        .then(function then(model) {
                            if (model) {
                                var user = model.toJSON(),
                                    info = {scope: &#x27;*&#x27;};
                                return done(null, {id: user.id}, info);
                            }
                            return done(null, false);
                        });
                } else {
                    return done(null, false);
                }
            } else {
                return done(null, false);
            }
        });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ghost.auth_strategies.clientPasswordStrategy" id="apidoc.element.ghost.auth_strategies.clientPasswordStrategy">
        function <span class="apidocSignatureSpan">ghost.auth_strategies.</span>clientPasswordStrategy
        <span class="apidocSignatureSpan">(clientId, clientSecret, done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function clientPasswordStrategy(clientId, clientSecret, done) {
    return models.Client.findOne({slug: clientId}, {withRelated: [&#x27;trustedDomains&#x27;]})
        .then(function then(model) {
            if (model) {
                var client = model.toJSON({include: [&#x27;trustedDomains&#x27;]});
                if (client.status === &#x27;enabled&#x27; &#x26;&#x26; client.secret === clientSecret) {
                    return done(null, client);
                }
            }
            return done(null, false);
        });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.ghost.authentication" id="apidoc.module.ghost.authentication">module ghost.authentication</a></h1>


    <h2>
        <a href="#apidoc.element.ghost.authentication.acceptInvitation" id="apidoc.element.ghost.authentication.acceptInvitation">
        function <span class="apidocSignatureSpan">ghost.authentication.</span>acceptInvitation
        <span class="apidocSignatureSpan">(invitation)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function acceptInvitation(invitation) {
    var tasks;

    function validateInvitation(invitation) {
        return utils.checkObject(invitation, &#x27;invitation&#x27;);
    }

    function processInvitation(invitation) {
        var User = dataProvider.User,
            settingsQuery = {context: {internal: true}, key: &#x27;dbHash&#x27;},
            data = invitation.invitation[0],
            resetToken = data.token,
            newPassword = data.password,
            email = data.email,
            name = data.name;

        return settings.read(settingsQuery).then(function then(response) {
            return User.resetPassword({
                token: resetToken,
                newPassword: newPassword,
                ne2Password: newPassword,
                dbHash: response.settings[0].value
            });
        }).then(function then(user) {
            return User.edit({name: name, email: email, slug: &#x27;&#x27;}, {id: user.id});
        }).catch(function (error) {
            throw new errors.UnauthorizedError(error.message);
        });
    }

    function formatResponse() {
        return {
            invitation: [
                {message: i18n.t(&#x27;common.api.authentication.mail.invitationAccepted&#x27;)}
            ]
        };
    }

    tasks = [
        assertSetupCompleted(true),
        validateInvitation,
        processInvitation,
        formatResponse
    ];

    return pipeline(tasks, invitation);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ghost.authentication.generateResetToken" id="apidoc.element.ghost.authentication.generateResetToken">
        function <span class="apidocSignatureSpan">ghost.authentication.</span>generateResetToken
        <span class="apidocSignatureSpan">(resetRequest)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function generateResetToken(resetRequest) {
    var tasks;

    function validateRequest(resetRequest) {
        return utils.checkObject(resetRequest, &#x27;passwordreset&#x27;).then(function then(data) {
            var email = data.passwordreset[0].email;

            if (typeof email !== &#x27;string&#x27; || !validator.isEmail(email)) {
                throw new errors.BadRequestError(
                    i18n.t(&#x27;errors.api.authentication.noEmailProvided&#x27;)
                );
            }

            return email;
        });
    }

    function generateToken(email) {
        var settingsQuery = {context: {internal: true}, key: &#x27;dbHash&#x27;};

        return settings.read(settingsQuery).then(function then(response) {
            var dbHash = response.settings[0].value,
                expiresAt = Date.now() + globalUtils.ONE_DAY_MS;

            return dataProvider.User.generateResetToken(email, expiresAt, dbHash);
        }).then(function then(resetToken) {
            return {
                email: email,
                resetToken: resetToken
            };
        });
    }

    function sendResetNotification(data) {
        var baseUrl = config.forceAdminSSL ? (config.urlSSL || config.url) : config.url,
            resetUrl = baseUrl.replace(/\/$/, &#x27;&#x27;) +
                &#x27;/ghost/reset/&#x27; +
                globalUtils.encodeBase64URLsafe(data.resetToken) + &#x27;/&#x27;;

        return mail.utils.generateContent({
            data: {
                resetUrl: resetUrl
            },
            template: &#x27;reset-password&#x27;
        }).then(function then(content) {
            var payload = {
                mail: [{
                    message: {
                        to: data.email,
                        subject: i18n.t(&#x27;common.api.authentication.mail.resetPassword&#x27;),
                        html: content.html,
                        text: content.text
                    },
                    options: {}
                }]
            };

            return apiMail.send(payload, {context: {internal: true}});
        });
    }

    function formatResponse() {
        return {
            passwordreset: [
                {message: i18n.t(&#x27;common.api.authentication.mail.checkEmailForInstructions&#x27;)}
            ]
        };
    }

    tasks = [
        assertSetupCompleted(true),
        validateRequest,
        generateToken,
        sendResetNotification,
        formatResponse
    ];

    return pipeline(tasks, resetRequest);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
function generateToken(email) {
    var settingsQuery = {context: {internal: true}, key: &#x27;dbHash&#x27;};

    return settings.read(settingsQuery).then(function then(response) {
        var dbHash = response.settings[0].value,
            expiresAt = Date.now() + globalUtils.ONE_DAY_MS;

        return dataProvider.User.<span class="apidocCodeKeywordSpan">generateResetToken</span>(email, expiresAt, dbHash);
    }).then(function then(resetToken) {
        return {
            email: email,
            resetToken: resetToken
        };
    });
}
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ghost.authentication.isInvitation" id="apidoc.element.ghost.authentication.isInvitation">
        function <span class="apidocSignatureSpan">ghost.authentication.</span>isInvitation
        <span class="apidocSignatureSpan">(options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function isInvitation(options) {
    var tasks,
        localOptions = _.cloneDeep(options || {});

    function processArgs(options) {
        var email = options.email;

        if (typeof email !== &#x27;string&#x27; || !validator.isEmail(email)) {
            throw new errors.BadRequestError(
                i18n.t(&#x27;errors.api.authentication.invalidEmailReceived&#x27;)
            );
        }

        return email;
    }

    function checkInvitation(email) {
        return dataProvider.User
            .where({email: email, status: &#x27;invited&#x27;})
            .count(&#x27;id&#x27;)
            .then(function then(count) {
                return !!count;
            });
    }

    function formatResponse(isInvited) {
        return {invitation: [{valid: isInvited}]};
    }

    tasks = [
        processArgs,
        assertSetupCompleted(true),
        checkInvitation,
        formatResponse
    ];

    return pipeline(tasks, localOptions);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ghost.authentication.isSetup" id="apidoc.element.ghost.authentication.isSetup">
        function <span class="apidocSignatureSpan">ghost.authentication.</span>isSetup
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function isSetup() {
    var tasks,
        validStatuses = [&#x27;active&#x27;, &#x27;warn-1&#x27;, &#x27;warn-2&#x27;, &#x27;warn-3&#x27;, &#x27;warn-4&#x27;, &#x27;locked&#x27;];

    function checkSetupStatus() {
        return dataProvider.User
            .where(&#x27;status&#x27;, &#x27;in&#x27;, validStatuses)
            .count(&#x27;id&#x27;)
            .then(function (count) {
                return !!count;
            });
    }

    function formatResponse(isSetup) {
        return {
            setup: [
                {
                    status: isSetup,
                    // Pre-populate from config if, and only if the values exist in config.
                    title: config.title || undefined,
                    name: config.user_name || undefined,
                    email: config.user_email || undefined
                }
            ]
        };
    }

    tasks = [
        checkSetupStatus,
        formatResponse
    ];

    return pipeline(tasks);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

/**
* Returns setup status
*
* @return {Promise&#x3c;Boolean&#x3e;}
*/
function checkSetup() {
   return authentication.<span class="apidocCodeKeywordSpan">isSetup</span>().then(function then(result) {
       return result.setup[0].status;
   });
}

/**
* Allows an assertion to be made about setup status.
*
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ghost.authentication.onSetupStep3" id="apidoc.element.ghost.authentication.onSetupStep3">
        function <span class="apidocSignatureSpan">ghost.authentication.</span>onSetupStep3
        <span class="apidocSignatureSpan">(data)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">onSetupStep3 = function (data) {
    var oldAccessToken, oldAccessTokenData, options = {context: {internal: true}};

    return dataProvider.Accesstoken
        .findOne({
            token: data.token
        })
        .then(function (_oldAccessToken) {
            if (!_oldAccessToken) {
                throw new errors.NoPermissionError(i18n.t(&#x27;errors.api.authentication.notTheBlogOwner&#x27;));
            }

            oldAccessToken = _oldAccessToken;
            oldAccessTokenData = oldAccessToken.toJSON();

            if (oldAccessTokenData.expires &#x3c; Date.now()) {
                throw new errors.NoPermissionError(i18n.t(&#x27;errors.middleware.oauth.tokenExpired&#x27;));
            }

            var newAccessToken = globalUtils.uid(256),
                refreshToken = globalUtils.uid(256),
                newAccessExpiry = Date.now() + globalUtils.ONE_MONTH_MS,
                refreshExpires = Date.now() + globalUtils.SIX_MONTH_MS;

            return dataProvider.Accesstoken.add({
                token: newAccessToken,
                user_id: oldAccessTokenData.user_id,
                client_id: oldAccessTokenData.client_id,
                expires: newAccessExpiry
            }, options)
                .then(function then() {
                    return dataProvider.Refreshtoken.add({
                        token: refreshToken,
                        user_id: oldAccessTokenData.user_id,
                        client_id: oldAccessTokenData.client_id,
                        expires: refreshExpires
                    }, options);
                }).then(function then() {
                    return oldAccessToken.destroy();
                }).then(function () {
                    return {
                        access_token: newAccessToken,
                        refresh_token: refreshToken,
                        expires_in: globalUtils.ONE_MONTH_S
                    };
                });
        });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ghost.authentication.resetPassword" id="apidoc.element.ghost.authentication.resetPassword">
        function <span class="apidocSignatureSpan">ghost.authentication.</span>resetPassword
        <span class="apidocSignatureSpan">(resetRequest)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function resetPassword(resetRequest) {
    var tasks;

    function validateRequest(resetRequest) {
        return utils.checkObject(resetRequest, &#x27;passwordreset&#x27;);
    }

    function doReset(resetRequest) {
        var settingsQuery = {context: {internal: true}, key: &#x27;dbHash&#x27;},
            data = resetRequest.passwordreset[0],
            resetToken = data.token,
            newPassword = data.newPassword,
            ne2Password = data.ne2Password;

        return settings.read(settingsQuery).then(function then(response) {
            return dataProvider.User.resetPassword({
                token: resetToken,
                newPassword: newPassword,
                ne2Password: ne2Password,
                dbHash: response.settings[0].value
            });
        }).catch(function (error) {
            throw new errors.UnauthorizedError(error.message);
        });
    }

    function formatResponse() {
        return {
            passwordreset: [
                {message: i18n.t(&#x27;common.api.authentication.mail.passwordChanged&#x27;)}
            ]
        };
    }

    tasks = [
        assertSetupCompleted(true),
        validateRequest,
        doReset,
        formatResponse
    ];

    return pipeline(tasks, resetRequest);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
var settingsQuery = {context: {internal: true}, key: &#x27;dbHash&#x27;},
    data = resetRequest.passwordreset[0],
    resetToken = data.token,
    newPassword = data.newPassword,
    ne2Password = data.ne2Password;

return settings.read(settingsQuery).then(function then(response) {
    return dataProvider.User.<span class="apidocCodeKeywordSpan">resetPassword</span>({
        token: resetToken,
        newPassword: newPassword,
        ne2Password: ne2Password,
        dbHash: response.settings[0].value
    });
}).catch(function (error) {
    throw new errors.UnauthorizedError(error.message);
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ghost.authentication.revoke" id="apidoc.element.ghost.authentication.revoke">
        function <span class="apidocSignatureSpan">ghost.authentication.</span>revoke
        <span class="apidocSignatureSpan">(tokenDetails, options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function revokeToken(tokenDetails, options) {
    var tasks,
        localOptions = _.cloneDeep(options || {});

    function processArgs(tokenDetails, options) {
        return _.assign({}, tokenDetails, options);
    }

    function revokeToken(options) {
        var providers = [
                dataProvider.Refreshtoken,
                dataProvider.Accesstoken
            ],
            response = {token: options.token};

        function destroyToken(provider, options, providers) {
            return provider.destroyByToken(options)
                .return(response)
                .catch(provider.NotFoundError, function () {
                    if (!providers.length) {
                        return {
                            token: tokenDetails.token,
                            error: i18n.t(&#x27;errors.api.authentication.invalidTokenProvided&#x27;)
                        };
                    }

                    return destroyToken(providers.pop(), options, providers);
                })
                .catch(function () {
                    throw new errors.TokenRevocationError(
                        i18n.t(&#x27;errors.api.authentication.tokenRevocationFailed&#x27;)
                    );
                });
        }

        return destroyToken(providers.pop(), options, providers);
    }

    tasks = [
        processArgs,
        revokeToken
    ];

    return pipeline(tasks, tokenDetails, localOptions);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ghost.authentication.setup" id="apidoc.element.ghost.authentication.setup">
        function <span class="apidocSignatureSpan">ghost.authentication.</span>setup
        <span class="apidocSignatureSpan">(setupDetails)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function setup(setupDetails) {
    var tasks;

    function doSetup(setupDetails) {
        return setupTasks(setupDetails);
    }

    function sendNotification(setupUser) {
        var data = {
            ownerEmail: setupUser.email
        };

        events.emit(&#x27;setup.completed&#x27;, setupUser);

        return mail.utils.generateContent({data: data, template: &#x27;welcome&#x27;})
            .then(function then(content) {
                var message = {
                        to: setupUser.email,
                        subject: i18n.t(&#x27;common.api.authentication.mail.yourNewGhostBlog&#x27;),
                        html: content.html,
                        text: content.text
                    },
                    payload = {
                        mail: [{
                            message: message,
                            options: {}
                        }]
                    };

                apiMail.send(payload, {context: {internal: true}}).catch(function (error) {
                    errors.logError(
                        error.message,
                        i18n.t(
                            &#x27;errors.api.authentication.unableToSendWelcomeEmail&#x27;
                        ),
                        i18n.t(&#x27;errors.api.authentication.checkEmailConfigInstructions&#x27;, {url: &#x27;http://support.ghost.org/mail/&#x27;})
                    );
                });
            })
            .return(setupUser);
    }

    function formatResponse(setupUser) {
        return {users: [setupUser]};
    }

    tasks = [
        assertSetupCompleted(false),
        doSetup,
        sendNotification,
        formatResponse
    ];

    return pipeline(tasks, setupDetails);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    return User.findOne({role: &#x27;Owner&#x27;, status: &#x27;all&#x27;}).then(function then(owner) {
        if (!owner) {
            throw new errors.InternalServerError(
                i18n.t(&#x27;errors.api.authentication.setupUnableToRun&#x27;)
            );
        }

        return User.<span class="apidocCodeKeywordSpan">setup</span>(userData, _.extend({id: owner.id}, context));
    }).then(function then(user) {
        return {
            user: user,
            userData: userData
        };
    });
}
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ghost.authentication.updateSetup" id="apidoc.element.ghost.authentication.updateSetup">
        function <span class="apidocSignatureSpan">ghost.authentication.</span>updateSetup
        <span class="apidocSignatureSpan">(setupDetails, options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function updateSetup(setupDetails, options) {
    var tasks,
        localOptions = _.cloneDeep(options || {});

    function processArgs(setupDetails, options) {
        if (!options.context || !options.context.user) {
            throw new errors.NoPermissionError(i18n.t(&#x27;errors.api.authentication.notTheBlogOwner&#x27;));
        }

        return _.assign({setupDetails: setupDetails}, options);
    }

    function checkPermission(options) {
        return dataProvider.User.findOne({role: &#x27;Owner&#x27;, status: &#x27;all&#x27;})
            .then(function (owner) {
                if (owner.id !== options.context.user) {
                    throw new errors.NoPermissionError(i18n.t(&#x27;errors.api.authentication.notTheBlogOwner&#x27;));
                }

                return options.setupDetails;
            });
    }

    function formatResponse(user) {
        return {users: [user]};
    }

    tasks = [
        processArgs,
        assertSetupCompleted(true),
        checkPermission,
        setupTasks,
        formatResponse
    ];

    return pipeline(tasks, setupDetails, localOptions);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.ghost.base" id="apidoc.module.ghost.base">module ghost.base</a></h1>


    <h2>
        <a href="#apidoc.element.ghost.base.base" id="apidoc.element.ghost.base.base">
        function <span class="apidocSignatureSpan">ghost.</span>base
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function StorageBase() {
    Object.defineProperty(this, &#x27;requiredFns&#x27;, {
        value: [&#x27;exists&#x27;, &#x27;save&#x27;, &#x27;serve&#x27;, &#x27;delete&#x27;],
        writable: false
    });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.ghost.base.prototype" id="apidoc.module.ghost.base.prototype">module ghost.base.prototype</a></h1>


    <h2>
        <a href="#apidoc.element.ghost.base.prototype.generateUnique" id="apidoc.element.ghost.base.prototype.generateUnique">
        function <span class="apidocSignatureSpan">ghost.base.prototype.</span>generateUnique
        <span class="apidocSignatureSpan">(store, dir, name, ext, i)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">generateUnique = function (store, dir, name, ext, i) {
    var self = this,
        filename,
        append = &#x27;&#x27;;

    if (i) {
        append = &#x27;-&#x27; + i;
    }

    if (ext) {
        filename = path.join(dir, name + append + ext);
    } else {
        filename = path.join(dir, name + append);
    }

    return store.exists(filename).then(function (exists) {
        if (exists) {
            i = i + 1;
            return self.generateUnique(store, dir, name, ext, i);
        } else {
            return filename;
        }
    });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    } else {
        filename = path.join(dir, name + append);
    }

    return store.exists(filename).then(function (exists) {
        if (exists) {
            i = i + 1;
            return self.<span class="apidocCodeKeywordSpan">generateUnique</span>(store, dir, name, ext, i);
        } else {
            return filename;
        }
    });
};

StorageBase.prototype.getUniqueFileName = function (store, image, targetDir) {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ghost.base.prototype.getSanitizedFileName" id="apidoc.element.ghost.base.prototype.getSanitizedFileName">
        function <span class="apidocSignatureSpan">ghost.base.prototype.</span>getSanitizedFileName
        <span class="apidocSignatureSpan">(fileName)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function getSanitizedFileName(fileName) {
    // below only matches ascii characters, @, and .
    // unicode filenames like .zip would therefore resolve to ----.zip
    return fileName.replace(/[^\w@.]/gi, &#x27;-&#x27;);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
// consistent filename uploads
options.originalname = options.originalname.toLowerCase();

var storageAdapter = storage.getStorage(&#x27;themes&#x27;),
zip = {
    path: options.path,
    name: options.originalname,
    shortName: storageAdapter.<span class="apidocCodeKeywordSpan">getSanitizedFileName</span>(options.originalname.split(&#x27;.
zip&#x27;)[0])
}, theme;

// check if zip name is casper.zip
if (zip.name === &#x27;casper.zip&#x27;) {
    throw new errors.ValidationError(i18n.t(&#x27;errors.api.themes.overrideCasper&#x27;));
}
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ghost.base.prototype.getTargetDir" id="apidoc.element.ghost.base.prototype.getTargetDir">
        function <span class="apidocSignatureSpan">ghost.base.prototype.</span>getTargetDir
        <span class="apidocSignatureSpan">(baseDir)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">getTargetDir = function (baseDir) {
    var m = moment(),
        month = m.format(&#x27;MM&#x27;),
        year = m.format(&#x27;YYYY&#x27;);

    if (baseDir) {
        return path.join(baseDir, year, month);
    }

    return path.join(year, month);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
util.inherits(LocalFileStore, BaseStore);

// ### Save
// Saves the image to storage (the file system)
// - image is the express image object
// - returns a promise which ultimately returns the full url to the uploaded image
LocalFileStore.prototype.save = function (image, targetDir) {
targetDir = targetDir || this.<span class="apidocCodeKeywordSpan">getTargetDir</span>(config.paths.imagesPath);
var targetFilename;

return this.getUniqueFileName(this, image, targetDir).then(function (filename) {
    targetFilename = filename;
    return Promise.promisify(fs.mkdirs)(targetDir);
}).then(function () {
    return Promise.promisify(fs.copy)(image.path, targetFilename);
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ghost.base.prototype.getUniqueFileName" id="apidoc.element.ghost.base.prototype.getUniqueFileName">
        function <span class="apidocSignatureSpan">ghost.base.prototype.</span>getUniqueFileName
        <span class="apidocSignatureSpan">(store, image, targetDir)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">getUniqueFileName = function (store, image, targetDir) {
    var ext = path.extname(image.name), name;

    // poor extension validation
    // .1 is not a valid extension
    if (!ext.match(/.\d/)) {
        name = this.getSanitizedFileName(path.basename(image.name, ext));
        return this.generateUnique(store, targetDir, name, ext, 0);
    } else {
        name = this.getSanitizedFileName(path.basename(image.name));
        return this.generateUnique(store, targetDir, name, null, 0);
    }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
// Saves the image to storage (the file system)
// - image is the express image object
// - returns a promise which ultimately returns the full url to the uploaded image
LocalFileStore.prototype.save = function (image, targetDir) {
targetDir = targetDir || this.getTargetDir(config.paths.imagesPath);
var targetFilename;

return this.<span class="apidocCodeKeywordSpan">getUniqueFileName</span>(this, image, targetDir).then(function (filename) {
    targetFilename = filename;
    return Promise.promisify(fs.mkdirs)(targetDir);
}).then(function () {
    return Promise.promisify(fs.copy)(image.path, targetFilename);
}).then(function () {
    // The src for the image must be in URI format, not a file system path, which in Windows uses \
    // For local file system storage can use relative path so add a slash
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.ghost.client" id="apidoc.module.ghost.client">module ghost.client</a></h1>


    <h2>
        <a href="#apidoc.element.ghost.client.Client" id="apidoc.element.ghost.client.Client">
        function <span class="apidocSignatureSpan">ghost.client.</span>Client
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">Client = function () {
  return Parent.apply(this, arguments);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ghost.client.Clients" id="apidoc.element.ghost.client.Clients">
        function <span class="apidocSignatureSpan">ghost.client.</span>Clients
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">Clients = function () {
  return Parent.apply(this, arguments);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.ghost.client_trusted_domain" id="apidoc.module.ghost.client_trusted_domain">module ghost.client_trusted_domain</a></h1>


    <h2>
        <a href="#apidoc.element.ghost.client_trusted_domain.ClientTrustedDomain" id="apidoc.element.ghost.client_trusted_domain.ClientTrustedDomain">
        function <span class="apidocSignatureSpan">ghost.client_trusted_domain.</span>ClientTrustedDomain
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">ClientTrustedDomain = function () {
  return Parent.apply(this, arguments);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ghost.client_trusted_domain.ClientTrustedDomains" id="apidoc.element.ghost.client_trusted_domain.ClientTrustedDomains">
        function <span class="apidocSignatureSpan">ghost.client_trusted_domain.</span>ClientTrustedDomains
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">ClientTrustedDomains = function () {
  return Parent.apply(this, arguments);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.ghost.clients" id="apidoc.module.ghost.clients">module ghost.clients</a></h1>


    <h2>
        <a href="#apidoc.element.ghost.clients.read" id="apidoc.element.ghost.clients.read">
        function <span class="apidocSignatureSpan">ghost.clients.</span>read
        <span class="apidocSignatureSpan">(options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function read(options) {
    var attrs = [&#x27;id&#x27;, &#x27;slug&#x27;],
        tasks;

<span class="apidocCodeCommentSpan">    /**
     * ### Model Query
     * Make the call to the Model layer
     * @param {Object} options
     * @returns {Object} options
     */
</span>    function doQuery(options) {
        // only User Agent (type = `ua`) clients are available at the moment.
        options.data = _.extend(options.data, {type: &#x27;ua&#x27;});
        return dataProvider.Client.findOne(options.data, _.omit(options, [&#x27;data&#x27;]));
    }

    // Push all of our tasks into a `tasks` array in the correct order
    tasks = [
        utils.validate(docName, {attrs: attrs}),
        // TODO: add permissions
        // utils.handlePublicPermissions(docName, &#x27;read&#x27;),
        doQuery
    ];

    // Pipeline calls each task passing the result of one to be the arguments for the next
    return pipeline(tasks, options).then(function formatResponse(result) {
        if (result) {
            return {clients: [result.toJSON(options)]};
        }

        return Promise.reject(new errors.NotFoundError(i18n.t(&#x27;common.api.clients.clientNotFound&#x27;)));
    });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    xmlrpc = require(&#x27;./data/xml/xmlrpc&#x27;),
    slack = require(&#x27;./data/slack&#x27;),
    GhostServer = require(&#x27;./ghost-server&#x27;),
    scheduling = require(&#x27;./scheduling&#x27;),
    dbHash;

function initDbHashAndFirstRun() {
    return api.settings.<span class="apidocCodeKeywordSpan">read</span>({key: &#x27;dbHash&#x27;, context: {internal: true}}).then
(function (response) {
var hash = response.settings[0].value,
    initHash;

dbHash = hash;

if (dbHash === null) {
    initHash = uuid.v4();
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.ghost.configuration" id="apidoc.module.ghost.configuration">module ghost.configuration</a></h1>


    <h2>
        <a href="#apidoc.element.ghost.configuration.read" id="apidoc.element.ghost.configuration.read">
        function <span class="apidocSignatureSpan">ghost.configuration.</span>read
        <span class="apidocSignatureSpan">(options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function read(options) {
    options = options || {};

    if (!options.key) {
        return Promise.resolve({configuration: [getBaseConfig()]});
    }

    if (options.key === &#x27;about&#x27;) {
        return Promise.resolve({configuration: [getAboutConfig()]});
    }

    // Timezone endpoint
    if (options.key === &#x27;timezones&#x27;) {
        return Promise.resolve({configuration: [fetchAvailableTimezones()]});
    }

    return Promise.resolve({configuration: []});
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    xmlrpc = require(&#x27;./data/xml/xmlrpc&#x27;),
    slack = require(&#x27;./data/slack&#x27;),
    GhostServer = require(&#x27;./ghost-server&#x27;),
    scheduling = require(&#x27;./scheduling&#x27;),
    dbHash;

function initDbHashAndFirstRun() {
    return api.settings.<span class="apidocCodeKeywordSpan">read</span>({key: &#x27;dbHash&#x27;, context: {internal: true}}).then
(function (response) {
var hash = response.settings[0].value,
    initHash;

dbHash = hash;

if (dbHash === null) {
    initHash = uuid.v4();
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.ghost.db" id="apidoc.module.ghost.db">module ghost.db</a></h1>


    <h2>
        <a href="#apidoc.element.ghost.db.deleteAllContent" id="apidoc.element.ghost.db.deleteAllContent">
        function <span class="apidocSignatureSpan">ghost.db.</span>deleteAllContent
        <span class="apidocSignatureSpan">(options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">deleteAllContent = function (options) {
    var tasks,
        queryOpts = {columns: &#x27;id&#x27;, context: {internal: true}};

    options = options || {};

    function deleteContent() {
        var collections = [
            models.Post.findAll(queryOpts),
            models.Tag.findAll(queryOpts)
        ];

        return Promise.each(collections, function then(Collection) {
            return Collection.invokeThen(&#x27;destroy&#x27;, queryOpts);
        }).return({db: []})
        .catch(function (error) {
            throw new errors.InternalServerError(error.message || error);
        });
    }

    tasks = [
        utils.handlePermissions(docName, &#x27;deleteAllContent&#x27;),
        backupDatabase,
        deleteContent
    ];

    return pipeline(tasks, options);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ghost.db.exportContent" id="apidoc.element.ghost.db.exportContent">
        function <span class="apidocSignatureSpan">ghost.db.</span>exportContent
        <span class="apidocSignatureSpan">(options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">exportContent = function (options) {
    var tasks = [];

    options = options || {};

    // Export data, otherwise send error 500
    function exportContent() {
        return exporter.doExport().then(function (exportedData) {
            return {db: [exportedData]};
        }).catch(function (error) {
            return Promise.reject(new errors.InternalServerError(error.message || error));
        });
    }

    tasks = [
        utils.handlePermissions(docName, &#x27;exportContent&#x27;),
        exportContent
    ];

    return pipeline(tasks, options);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ghost.db.importContent" id="apidoc.element.ghost.db.importContent">
        function <span class="apidocSignatureSpan">ghost.db.</span>importContent
        <span class="apidocSignatureSpan">(options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">importContent = function (options) {
    var tasks = [];
    options = options || {};

    function importContent(options) {
        return importer.importFromFile(options)
            .then(function () {
                api.settings.updateSettingsCache();
            })
            .return({db: []});
    }

    tasks = [
        utils.handlePermissions(docName, &#x27;importContent&#x27;),
        importContent
    ];

    return pipeline(tasks, options);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.ghost.dependencies" id="apidoc.module.ghost.dependencies">module ghost.dependencies</a></h1>


    <h2>
        <a href="#apidoc.element.ghost.dependencies.dependencies" id="apidoc.element.ghost.dependencies.dependencies">
        function <span class="apidocSignatureSpan">ghost.</span>dependencies
        <span class="apidocSignatureSpan">(appPath)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function AppDependencies(appPath) {
    this.appPath = appPath;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.ghost.dependencies.prototype" id="apidoc.module.ghost.dependencies.prototype">module ghost.dependencies.prototype</a></h1>


    <h2>
        <a href="#apidoc.element.ghost.dependencies.prototype.install" id="apidoc.element.ghost.dependencies.prototype.install">
        function <span class="apidocSignatureSpan">ghost.dependencies.prototype.</span>install
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function installAppDependencies() {
    var spawnOpts,
        self = this;

    return new Promise(function (resolve, reject) {
        fs.stat(path.join(self.appPath, &#x27;package.json&#x27;), function (err) {
            if (err) {
                // File doesn&#x27;t exist - nothing to do, resolve right away?
                resolve();
            } else {
                // Run npm install in the app directory
                spawnOpts = {
                    cwd: self.appPath
                };

                self.spawnCommand(&#x27;npm&#x27;, [&#x27;install&#x27;, &#x27;--production&#x27;], spawnOpts)
                    .on(&#x27;error&#x27;, reject)
                    .on(&#x27;exit&#x27;, function (err) {
                        if (err) {
                            reject(err);
                        }

                        resolve();
                    });
            }
        });
    });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
loader = {
    // Load a app and return the instantiated app
    installAppByName: function (name) {
        // Install the apps dependencies first
        var appPath = getAppAbsolutePath(name),
            deps = new AppDependencies(appPath);

        return deps.<span class="apidocCodeKeywordSpan">install</span>()
            .then(function () {
// Load app permissions
var perms = new AppPermissions(appPath);

return perms.read().catch(function (err) {
    // Provide a helpful error about which app
    return Promise.reject(new Error(i18n.t(&#x27;errors.apps.permissionsErrorLoadingApp.error&#x27;, {name: name, message: err.message
})));
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ghost.dependencies.prototype.spawnCommand" id="apidoc.element.ghost.dependencies.prototype.spawnCommand">
        function <span class="apidocSignatureSpan">ghost.dependencies.prototype.</span>spawnCommand
        <span class="apidocSignatureSpan">(command, args, opt)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">spawnCommand = function (command, args, opt) {
    var winCommand = win32 ? &#x27;cmd&#x27; : command,
        winArgs = win32 ? [&#x27;/c&#x27;].concat(command, args) : args;

    opt = opt || {};

    return spawn(winCommand, winArgs, _.defaults({stdio: &#x27;inherit&#x27;}, opt));
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
                resolve();
            } else {
                // Run npm install in the app directory
                spawnOpts = {
                    cwd: self.appPath
                };

                self.<span class="apidocCodeKeywordSpan">spawnCommand</span>(&#x27;npm&#x27;, [&#x27;install&#x27;, &#x27;--production
&#x27;], spawnOpts)
                    .on(&#x27;error&#x27;, reject)
                    .on(&#x27;exit&#x27;, function (err) {
if (err) {
    reject(err);
}

resolve();
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.ghost.effective" id="apidoc.module.ghost.effective">module ghost.effective</a></h1>


    <h2>
        <a href="#apidoc.element.ghost.effective.app" id="apidoc.element.ghost.effective.app">
        function <span class="apidocSignatureSpan">ghost.effective.</span>app
        <span class="apidocSignatureSpan">(appName)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">app = function (appName) {
    return Models.App.findOne({name: appName}, {withRelated: [&#x27;permissions&#x27;]})
        .then(function (foundApp) {
            if (!foundApp) {
                return [];
            }

            return {permissions: foundApp.related(&#x27;permissions&#x27;).models};
        }, errors.logAndThrowError);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ghost.effective.user" id="apidoc.element.ghost.effective.user">
        function <span class="apidocSignatureSpan">ghost.effective.</span>user
        <span class="apidocSignatureSpan">(id)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">user = function (id) {
    return Models.User.findOne({id: id, status: &#x27;all&#x27;}, {include: [&#x27;permissions&#x27;, &#x27;roles&#x27;, &#x27;roles.permissions&#x27;]})
        .then(function (foundUser) {
            // CASE: {context: {user: id}} where the id is not in our database
            if (!foundUser) {
                return Promise.reject(new errors.NotFoundError(i18n.t(&#x27;errors.models.user.userNotFound&#x27;)));
            }

            var seenPerms = {},
                rolePerms = _.map(foundUser.related(&#x27;roles&#x27;).models, function (role) {
                    return role.related(&#x27;permissions&#x27;).models;
                }),
                allPerms = [],
                user = foundUser.toJSON();

            rolePerms.push(foundUser.related(&#x27;permissions&#x27;).models);

            _.each(rolePerms, function (rolePermGroup) {
                _.each(rolePermGroup, function (perm) {
                    var key = perm.get(&#x27;action_type&#x27;) + &#x27;-&#x27; + perm.get(&#x27;object_type&#x27;) + &#x27;-&#x27; + perm.get(&#x27;object_id&#x27;);

                    // Only add perms once
                    if (seenPerms[key]) {
                        return;
                    }

                    allPerms.push(perm);
                    seenPerms[key] = true;
                });
            });

            return {permissions: allPerms, roles: user.roles};
        }, errors.logAndThrowError);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
         * @returns {Object} options
         */
        function handlePermissions(options) {
            if (options.id === &#x27;me&#x27; &#x26;&#x26; options.context &#x26;&#x26; options.context.user) {
options.id = options.context.user;
            }

            return canThis(options.context).edit.<span class="apidocCodeKeywordSpan">user</span>(options.id).then(function () {
// if roles aren&#x27;t in the payload, proceed with the edit
if (!(options.data.users[0].roles &#x26;&#x26; options.data.users[0].roles[0])) {
    return options;
}

// @TODO move role permissions out of here
var role = options.data.users[0].roles[0],
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.ghost.filters" id="apidoc.module.ghost.filters">module ghost.filters</a></h1>


    <h2>
        <a href="#apidoc.element.ghost.filters.Filters" id="apidoc.element.ghost.filters.Filters">
        function <span class="apidocSignatureSpan">ghost.filters.</span>Filters
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function Filters() {
    // Holds the filters
    this.filterCallbacks = [];

    // Holds the filter hooks (that are built in to Ghost Core)
    this.filters = [];
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>






</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.ghost.ghost_server" id="apidoc.module.ghost.ghost_server">module ghost.ghost_server</a></h1>


    <h2>
        <a href="#apidoc.element.ghost.ghost_server.ghost_server" id="apidoc.element.ghost.ghost_server.ghost_server">
        function <span class="apidocSignatureSpan">ghost.</span>ghost_server
        <span class="apidocSignatureSpan">(rootApp)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function GhostServer(rootApp) {
    this.rootApp = rootApp;
    this.httpServer = null;
    this.connections = {};
    this.connectionId = 0;

    // Expose config module for use externally.
    this.config = config;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.ghost.ghost_server.prototype" id="apidoc.module.ghost.ghost_server.prototype">module ghost.ghost_server.prototype</a></h1>


    <h2>
        <a href="#apidoc.element.ghost.ghost_server.prototype.closeConnections" id="apidoc.element.ghost.ghost_server.prototype.closeConnections">
        function <span class="apidocSignatureSpan">ghost.ghost_server.prototype.</span>closeConnections
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">closeConnections = function () {
    var self = this;

    Object.keys(self.connections).forEach(function (socketId) {
        var socket = self.connections[socketId];

        if (socket) {
            socket.destroy();
        }
    });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
       } else {
           self.httpServer.close(function () {
               self.httpServer = null;
               self.logShutdownMessages();
               resolve(self);
           });

           self.<span class="apidocCodeKeywordSpan">closeConnections</span>();
       }
   });
};

/**
* ### Restart
* Restarts the ghost application
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ghost.ghost_server.prototype.connection" id="apidoc.element.ghost.ghost_server.prototype.connection">
        function <span class="apidocSignatureSpan">ghost.ghost_server.prototype.</span>connection
        <span class="apidocSignatureSpan">(socket)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">connection = function (socket) {
    var self = this;

    self.connectionId += 1;
    socket._ghostId = self.connectionId;

    socket.on(&#x27;close&#x27;, function () {
        delete self.connections[this._ghostId];
    });

    self.connections[socket._ghostId] = socket;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ghost.ghost_server.prototype.hammertime" id="apidoc.element.ghost.ghost_server.prototype.hammertime">
        function <span class="apidocSignatureSpan">ghost.ghost_server.prototype.</span>hammertime
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">hammertime = function () {
    console.log(chalk.green(i18n.t(&#x27;notices.httpServer.cantTouchThis&#x27;)));

    return Promise.resolve(this);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ghost.ghost_server.prototype.logShutdownMessages" id="apidoc.element.ghost.ghost_server.prototype.logShutdownMessages">
        function <span class="apidocSignatureSpan">ghost.ghost_server.prototype.</span>logShutdownMessages
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">logShutdownMessages = function () {
    console.log(chalk.red(i18n.t(&#x27;notices.httpServer.ghostIsClosingConnections&#x27;)));
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

    return new Promise(function (resolve) {
        if (self.httpServer === null) {
            resolve(self);
        } else {
            self.httpServer.close(function () {
                self.httpServer = null;
                self.<span class="apidocCodeKeywordSpan">logShutdownMessages</span>();
                resolve(self);
            });

            self.closeConnections();
        }
    });
};
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ghost.ghost_server.prototype.logStartMessages" id="apidoc.element.ghost.ghost_server.prototype.logStartMessages">
        function <span class="apidocSignatureSpan">ghost.ghost_server.prototype.</span>logStartMessages
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">logStartMessages = function () {
    // Startup &#x26; Shutdown messages
    if (process.env.NODE_ENV === &#x27;production&#x27;) {
        console.log(
            chalk.green(i18n.t(&#x27;notices.httpServer.ghostIsRunningIn&#x27;, {env: process.env.NODE_ENV})),
            i18n.t(&#x27;notices.httpServer.yourBlogIsAvailableOn&#x27;, {url: config.url}),
            chalk.gray(i18n.t(&#x27;notices.httpServer.ctrlCToShutDown&#x27;))
        );
    } else {
        console.log(
            chalk.green(i18n.t(&#x27;notices.httpServer.ghostIsRunningIn&#x27;, {env: process.env.NODE_ENV})),
            i18n.t(&#x27;notices.httpServer.listeningOn&#x27;),
            config.getSocket() || config.server.host + &#x27;:&#x27; + config.server.port,
            i18n.t(&#x27;notices.httpServer.urlConfiguredAs&#x27;, {url: config.url}),
            chalk.gray(i18n.t(&#x27;notices.httpServer.ctrlCToShutDown&#x27;))
        );
    }

    function shutdown() {
        console.log(chalk.red(i18n.t(&#x27;notices.httpServer.ghostHasShutdown&#x27;)));
        if (process.env.NODE_ENV === &#x27;production&#x27;) {
            console.log(
                i18n.t(&#x27;notices.httpServer.yourBlogIsNowOffline&#x27;)
            );
        } else {
            console.log(
                i18n.t(&#x27;notices.httpServer.ghostWasRunningFor&#x27;),
                moment.duration(process.uptime(), &#x27;seconds&#x27;).humanize()
            );
        }
        process.exit(0);
    }
    // ensure that Ghost exits correctly on Ctrl+C and SIGTERM
    process.
        removeAllListeners(&#x27;SIGINT&#x27;).on(&#x27;SIGINT&#x27;, shutdown).
        removeAllListeners(&#x27;SIGTERM&#x27;).on(&#x27;SIGTERM&#x27;, shutdown);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
               );
           }
           process.exit(-1);
       });
       self.httpServer.on(&#x27;connection&#x27;, self.connection.bind(self));
       self.httpServer.on(&#x27;listening&#x27;, function () {
           events.emit(&#x27;server:start&#x27;);
           self.<span class="apidocCodeKeywordSpan">logStartMessages</span>();
           resolve(self);
       });
   });
};

/**
* ### Stop
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ghost.ghost_server.prototype.restart" id="apidoc.element.ghost.ghost_server.prototype.restart">
        function <span class="apidocSignatureSpan">ghost.ghost_server.prototype.</span>restart
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">restart = function () {
    return this.stop().then(function (ghostServer) {
        return ghostServer.start();
    });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ghost.ghost_server.prototype.start" id="apidoc.element.ghost.ghost_server.prototype.start">
        function <span class="apidocSignatureSpan">ghost.ghost_server.prototype.</span>start
        <span class="apidocSignatureSpan">(externalApp)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">start = function (externalApp) {
    var self = this,
        rootApp = externalApp ? externalApp : self.rootApp;

    return new Promise(function (resolve) {
        var socketConfig = config.getSocket();

        if (socketConfig) {
            // Make sure the socket is gone before trying to create another
            try {
                fs.unlinkSync(socketConfig.path);
            } catch (e) {
                // We can ignore this.
            }

            self.httpServer = rootApp.listen(socketConfig.path);

            fs.chmod(socketConfig.path, socketConfig.permissions);
        } else {
            self.httpServer = rootApp.listen(
                config.server.port,
                config.server.host
            );
        }

        self.httpServer.on(&#x27;error&#x27;, function (error) {
            if (error.errno === &#x27;EADDRINUSE&#x27;) {
                errors.logError(
                    i18n.t(&#x27;errors.httpServer.addressInUse.error&#x27;),
                    i18n.t(&#x27;errors.httpServer.addressInUse.context&#x27;, {port: config.server.port}),
                    i18n.t(&#x27;errors.httpServer.addressInUse.help&#x27;)
                );
            } else {
                errors.logError(
                    i18n.t(&#x27;errors.httpServer.otherError.error&#x27;, {errorNumber: error.errno}),
                    i18n.t(&#x27;errors.httpServer.otherError.context&#x27;),
                    i18n.t(&#x27;errors.httpServer.otherError.help&#x27;)
                );
            }
            process.exit(-1);
        });
        self.httpServer.on(&#x27;connection&#x27;, self.connection.bind(self));
        self.httpServer.on(&#x27;listening&#x27;, function () {
            events.emit(&#x27;server:start&#x27;);
            self.logStartMessages();
            resolve(self);
        });
    });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
require(&#x27;./core/server/utils/startup-check&#x27;).check();

ghost().then(function (ghostServer) {
    // Mount our Ghost instance on our desired subdirectory path if it exists.
    parentApp.use(ghostServer.config.paths.subdir, ghostServer.rootApp);

    // Let Ghost handle starting our server instance.
    ghostServer.<span class="apidocCodeKeywordSpan">start</span>(parentApp);
}).catch(function (err) {
    errors.logErrorAndExit(err, err.context, err.help);
});
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ghost.ghost_server.prototype.stop" id="apidoc.element.ghost.ghost_server.prototype.stop">
        function <span class="apidocSignatureSpan">ghost.ghost_server.prototype.</span>stop
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">stop = function () {
    var self = this;

    return new Promise(function (resolve) {
        if (self.httpServer === null) {
            resolve(self);
        } else {
            self.httpServer.close(function () {
                self.httpServer = null;
                self.logShutdownMessages();
                resolve(self);
            });

            self.closeConnections();
        }
    });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

/**
* ### Restart
* Restarts the ghost application
* @returns {Promise} Resolves once Ghost has restarted
*/
GhostServer.prototype.restart = function () {
   return this.<span class="apidocCodeKeywordSpan">stop</span>().then(function (ghostServer) {
       return ghostServer.start();
   });
};

/**
* ### Hammertime
* To be called after `stop`
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.ghost.ghost_url" id="apidoc.module.ghost.ghost_url">module ghost.ghost_url</a></h1>


    <h2>
        <a href="#apidoc.element.ghost.ghost_url.init" id="apidoc.element.ghost.ghost_url.init">
        function <span class="apidocSignatureSpan">ghost.ghost_url.</span>init
        <span class="apidocSignatureSpan">(options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">init = function (options) {
    clientId = options.clientId ? options.clientId : &#x27;&#x27;;
    clientSecret = options.clientSecret ? options.clientSecret : &#x27;&#x27;;
    apiUrl = options.url ? options.url : (apiUrl.match(/{\{api-url}}/) ? &#x27;&#x27; : apiUrl);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
// in a &#x22;new&#x22; state.
grunt.registerTask(&#x27;cleanDatabase&#x27;, function () {
    var done = this.async(),
        models    = require(&#x27;./core/server/models&#x27;),
        migration = require(&#x27;./core/server/data/migration&#x27;);

    migration.reset().then(function () {
        models.<span class="apidocCodeKeywordSpan">init</span>();
        return migration.init();
    }).then(function () {
        done();
    }).catch(function (err) {
        grunt.fail.fatal(err.stack);
    });
});
...</pre></li>
    </ul>




</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.ghost.gravatar" id="apidoc.module.ghost.gravatar">module ghost.gravatar</a></h1>


    <h2>
        <a href="#apidoc.element.ghost.gravatar.lookup" id="apidoc.element.ghost.gravatar.lookup">
        function <span class="apidocSignatureSpan">ghost.gravatar.</span>lookup
        <span class="apidocSignatureSpan">(userData, timeout)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function lookup(userData, timeout) {
    var gravatarUrl = &#x27;//www.gravatar.com/avatar/&#x27; +
        crypto.createHash(&#x27;md5&#x27;).update(userData.email.toLowerCase().trim()).digest(&#x27;hex&#x27;) +
        &#x27;?s=250&#x27;;

    return new Promise(function gravatarRequest(resolve) {
        if (config.isPrivacyDisabled(&#x27;useGravatar&#x27;) || process.env.NODE_ENV.indexOf(&#x27;testing&#x27;) &#x3e; -1) {
            return resolve(userData);
        }

        var request, timer, timerEnded = false;

        request = https.get(&#x27;https:&#x27; + gravatarUrl + &#x27;&#x26;d=404&#x26;r=x&#x27;, function (response) {
            clearTimeout(timer);
            if (response.statusCode !== 404 &#x26;&#x26; !timerEnded) {
                gravatarUrl += &#x27;&#x26;d=mm&#x26;r=x&#x27;;
                userData.image = gravatarUrl;
            }

            resolve(userData);
        });

        request.on(&#x27;error&#x27;, function () {
            clearTimeout(timer);
            // just resolve with no image url
            if (!timerEnded) {
                return resolve(userData);
            }
        });

        timer = setTimeout(function () {
            timerEnded = true;
            request.abort();
            return resolve(userData);
        }, timeout || 2000);
    });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
roles = data.roles || getAuthorRole();
delete data.roles;

return generatePasswordHash(userData.password).then(function then(hash) {
    // Assign the hashed password
    userData.password = hash;
    // LookupGravatar
    return gravatar.<span class="apidocCodeKeywordSpan">lookup</span>(userData);
}).then(function then(userData) {
    // Save the user with the hashed password
    return ghostBookshelf.Model.add.call(self, userData, options);
}).then(function then(addedUser) {
    // Assign the userData to our created user so we can pass it back
    userData = addedUser;
    // if we are given a &#x22;role&#x22; object, only pass in the role ID in place of the full object
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.ghost.i18n" id="apidoc.module.ghost.i18n">module ghost.i18n</a></h1>


    <h2>
        <a href="#apidoc.element.ghost.i18n.findString" id="apidoc.element.ghost.i18n.findString">
        function <span class="apidocSignatureSpan">ghost.i18n.</span>findString
        <span class="apidocSignatureSpan">(msgPath)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function findString(msgPath) {
    var matchingString, path;
    // no path? no string
    if (_.isEmpty(msgPath) || !_.isString(msgPath)) {
        chalk.yellow(&#x27;i18n:t() - received an empty path.&#x27;);
        return &#x27;&#x27;;
    }

    if (blos === undefined) {
        I18n.init();
    }

    matchingString = blos;

    path = msgPath.split(&#x27;.&#x27;);
    path.forEach(function (key) {
        // reassign matching object, or set to an empty string if there is no match
        matchingString = matchingString[key] || null;
    });

    if (_.isNull(matchingString)) {
        console.error(&#x27;Unable to find matching path [&#x27; + msgPath + &#x27;] in locale file.\n&#x27;);
        matchingString = &#x27;i18n error: path &#x22;&#x27; + msgPath + &#x27;&#x22; was not found.&#x27;;
    }

    return matchingString;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
     * Helper method to find and compile the given data context with a proper string resource.
     *
     * @param {string} path Path with in the JSON language file to desired string (ie: &#x22;errors.init.jsNotBuilt&#x22;)
     * @param {object} [bindings]
     * @returns {string}
     */
    t: function t(path, bindings) {
var string = I18n.<span class="apidocCodeKeywordSpan">findString</span>(path),
    msg;

// If the path returns an array (as in the case with anything that has multiple paragraphs such as emails), then
// loop through them and return an array of translated/formatted strings. Otherwise, just return the normal
// translated/formatted string.
if (_.isArray(string)) {
    msg = [];
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ghost.i18n.init" id="apidoc.element.ghost.i18n.init">
        function <span class="apidocSignatureSpan">ghost.i18n.</span>init
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function init() {
    // read file for current locale and keep its content in memory
    blos = fs.readFileSync(__dirname + &#x27;/translations/&#x27; + currentLocale + &#x27;.json&#x27;);

    // if translation file is not valid, you will see an error
    try {
        blos = JSON.parse(blos);
    } catch (err) {
        blos = undefined;
        throw err;
    }

    if (global.Intl) {
        // Determine if the built-in `Intl` has the locale data we need.
        var hasBuiltInLocaleData,
            IntlPolyfill;

        hasBuiltInLocaleData = supportedLocales.every(function (locale) {
            return Intl.NumberFormat.supportedLocalesOf(locale)[0] === locale &#x26;&#x26;
                Intl.DateTimeFormat.supportedLocalesOf(locale)[0] === locale;
        });

        if (!hasBuiltInLocaleData) {
            // `Intl` exists, but it doesn&#x27;t have the data we need, so load the
            // polyfill and replace the constructors with need with the polyfill&#x27;s.
            IntlPolyfill = require(&#x27;intl&#x27;);
            Intl.NumberFormat   = IntlPolyfill.NumberFormat;
            Intl.DateTimeFormat = IntlPolyfill.DateTimeFormat;
        }
    } else {
        // No `Intl`, so use and load the polyfill.
        global.Intl = require(&#x27;intl&#x27;);
    }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
// in a &#x22;new&#x22; state.
grunt.registerTask(&#x27;cleanDatabase&#x27;, function () {
    var done = this.async(),
        models    = require(&#x27;./core/server/models&#x27;),
        migration = require(&#x27;./core/server/data/migration&#x27;);

    migration.reset().then(function () {
        models.<span class="apidocCodeKeywordSpan">init</span>();
        return migration.init();
    }).then(function () {
        done();
    }).catch(function (err) {
        grunt.fail.fatal(err.stack);
    });
});
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ghost.i18n.t" id="apidoc.element.ghost.i18n.t">
        function <span class="apidocSignatureSpan">ghost.i18n.</span>t
        <span class="apidocSignatureSpan">(path, bindings)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function t(path, bindings) {
    var string = I18n.findString(path),
        msg;

    // If the path returns an array (as in the case with anything that has multiple paragraphs such as emails), then
    // loop through them and return an array of translated/formatted strings. Otherwise, just return the normal
    // translated/formatted string.
    if (_.isArray(string)) {
        msg = [];
        string.forEach(function (s) {
            var m = new MessageFormat(s, currentLocale);

            msg.push(m.format(bindings));
        });
    } else {
        msg = new MessageFormat(string, currentLocale);
        msg = msg.format(bindings);
    }

    return msg;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
        config.server.host
    );
}

self.httpServer.on(&#x27;error&#x27;, function (error) {
    if (error.errno === &#x27;EADDRINUSE&#x27;) {
        errors.logError(
            i18n.<span class="apidocCodeKeywordSpan">t</span>(&#x27;errors.httpServer.addressInUse.error&#x27;),
            i18n.t(&#x27;errors.httpServer.addressInUse.context&#x27;, {port: config.server.port}),
            i18n.t(&#x27;errors.httpServer.addressInUse.help&#x27;)
        );
    } else {
        errors.logError(
            i18n.t(&#x27;errors.httpServer.otherError.error&#x27;, {errorNumber: error.errno}),
            i18n.t(&#x27;errors.httpServer.otherError.context&#x27;),
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.ghost.image_size_from_url" id="apidoc.module.ghost.image_size_from_url">module ghost.image_size_from_url</a></h1>


    <h2>
        <a href="#apidoc.element.ghost.image_size_from_url.getImageSizeFromUrl" id="apidoc.element.ghost.image_size_from_url.getImageSizeFromUrl">
        function <span class="apidocSignatureSpan">ghost.image_size_from_url.</span>getImageSizeFromUrl
        <span class="apidocSignatureSpan">(imagePath)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function getImageSizeFromUrl(imagePath) {
    return new Promise(function imageSizeRequest(resolve, reject) {
        var imageObject = {},
            options,
            timeout = config.times.getImageSizeTimeoutInMS || 10000;

        imageObject.url = imagePath;

        // check if we got an url without any protocol
        if (imagePath.indexOf(&#x27;http&#x27;) === -1) {
            // our gravatar urls start with &#x27;//&#x27; in that case add &#x27;http:&#x27;
            if (imagePath.indexOf(&#x27;//&#x27;) === 0) {
                // it&#x27;s a gravatar url
                imagePath = &#x27;http:&#x27; + imagePath;
            } else {
                // get absolute url for image
                imagePath = config.urlFor(&#x27;image&#x27;, {image: imagePath}, true);
            }
        }

        options = url.parse(imagePath);

        requestHandler = imagePath.indexOf(&#x27;https&#x27;) === 0 ? https : http;
        options.headers = {&#x27;User-Agent&#x27;: &#x27;Mozilla/5.0&#x27;};

        request = requestHandler.get(options, function (res) {
            var chunks = [];

            res.on(&#x27;data&#x27;, function (chunk) {
                chunks.push(chunk);
            });

            res.on(&#x27;end&#x27;, function () {
                if (res.statusCode === 200) {
                    try {
                        dimensions = sizeOf(Buffer.concat(chunks));

                        imageObject.width = dimensions.width;
                        imageObject.height = dimensions.height;

                        return resolve(imageObject);
                    } catch (err) {
                        err.context = imagePath;

                        return reject(err);
                    }
                } else {
                    var err = new Error();

                    if (res.statusCode === 404) {
                        err.message = &#x27;Image not found.&#x27;;
                    } else {
                        err.message = &#x27;Unknown Request error.&#x27;;
                    }

                    err.context = imagePath;
                    err.statusCode = res.statusCode;

                    return reject(err);
                }
            });
        }).on(&#x27;socket&#x27;, function (socket) {
            if (timeout) {
                socket.setTimeout(timeout);

<span class="apidocCodeCommentSpan">                /**
                 * https://nodejs.org/api/http.html
                 * &#x22;...if a callback is assigned to the Server&#x27;s &#x27;timeout&#x27; event, timeouts must be handled explicitly&#x22;
                 *
                 * socket.destroy will jump to the error listener
                 */
</span>                socket.on(&#x27;timeout&#x27;, function () {
                    request.abort();
                    socket.destroy(new Error(&#x27;Request timed out.&#x27;));
                });
            }
        }).on(&#x27;error&#x27;, function (err) {
            err.context = imagePath;

            return reject(err);
        });
    });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.ghost.labs" id="apidoc.module.ghost.labs">module ghost.labs</a></h1>


    <h2>
        <a href="#apidoc.element.ghost.labs.subscribers" id="apidoc.element.ghost.labs.subscribers">
        function <span class="apidocSignatureSpan">ghost.labs.</span>subscribers
        <span class="apidocSignatureSpan">(req, res, next)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function subscribers(req, res, next) {
    if (labsUtil.isSet(&#x27;subscribers&#x27;) === true) {
        return next();
    } else {
        return errors.handleAPIError(new errors.NotFoundError(), req, res, next);
    }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.ghost.loader" id="apidoc.module.ghost.loader">module ghost.loader</a></h1>


    <h2>
        <a href="#apidoc.element.ghost.loader.activateAppByName" id="apidoc.element.ghost.loader.activateAppByName">
        function <span class="apidocSignatureSpan">ghost.loader.</span>activateAppByName
        <span class="apidocSignatureSpan">(name)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">activateAppByName = function (name) {
    var perms = new AppPermissions(getAppAbsolutePath(name));

    return perms.read().then(function (appPerms) {
        var appInfo = getAppByName(name, appPerms),
            app = appInfo.app,
            appProxy = appInfo.proxy;

        // Check for an activate() method on the app.
        if (!_.isFunction(app.activate)) {
            return Promise.reject(new Error(i18n.t(&#x27;errors.apps.noActivateMethodLoadingApp.error&#x27;, {name: name})));
        }

        // Wrapping the activate() with a when because it&#x27;s possible
        // to not return a promise from it.
        return Promise.resolve(app.activate(appProxy)).return(app);
    });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ghost.loader.installAppByName" id="apidoc.element.ghost.loader.installAppByName">
        function <span class="apidocSignatureSpan">ghost.loader.</span>installAppByName
        <span class="apidocSignatureSpan">(name)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">installAppByName = function (name) {
    // Install the apps dependencies first
    var appPath = getAppAbsolutePath(name),
        deps = new AppDependencies(appPath);

    return deps.install()
        .then(function () {
            // Load app permissions
            var perms = new AppPermissions(appPath);

            return perms.read().catch(function (err) {
                // Provide a helpful error about which app
                return Promise.reject(new Error(i18n.t(&#x27;errors.apps.permissionsErrorLoadingApp.error&#x27;, {name: name, message: err
.message})));
            });
        })
        .then(function (appPerms) {
            var appInfo = getAppByName(name, appPerms),
                app = appInfo.app,
                appProxy = appInfo.proxy;

            // Check for an install() method on the app.
            if (!_.isFunction(app.install)) {
                return Promise.reject(new Error(i18n.t(&#x27;errors.apps.noInstallMethodLoadingApp.error&#x27;, {name: name})));
            }

            // Run the app.install() method
            // Wrapping the install() with a when because it&#x27;s possible
            // to not return a promise from it.
            return Promise.resolve(app.install(appProxy)).return(app);
        });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.ghost.local_file_store" id="apidoc.module.ghost.local_file_store">module ghost.local_file_store</a></h1>


    <h2>
        <a href="#apidoc.element.ghost.local_file_store.local_file_store" id="apidoc.element.ghost.local_file_store.local_file_store">
        function <span class="apidocSignatureSpan">ghost.</span>local_file_store
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function LocalFileStore() {
    BaseStore.call(this);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ghost.local_file_store.super_" id="apidoc.element.ghost.local_file_store.super_">
        function <span class="apidocSignatureSpan">ghost.local_file_store.</span>super_
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function StorageBase() {
    Object.defineProperty(this, &#x27;requiredFns&#x27;, {
        value: [&#x27;exists&#x27;, &#x27;save&#x27;, &#x27;serve&#x27;, &#x27;delete&#x27;],
        writable: false
    });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.ghost.local_file_store.prototype" id="apidoc.module.ghost.local_file_store.prototype">module ghost.local_file_store.prototype</a></h1>


    <h2>
        <a href="#apidoc.element.ghost.local_file_store.prototype.delete" id="apidoc.element.ghost.local_file_store.prototype.delete">
        function <span class="apidocSignatureSpan">ghost.local_file_store.prototype.</span>delete
        <span class="apidocSignatureSpan">(fileName, targetDir)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">delete = function (fileName, targetDir) {
    targetDir = targetDir || this.getTargetDir(config.paths.imagesPath);

    var pathToDelete = path.join(targetDir, fileName);
    return remove(pathToDelete);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
})
.then(function () {
    return storageAdapter.exists(config.paths.themePath + &#x27;/&#x27; + zip.shortName);
})
.then(function (themeExists) {
    // delete existing theme
    if (themeExists) {
        return storageAdapter.<span class="apidocCodeKeywordSpan">delete</span>(zip.shortName, config.paths.themePath);
    }
})
.then(function () {
    events.emit(&#x27;theme.uploaded&#x27;, zip.shortName);
    // store extracted theme
    return storageAdapter.save({
        name: zip.shortName,
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ghost.local_file_store.prototype.exists" id="apidoc.element.ghost.local_file_store.prototype.exists">
        function <span class="apidocSignatureSpan">ghost.local_file_store.prototype.</span>exists
        <span class="apidocSignatureSpan">(filename)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">exists = function (filename) {
    return new Promise(function (resolve) {
        fs.stat(filename, function (err) {
            var exists = !err;
            resolve(exists);
        });
    });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

    throw new errors.ThemeValidationError(
        i18n.t(&#x27;errors.api.themes.invalidTheme&#x27;),
        theme.results.error
    );
})
.then(function () {
    return storageAdapter.<span class="apidocCodeKeywordSpan">exists</span>(config.paths.themePath + &#x27;/&#x27; + zip.shortName
);
})
.then(function (themeExists) {
    // delete existing theme
    if (themeExists) {
        return storageAdapter.delete(zip.shortName, config.paths.themePath);
    }
})
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ghost.local_file_store.prototype.save" id="apidoc.element.ghost.local_file_store.prototype.save">
        function <span class="apidocSignatureSpan">ghost.local_file_store.prototype.</span>save
        <span class="apidocSignatureSpan">(image, targetDir)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">save = function (image, targetDir) {
    targetDir = targetDir || this.getTargetDir(config.paths.imagesPath);
    var targetFilename;

    return this.getUniqueFileName(this, image, targetDir).then(function (filename) {
        targetFilename = filename;
        return Promise.promisify(fs.mkdirs)(targetDir);
    }).then(function () {
        return Promise.promisify(fs.copy)(image.path, targetFilename);
    }).then(function () {
        // The src for the image must be in URI format, not a file system path, which in Windows uses \
        // For local file system storage can use relative path so add a slash
        var fullUrl = (config.paths.subdir + &#x27;/&#x27; + config.paths.imagesRelPath + &#x27;/&#x27; +
        path.relative(config.paths.imagesPath, targetFilename)).replace(new RegExp(&#x27;\\&#x27; + path.sep, &#x27;g&#x27;), &#x27;/&#x27;);
        return fullUrl;
    }).catch(function (e) {
        errors.logError(e);
        return Promise.reject(e);
    });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    if (themeExists) {
        return storageAdapter.delete(zip.shortName, config.paths.themePath);
    }
})
.then(function () {
    events.emit(&#x27;theme.uploaded&#x27;, zip.shortName);
    // store extracted theme
    return storageAdapter.<span class="apidocCodeKeywordSpan">save</span>({
        name: zip.shortName,
        path: theme.path
    }, config.paths.themePath);
})
.then(function () {
    // force reload of availableThemes
    // right now the logic is in the ConfigManager
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ghost.local_file_store.prototype.serve" id="apidoc.element.ghost.local_file_store.prototype.serve">
        function <span class="apidocSignatureSpan">ghost.local_file_store.prototype.</span>serve
        <span class="apidocSignatureSpan">(options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">serve = function (options) {
    options = options || {};

    // CASE: serve themes
    // serveStatic can&#x27;t be used to serve themes, because
    // download files depending on the route (see `send` npm module)
    if (options.isTheme) {
        return function downloadTheme(req, res, next) {
            var themeName = options.name,
                themePath = path.join(config.paths.themePath, themeName),
                zipName = themeName + &#x27;.zip&#x27;,
                // store this in a unique temporary folder
                zipBasePath = path.join(os.tmpdir(), utils.uid(10)),
                zipPath = path.join(zipBasePath, zipName),
                stream;

            Promise.promisify(fs.ensureDir)(zipBasePath)
                .then(function () {
                    return Promise.promisify(utils.zipFolder)(themePath, zipPath);
                })
                .then(function (length) {
                    res.set({
                        &#x27;Content-disposition&#x27;: &#x27;attachment; filename={themeName}.zip&#x27;.replace(&#x27;{themeName}&#x27;, themeName),
                        &#x27;Content-Type&#x27;: &#x27;application/zip&#x27;,
                        &#x27;Content-Length&#x27;: length
                    });

                    stream = fs.createReadStream(zipPath);
                    stream.pipe(res);
                })
                .catch(function (err) {
                    next(err);
                })
                .finally(function () {
                    remove(zipBasePath);
                });
        };
    } else {
        // CASE: serve images
        // For some reason send divides the max age number by 1000
        // Fallthrough: false ensures that if an image isn&#x27;t found, it automatically 404s
        return serveStatic(config.paths.imagesPath, {maxAge: utils.ONE_YEAR_MS, fallthrough: false});
    }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    if (!theme) {
        return Promise.reject(new errors.BadRequestError(i18n.t(&#x27;errors.api.themes.invalidRequest&#x27;)));
    }

    return utils.handlePermissions(&#x27;themes&#x27;, &#x27;read&#x27;)(options)
        .then(function () {
            events.emit(&#x27;theme.downloaded&#x27;, themeName);
            return storageAdapter.<span class="apidocCodeKeywordSpan">serve</span>({isTheme: true, name: themeName});
        });
},

/**
 * remove theme zip
 * remove theme folder
 */
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.ghost.mail" id="apidoc.module.ghost.mail">module ghost.mail</a></h1>


    <h2>
        <a href="#apidoc.element.ghost.mail.send" id="apidoc.element.ghost.mail.send">
        function <span class="apidocSignatureSpan">ghost.mail.</span>send
        <span class="apidocSignatureSpan">(object, options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">send = function (object, options) {
    var tasks;

<span class="apidocCodeCommentSpan">    /**
     * ### Format Response
     * @returns {Mail} mail
     */
</span>
    function formatResponse(data) {
        delete object.mail[0].options;
        // Sendmail returns extra details we don&#x27;t need and that don&#x27;t convert to JSON
        delete object.mail[0].message.transport;
        object.mail[0].status = {
            message: data.message
        };

        return object;
    }

    /**
     * ### Send Mail
     */

    function send() {
        return sendMail(object, options);
    }

    tasks = [
        utils.handlePermissions(docName, &#x27;send&#x27;),
        send,
        formatResponse
    ];

    return pipeline(tasks, options || {});
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
                    html: content.html,
                    text: content.text
                },
                options: {}
            }]
        };

        return apiMail.<span class="apidocCodeKeywordSpan">send</span>(payload, {context: {internal: true}});
    });
}

function formatResponse() {
    return {
        passwordreset: [
            {message: i18n.t(&#x27;common.api.authentication.mail.checkEmailForInstructions&#x27;)}
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ghost.mail.sendTest" id="apidoc.element.ghost.mail.sendTest">
        function <span class="apidocSignatureSpan">ghost.mail.</span>sendTest
        <span class="apidocSignatureSpan">(options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">sendTest = function (options) {
    var tasks;

<span class="apidocCodeCommentSpan">    /**
     * ### Model Query
     */
</span>
    function modelQuery() {
        return Models.User.findOne({id: options.context.user});
    }

    /**
     * ### Generate content
     */

    function generateContent(result) {
        return mail.utils.generateContent({template: &#x27;test&#x27;}).then(function (content) {
            var payload = {
                mail: [{
                    message: {
                        to: result.get(&#x27;email&#x27;),
                        subject: i18n.t(&#x27;common.api.mail.testGhostEmail&#x27;),
                        html: content.html,
                        text: content.text
                    }
                }]
            };

            return payload;
        });
    }

    /**
     * ### Send mail
     */

    function send(payload) {
        return sendMail(payload, options);
    }

    tasks = [
        modelQuery,
        generateContent,
        send
    ];

    return pipeline(tasks);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.ghost.notifications" id="apidoc.module.ghost.notifications">module ghost.notifications</a></h1>


    <h2>
        <a href="#apidoc.element.ghost.notifications.add" id="apidoc.element.ghost.notifications.add">
        function <span class="apidocSignatureSpan">ghost.notifications.</span>add
        <span class="apidocSignatureSpan">(object, options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function add(object, options) {
    var tasks;

<span class="apidocCodeCommentSpan">    /**
     * ### Handle Permissions
     * We need to be an authorised user to perform this action
     * @param {Object} options
     * @returns {Object} options
     */
</span>    function handlePermissions(options) {
        if (permissions.parseContext(options.context).internal) {
            return Promise.resolve(options);
        }

        return canThis(options.context).add.notification().then(function () {
            return options;
        }, function () {
            return Promise.reject(new errors.NoPermissionError(i18n.t(&#x27;errors.api.notifications.noPermissionToAddNotif&#x27;)));
        });
    }

    /**
     * ### Save Notifications
     * Save the notifications
     * @param {Object} options
     * @returns {Object} options
     */
    function saveNotifications(options) {
        var defaults = {
                dismissible: true,
                location: &#x27;bottom&#x27;,
                status: &#x27;alert&#x27;
            },
            addedNotifications = [], existingNotification;

        _.each(options.data.notifications, function (notification) {
            notificationCounter = notificationCounter + 1;

            notification = _.assign(defaults, notification, {
                id: notificationCounter
            });

            existingNotification = _.find(notificationsStore, {message:notification.message});

            if (!existingNotification) {
                notificationsStore.push(notification);
                addedNotifications.push(notification);
            } else {
                addedNotifications.push(existingNotification);
            }
        });

        return addedNotifications;
    }

    tasks = [
        utils.validate(&#x27;notifications&#x27;),
        handlePermissions,
        saveNotifications
    ];

    return pipeline(tasks, object, options).then(function formatResponse(result) {
        return {notifications: result};
    });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
getSeenNotifications = api.settings.read(_.extend({key: &#x27;seenNotifications&#x27;}, internal));

return Promise.join(getAllNotifications, getSeenNotifications, function joined(all, seen) {
    var isSeen      = _.includes(JSON.parse(seen.settings[0].value || []), notification.uuid),
        isDuplicate = _.some(all.notifications, {message: notification.message});

    if (!isSeen &#x26;&#x26; !isDuplicate) {
        return api.notifications.<span class="apidocCodeKeywordSpan">add</span>({notifications: [notification]}, {context: {internal
: true}});
    }
});
}

function updateCheckData() {
var data = {},
    mailConfig = config.mail;
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ghost.notifications.browse" id="apidoc.element.ghost.notifications.browse">
        function <span class="apidocSignatureSpan">ghost.notifications.</span>browse
        <span class="apidocSignatureSpan">(options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function browse(options) {
    return canThis(options.context).browse.notification().then(function () {
        return {notifications: notificationsStore};
    }, function () {
        return Promise.reject(new errors.NoPermissionError(i18n.t(&#x27;errors.api.notifications.noPermissionToBrowseNotif&#x27;)));
    });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
status: &#x27;alert&#x27;,
type: &#x27;info&#x27;,
custom: true,
uuid: message.id,
dismissible: true,
message: message.content
    },
    getAllNotifications = api.notifications.<span class="apidocCodeKeywordSpan">browse</span>({context: {internal: true}}),
    getSeenNotifications = api.settings.read(_.extend({key: &#x27;seenNotifications&#x27;}, internal));

    return Promise.join(getAllNotifications, getSeenNotifications, function joined(all, seen) {
var isSeen      = _.includes(JSON.parse(seen.settings[0].value || []), notification.uuid),
    isDuplicate = _.some(all.notifications, {message: notification.message});

if (!isSeen &#x26;&#x26; !isDuplicate) {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ghost.notifications.destroy" id="apidoc.element.ghost.notifications.destroy">
        function <span class="apidocSignatureSpan">ghost.notifications.</span>destroy
        <span class="apidocSignatureSpan">(options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function destroy(options) {
    var tasks;

<span class="apidocCodeCommentSpan">    /**
     * Adds the uuid of notification to &#x22;seenNotifications&#x22; array.
     * @param {Object} notification
     * @return {*|Promise}
     */
</span>    function markAsSeen(notification) {
        var context = {internal: true};
        return settings.read({key: &#x27;seenNotifications&#x27;, context: context}).then(function then(response) {
            var seenNotifications = JSON.parse(response.settings[0].value);
            seenNotifications = _.uniqBy(seenNotifications.concat([notification.uuid]));
            return settings.edit({settings: [{key: &#x27;seenNotifications&#x27;, value: seenNotifications}]}, {context: context});
        });
    }

    /**
     * ### Handle Permissions
     * We need to be an authorised user to perform this action
     * @param {Object} options
     * @returns {Object} options
     */
    function handlePermissions(options) {
        return canThis(options.context).destroy.notification().then(function () {
            return options;
        }, function () {
            return Promise.reject(new errors.NoPermissionError(i18n.t(&#x27;errors.api.notifications.noPermissionToDestroyNotif&#x27;)));
        });
    }

    function destroyNotification(options) {
        var notification = _.find(notificationsStore, function (element) {
            return element.id === parseInt(options.id, 10);
        });

        if (notification &#x26;&#x26; !notification.dismissible) {
            return Promise.reject(
                new errors.NoPermissionError(i18n.t(&#x27;errors.api.notifications.noPermissionToDismissNotif&#x27;))
            );
        }

        if (!notification) {
            return Promise.reject(new errors.NotFoundError(i18n.t(&#x27;errors.api.notifications.notificationDoesNotExist&#x27;)));
        }

        notificationsStore = _.reject(notificationsStore, function (element) {
            return element.id === parseInt(options.id, 10);
        });
        notificationCounter = notificationCounter - 1;

        if (notification.custom) {
            return markAsSeen(notification);
        }
    }

    tasks = [
        utils.validate(&#x27;notifications&#x27;, {opts: utils.idDefaultOptions}),
        handlePermissions,
        destroyNotification
    ];

    return pipeline(tasks, options);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
GhostServer.prototype.closeConnections = function () {
   var self = this;

   Object.keys(self.connections).forEach(function (socketId) {
       var socket = self.connections[socketId];

       if (socket) {
           socket.<span class="apidocCodeKeywordSpan">destroy</span>();
       }
   });
};

/**
* ### Log Start Messages
*/
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ghost.notifications.destroyAll" id="apidoc.element.ghost.notifications.destroyAll">
        function <span class="apidocSignatureSpan">ghost.notifications.</span>destroyAll
        <span class="apidocSignatureSpan">(options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function destroyAll(options) {
    return canThis(options.context).destroy.notification().then(function () {
        notificationsStore = [];
        notificationCounter = 0;

        return notificationsStore;
    }, function () {
        return Promise.reject(new errors.NoPermissionError(i18n.t(&#x27;errors.api.notifications.noPermissionToDestroyNotif&#x27;)));
    });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.ghost.oauth" id="apidoc.module.ghost.oauth">module ghost.oauth</a></h1>


    <h2>
        <a href="#apidoc.element.ghost.oauth.generateAccessToken" id="apidoc.element.ghost.oauth.generateAccessToken">
        function <span class="apidocSignatureSpan">ghost.oauth.</span>generateAccessToken
        <span class="apidocSignatureSpan">(req, res, next)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function generateAccessToken(req, res, next) {
    // @TODO: see https://github.com/jaredhanson/oauth2orize/issues/182
    req.authInfo = {
        accessToken: getBearerAutorizationHeader(req)
    };

    return oauthServer.token()(req, res, next);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ghost.oauth.init" id="apidoc.element.ghost.oauth.init">
        function <span class="apidocSignatureSpan">ghost.oauth.</span>init
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function init() {
    oauthServer = oauth2orize.createServer();
    // remove all expired accesstokens on startup
    models.Accesstoken.destroyAllExpired();

    // remove all expired refreshtokens on startup
    models.Refreshtoken.destroyAllExpired();

    // Exchange user id and password for access tokens.  The callback accepts the
    // `client`, which is exchanging the user&#x27;s name and password from the
    // authorization request for verification. If these values are validated, the
    // application issues an access token on behalf of the user who authorized the code.
    oauthServer.exchange(oauth2orize.exchange.password({userProperty: &#x27;client&#x27;},
        exchangePassword));

    // Exchange the refresh token to obtain an access token.  The callback accepts the
    // `client`, which is exchanging a `refreshToken` previously issued by the server
    // for verification. If these values are validated, the application issues an
    // access token on behalf of the user who authorized the code.
    oauthServer.exchange(oauth2orize.exchange.refreshToken({userProperty: &#x27;client&#x27;},
        exchangeRefreshToken));
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
// in a &#x22;new&#x22; state.
grunt.registerTask(&#x27;cleanDatabase&#x27;, function () {
    var done = this.async(),
        models    = require(&#x27;./core/server/models&#x27;),
        migration = require(&#x27;./core/server/data/migration&#x27;);

    migration.reset().then(function () {
        models.<span class="apidocCodeKeywordSpan">init</span>();
        return migration.init();
    }).then(function () {
        done();
    }).catch(function (err) {
        grunt.fail.fatal(err.stack);
    });
});
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.ghost.page_url" id="apidoc.module.ghost.page_url">module ghost.page_url</a></h1>


    <h2>
        <a href="#apidoc.element.ghost.page_url.page_url" id="apidoc.element.ghost.page_url.page_url">
        function <span class="apidocSignatureSpan">ghost.</span>page_url
        <span class="apidocSignatureSpan">(page, options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">page_url = function (page, options) {
    if (!options) {
        options = page;
        page = 1;
    }
    return getPaginatedUrl(page, options.data.root);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ghost.page_url.deprecated" id="apidoc.element.ghost.page_url.deprecated">
        function <span class="apidocSignatureSpan">ghost.page_url.</span>deprecated
        <span class="apidocSignatureSpan">(pageNum, options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">deprecated = function (pageNum, options) {
    errors.logWarn(i18n.t(&#x27;warnings.helpers.page_url.isDeprecated&#x27;));

<span class="apidocCodeCommentSpan">    /*jshint unused:false*/
</span>    var self = this;

    return page_url.call(self, pageNum, options);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.ghost.permission" id="apidoc.module.ghost.permission">module ghost.permission</a></h1>


    <h2>
        <a href="#apidoc.element.ghost.permission.Permission" id="apidoc.element.ghost.permission.Permission">
        function <span class="apidocSignatureSpan">ghost.permission.</span>Permission
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">Permission = function () {
  return Parent.apply(this, arguments);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ghost.permission.Permissions" id="apidoc.element.ghost.permission.Permissions">
        function <span class="apidocSignatureSpan">ghost.permission.</span>Permissions
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">Permissions = function () {
  return Parent.apply(this, arguments);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.ghost.permissions" id="apidoc.module.ghost.permissions">module ghost.permissions</a></h1>


    <h2>
        <a href="#apidoc.element.ghost.permissions.permissions" id="apidoc.element.ghost.permissions.permissions">
        function <span class="apidocSignatureSpan">ghost.</span>permissions
        <span class="apidocSignatureSpan">(appPath)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function AppPermissions(appPath) {
    this.appPath = appPath;
    this.packagePath = path.join(this.appPath, &#x27;package.json&#x27;);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>




</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.ghost.permissions.prototype" id="apidoc.module.ghost.permissions.prototype">module ghost.permissions.prototype</a></h1>


    <h2>
        <a href="#apidoc.element.ghost.permissions.prototype.checkPackageContentsExists" id="apidoc.element.ghost.permissions.prototype.checkPackageContentsExists">
        function <span class="apidocSignatureSpan">ghost.permissions.prototype.</span>checkPackageContentsExists
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">checkPackageContentsExists = function () {
    var self = this;

    // Mostly just broken out for stubbing in unit tests
    return new Promise(function (resolve) {
        fs.stat(self.packagePath, function (err) {
            var exists = !err;
            resolve(exists);
        });
    });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    this.appPath = appPath;
    this.packagePath = path.join(this.appPath, &#x27;package.json&#x27;);
}

AppPermissions.prototype.read = function () {
    var self = this;

    return this.<span class="apidocCodeKeywordSpan">checkPackageContentsExists</span>().then(function (exists) {
if (!exists) {
    // If no package.json, return default permissions
    return Promise.resolve(AppPermissions.DefaultPermissions);
}

// Read and parse the package.json
return self.getPackageContents().then(function (parsed) {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ghost.permissions.prototype.getPackageContents" id="apidoc.element.ghost.permissions.prototype.getPackageContents">
        function <span class="apidocSignatureSpan">ghost.permissions.prototype.</span>getPackageContents
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">getPackageContents = function () {
    return parsePackageJson(this.packagePath);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    return this.checkPackageContentsExists().then(function (exists) {
        if (!exists) {
// If no package.json, return default permissions
return Promise.resolve(AppPermissions.DefaultPermissions);
        }

        // Read and parse the package.json
        return self.<span class="apidocCodeKeywordSpan">getPackageContents</span>().then(function (parsed) {
// If no permissions in the package.json then return the default permissions.
if (!(parsed.ghost &#x26;&#x26; parsed.ghost.permissions)) {
    return Promise.resolve(AppPermissions.DefaultPermissions);
}

// TODO: Validation on permissions object?
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ghost.permissions.prototype.read" id="apidoc.element.ghost.permissions.prototype.read">
        function <span class="apidocSignatureSpan">ghost.permissions.prototype.</span>read
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">read = function () {
    var self = this;

    return this.checkPackageContentsExists().then(function (exists) {
        if (!exists) {
            // If no package.json, return default permissions
            return Promise.resolve(AppPermissions.DefaultPermissions);
        }

        // Read and parse the package.json
        return self.getPackageContents().then(function (parsed) {
            // If no permissions in the package.json then return the default permissions.
            if (!(parsed.ghost &#x26;&#x26; parsed.ghost.permissions)) {
                return Promise.resolve(AppPermissions.DefaultPermissions);
            }

            // TODO: Validation on permissions object?

            return Promise.resolve(parsed.ghost.permissions);
        });
    });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    xmlrpc = require(&#x27;./data/xml/xmlrpc&#x27;),
    slack = require(&#x27;./data/slack&#x27;),
    GhostServer = require(&#x27;./ghost-server&#x27;),
    scheduling = require(&#x27;./scheduling&#x27;),
    dbHash;

function initDbHashAndFirstRun() {
    return api.settings.<span class="apidocCodeKeywordSpan">read</span>({key: &#x27;dbHash&#x27;, context: {internal: true}}).then
(function (response) {
var hash = response.settings[0].value,
    initHash;

dbHash = hash;

if (dbHash === null) {
    initHash = uuid.v4();
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.ghost.post" id="apidoc.module.ghost.post">module ghost.post</a></h1>


    <h2>
        <a href="#apidoc.element.ghost.post.Post" id="apidoc.element.ghost.post.Post">
        function <span class="apidocSignatureSpan">ghost.post.</span>Post
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">Post = function () {
  return Parent.apply(this, arguments);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ghost.post.Posts" id="apidoc.element.ghost.post.Posts">
        function <span class="apidocSignatureSpan">ghost.post.</span>Posts
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">Posts = function () {
  return Parent.apply(this, arguments);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.ghost.posts" id="apidoc.module.ghost.posts">module ghost.posts</a></h1>


    <h2>
        <a href="#apidoc.element.ghost.posts.add" id="apidoc.element.ghost.posts.add">
        function <span class="apidocSignatureSpan">ghost.posts.</span>add
        <span class="apidocSignatureSpan">(object, options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function add(object, options) {
    var tasks;

<span class="apidocCodeCommentSpan">    /**
     * ### Model Query
     * Make the call to the Model layer
     * @param {Object} options
     * @returns {Object} options
     */
</span>    function modelQuery(options) {
        return dataProvider.Post.add(options.data.posts[0], _.omit(options, [&#x27;data&#x27;]));
    }

    // Push all of our tasks into a `tasks` array in the correct order
    tasks = [
        utils.validate(docName),
        utils.handlePermissions(docName, &#x27;add&#x27;),
        utils.convertOptions(allowedIncludes),
        modelQuery
    ];

    // Pipeline calls each task passing the result of one to be the arguments for the next
    return pipeline(tasks, object, options).then(function formatResponse(result) {
        var post = result.toJSON(options);

        if (post.status === &#x27;published&#x27;) {
            // When creating a new post that is published right now, signal the change
            post.statusChanged = true;
        }
        return {posts: [post]};
    });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
getSeenNotifications = api.settings.read(_.extend({key: &#x27;seenNotifications&#x27;}, internal));

return Promise.join(getAllNotifications, getSeenNotifications, function joined(all, seen) {
    var isSeen      = _.includes(JSON.parse(seen.settings[0].value || []), notification.uuid),
        isDuplicate = _.some(all.notifications, {message: notification.message});

    if (!isSeen &#x26;&#x26; !isDuplicate) {
        return api.notifications.<span class="apidocCodeKeywordSpan">add</span>({notifications: [notification]}, {context: {internal
: true}});
    }
});
}

function updateCheckData() {
var data = {},
    mailConfig = config.mail;
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ghost.posts.browse" id="apidoc.element.ghost.posts.browse">
        function <span class="apidocSignatureSpan">ghost.posts.</span>browse
        <span class="apidocSignatureSpan">(options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function browse(options) {
    var extraOptions = [&#x27;status&#x27;],
        permittedOptions,
        tasks;

    // Workaround to remove static pages from results
    // TODO: rework after https://github.com/TryGhost/Ghost/issues/5151
    if (options &#x26;&#x26; options.context &#x26;&#x26; (options.context.user || options.context.internal)) {
        extraOptions.push(&#x27;staticPages&#x27;);
    }
    permittedOptions = utils.browseDefaultOptions.concat(extraOptions);

<span class="apidocCodeCommentSpan">    /**
     * ### Model Query
     *  Make the call to the Model layer
     * @param {Object} options
     * @returns {Object} options
     */
</span>    function modelQuery(options) {
        return dataProvider.Post.findPage(options);
    }

    // Push all of our tasks into a `tasks` array in the correct order
    tasks = [
        utils.validate(docName, {opts: permittedOptions}),
        utils.handlePublicPermissions(docName, &#x27;browse&#x27;),
        utils.convertOptions(allowedIncludes),
        modelQuery
    ];

    // Pipeline calls each task passing the result of one to be the arguments for the next
    return pipeline(tasks, options);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
status: &#x27;alert&#x27;,
type: &#x27;info&#x27;,
custom: true,
uuid: message.id,
dismissible: true,
message: message.content
    },
    getAllNotifications = api.notifications.<span class="apidocCodeKeywordSpan">browse</span>({context: {internal: true}}),
    getSeenNotifications = api.settings.read(_.extend({key: &#x27;seenNotifications&#x27;}, internal));

    return Promise.join(getAllNotifications, getSeenNotifications, function joined(all, seen) {
var isSeen      = _.includes(JSON.parse(seen.settings[0].value || []), notification.uuid),
    isDuplicate = _.some(all.notifications, {message: notification.message});

if (!isSeen &#x26;&#x26; !isDuplicate) {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ghost.posts.destroy" id="apidoc.element.ghost.posts.destroy">
        function <span class="apidocSignatureSpan">ghost.posts.</span>destroy
        <span class="apidocSignatureSpan">(options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function destroy(options) {
    var tasks;

<span class="apidocCodeCommentSpan">    /**
     * @function deletePost
     * @param  {Object} options
     */
</span>    function deletePost(options) {
        var Post = dataProvider.Post,
            data = _.defaults({status: &#x27;all&#x27;}, options),
            fetchOpts = _.defaults({require: true, columns: &#x27;id&#x27;}, options);

        return Post.findOne(data, fetchOpts).then(function () {
            return Post.destroy(options).return(null);
        }).catch(Post.NotFoundError, function () {
            throw new errors.NotFoundError(i18n.t(&#x27;errors.api.posts.postNotFound&#x27;));
        });
    }

    // Push all of our tasks into a `tasks` array in the correct order
    tasks = [
        utils.validate(docName, {opts: utils.idDefaultOptions}),
        utils.handlePermissions(docName, &#x27;destroy&#x27;),
        utils.convertOptions(allowedIncludes),
        deletePost
    ];

    // Pipeline calls each task passing the result of one to be the arguments for the next
    return pipeline(tasks, options);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
GhostServer.prototype.closeConnections = function () {
   var self = this;

   Object.keys(self.connections).forEach(function (socketId) {
       var socket = self.connections[socketId];

       if (socket) {
           socket.<span class="apidocCodeKeywordSpan">destroy</span>();
       }
   });
};

/**
* ### Log Start Messages
*/
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ghost.posts.edit" id="apidoc.element.ghost.posts.edit">
        function <span class="apidocSignatureSpan">ghost.posts.</span>edit
        <span class="apidocSignatureSpan">(object, options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function edit(object, options) {
    var tasks;

<span class="apidocCodeCommentSpan">    /**
     * ### Model Query
     * Make the call to the Model layer
     * @param {Object} options
     * @returns {Object} options
     */
</span>    function modelQuery(options) {
        return dataProvider.Post.edit(options.data.posts[0], _.omit(options, [&#x27;data&#x27;]));
    }

    // Push all of our tasks into a `tasks` array in the correct order
    tasks = [
        utils.validate(docName, {opts: utils.idDefaultOptions.concat(options.opts || [])}),
        utils.handlePermissions(docName, &#x27;edit&#x27;),
        utils.convertOptions(allowedIncludes),
        modelQuery
    ];

    // Pipeline calls each task passing the result of one to be the arguments for the next
    return pipeline(tasks, object, options).then(function formatResponse(result) {
        if (result) {
            var post = result.toJSON(options);

            // If previously was not published and now is (or vice versa), signal the change
            post.statusChanged = false;
            if (result.updated(&#x27;status&#x27;) !== result.get(&#x27;status&#x27;)) {
                post.statusChanged = true;
            }
            return {posts: [post]};
        }

        return Promise.reject(new errors.NotFoundError(i18n.t(&#x27;errors.api.posts.postNotFound&#x27;)));
    });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
var hash = response.settings[0].value,
    initHash;

dbHash = hash;

if (dbHash === null) {
    initHash = uuid.v4();
    return api.settings.<span class="apidocCodeKeywordSpan">edit</span>({settings: [{key: &#x27;dbHash&#x27;, value: initHash}]}, {
context: {internal: true}})
        .then(function (response) {
            dbHash = response.settings[0].value;
            return dbHash;
            // Use `then` here to do &#x27;first run&#x27; actions
        });
}
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ghost.posts.read" id="apidoc.element.ghost.posts.read">
        function <span class="apidocSignatureSpan">ghost.posts.</span>read
        <span class="apidocSignatureSpan">(options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function read(options) {
    var attrs = [&#x27;id&#x27;, &#x27;slug&#x27;, &#x27;status&#x27;, &#x27;uuid&#x27;],
        tasks;

<span class="apidocCodeCommentSpan">    /**
     * ### Model Query
     * Make the call to the Model layer
     * @param {Object} options
     * @returns {Object} options
     */
</span>    function modelQuery(options) {
        return dataProvider.Post.findOne(options.data, _.omit(options, [&#x27;data&#x27;]));
    }

    // Push all of our tasks into a `tasks` array in the correct order
    tasks = [
        utils.validate(docName, {attrs: attrs, opts: options.opts || []}),
        utils.handlePublicPermissions(docName, &#x27;read&#x27;),
        utils.convertOptions(allowedIncludes),
        modelQuery
    ];

    // Pipeline calls each task passing the result of one to be the arguments for the next
    return pipeline(tasks, options).then(function formatResponse(result) {
        // @TODO make this a formatResponse task?
        if (result) {
            return {posts: [result.toJSON(options)]};
        }

        return Promise.reject(new errors.NotFoundError(i18n.t(&#x27;errors.api.posts.postNotFound&#x27;)));
    });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    xmlrpc = require(&#x27;./data/xml/xmlrpc&#x27;),
    slack = require(&#x27;./data/slack&#x27;),
    GhostServer = require(&#x27;./ghost-server&#x27;),
    scheduling = require(&#x27;./scheduling&#x27;),
    dbHash;

function initDbHashAndFirstRun() {
    return api.settings.<span class="apidocCodeKeywordSpan">read</span>({key: &#x27;dbHash&#x27;, context: {internal: true}}).then
(function (response) {
var hash = response.settings[0].value,
    initHash;

dbHash = hash;

if (dbHash === null) {
    initHash = uuid.v4();
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.ghost.pretty_urls" id="apidoc.module.ghost.pretty_urls">module ghost.pretty_urls</a></h1>


    <h2>
        <a href="#apidoc.element.ghost.pretty_urls.0" id="apidoc.element.ghost.pretty_urls.0">
        function <span class="apidocSignatureSpan">ghost.pretty_urls.</span>0
        <span class="apidocSignatureSpan">( req, res, next )</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function slashes( req, res, next ) {

    if ( &#x22;GET&#x22; == req.method ) {
        // Use originalUrl when defined ( for express compatibility);
        var url = (req.originalUrl || req.url).split( reQuery )
          , location = url[ 0 ]
          , redirect
          , headers;

        if ( append &#x26;&#x26; &#x22;/&#x22; != location[ location.length - 1 ] ) {

            // append slashes
            redirect = location + &#x22;/&#x22;;

        } else if ( !append &#x26;&#x26; &#x22;/&#x22; == location[ location.length - 1 ] &#x26;&#x26; &#x22;/&#x22; != location ) {

            // remove slashes
            redirect = location.slice( 0, location.length - 1 );

        }

        // complete the redirect url
        if ( redirect ) {
            if ( url.length &#x3e; 1 ) {
                redirect += &#x22;?&#x22; + url.slice( 1 ).join( &#x22;&#x26;&#x22; );
            }

            redirect = ( options.base || &#x22;&#x22; ) + redirect; // prepend the base path
            redirect = redirect.replace( reDoubleSlashes, &#x22;/&#x22; ); // see issue #2

            if ( &#x22;/&#x22; != redirect[ 0 ] ) {
                redirect = &#x22;/&#x22; + redirect; // guarantee absolute redirect
            }

            headers = options.headers || {};
            headers[ &#x22;Location&#x22; ] = redirect;

            res.writeHead( options.code || 301, headers );
            res.end();
            return;
        }

    }
    next();

}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ghost.pretty_urls.1" id="apidoc.element.ghost.pretty_urls.1">
        function <span class="apidocSignatureSpan">ghost.pretty_urls.</span>1
        <span class="apidocSignatureSpan">(req, res, next)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function uncapitalise(req, res, next) {
<span class="apidocCodeCommentSpan">    /*jslint unparam:true*/
</span>    var pathToTest = req.path,
        isSignupOrReset = req.path.match(/(\/ghost\/(signup|reset)\/)/i),
        isAPI = req.path.match(/(\/ghost\/api\/v[\d\.]+\/.*?\/)/i),
        redirectPath;

    if (isSignupOrReset) {
        pathToTest = isSignupOrReset[1];
    }

    // Do not lowercase anything after /api/v0.1/ to protect :key/:slug
    if (isAPI) {
        pathToTest = isAPI[1];
    }

    /**
     * In node &#x3c; 0.11.1 req.path is not encoded, afterwards, it is always encoded such that | becomes %7C etc.
     * That encoding isn&#x27;t useful here, as it triggers an extra uncapitalise redirect, so we decode the path first
     */
    if (/[A-Z]/.test(decodeURIComponent(pathToTest))) {
        // Adding baseUrl ensures subdirectories are kept
        redirectPath = (
          (req.baseUrl ? req.baseUrl : &#x27;&#x27;) +
          utils.removeOpenRedirectFromUrl(req.url.replace(pathToTest, pathToTest.toLowerCase()))
        );

        res.set(&#x27;Cache-Control&#x27;, &#x27;public, max-age=&#x27; + utils.ONE_YEAR_S);
        res.redirect(301, redirectPath);
    } else {
        next();
    }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.ghost.read_themes" id="apidoc.module.ghost.read_themes">module ghost.read_themes</a></h1>


    <h2>
        <a href="#apidoc.element.ghost.read_themes.read_themes" id="apidoc.element.ghost.read_themes.read_themes">
        function <span class="apidocSignatureSpan">ghost.</span>read_themes
        <span class="apidocSignatureSpan">(dir)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function readThemes(dir) {
    return packages
        .read.all(dir)
        .then(populateTemplates);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ghost.read_themes.active" id="apidoc.element.ghost.read_themes.active">
        function <span class="apidocSignatureSpan">ghost.read_themes.</span>active
        <span class="apidocSignatureSpan">(dir, name)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function readActiveTheme(dir, name) {
    return packages
        .read.one(dir, name)
        .then(populateTemplates)
        .catch(function () {
            // For now we return an empty object as this is not fatal unless the frontend of the blog is requested
            errors.logWarn(i18n.t(&#x27;errors.middleware.themehandler.missingTheme&#x27;, {theme: name}));
            return {};
        });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.ghost.refreshtoken" id="apidoc.module.ghost.refreshtoken">module ghost.refreshtoken</a></h1>


    <h2>
        <a href="#apidoc.element.ghost.refreshtoken.Refreshtoken" id="apidoc.element.ghost.refreshtoken.Refreshtoken">
        function <span class="apidocSignatureSpan">ghost.refreshtoken.</span>Refreshtoken
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">Refreshtoken = function () {
  return Parent.apply(this, arguments);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ghost.refreshtoken.Refreshtokens" id="apidoc.element.ghost.refreshtoken.Refreshtokens">
        function <span class="apidocSignatureSpan">ghost.refreshtoken.</span>Refreshtokens
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">Refreshtokens = function () {
  return Parent.apply(this, arguments);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.ghost.role" id="apidoc.module.ghost.role">module ghost.role</a></h1>


    <h2>
        <a href="#apidoc.element.ghost.role.Role" id="apidoc.element.ghost.role.Role">
        function <span class="apidocSignatureSpan">ghost.role.</span>Role
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">Role = function () {
  return Parent.apply(this, arguments);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ghost.role.Roles" id="apidoc.element.ghost.role.Roles">
        function <span class="apidocSignatureSpan">ghost.role.</span>Roles
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">Roles = function () {
  return Parent.apply(this, arguments);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.ghost.roles" id="apidoc.module.ghost.roles">module ghost.roles</a></h1>


    <h2>
        <a href="#apidoc.element.ghost.roles.browse" id="apidoc.element.ghost.roles.browse">
        function <span class="apidocSignatureSpan">ghost.roles.</span>browse
        <span class="apidocSignatureSpan">(options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function browse(options) {
    var permittedOptions = [&#x27;permissions&#x27;],
        tasks;

<span class="apidocCodeCommentSpan">    /**
     * ### Model Query
     * Make the call to the Model layer
     * @param {Object} options
     * @returns {Object} options
     */
</span>    function modelQuery(options) {
        return dataProvider.Role.findAll(options);
    }

    // Push all of our tasks into a `tasks` array in the correct order
    tasks = [
        utils.validate(docName, {opts: permittedOptions}),
        utils.handlePermissions(docName, &#x27;browse&#x27;),
        modelQuery
    ];

    // Pipeline calls each task passing the result of one to be the arguments for the next
    return pipeline(tasks, options).then(function formatResponse(results) {
        var roles = results.map(function (r) {
            return r.toJSON();
        });

        if (options.permissions !== &#x27;assign&#x27;) {
            return {roles: roles};
        }

        return Promise.filter(roles.map(function (role) {
            return canThis(options.context).assign.role(role)
                .return(role)
                .catch(function () {});
        }), function (value) {
            return value &#x26;&#x26; value.name !== &#x27;Owner&#x27;;
        }).then(function (roles) {
            return {roles: roles};
        });
    });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
status: &#x27;alert&#x27;,
type: &#x27;info&#x27;,
custom: true,
uuid: message.id,
dismissible: true,
message: message.content
    },
    getAllNotifications = api.notifications.<span class="apidocCodeKeywordSpan">browse</span>({context: {internal: true}}),
    getSeenNotifications = api.settings.read(_.extend({key: &#x27;seenNotifications&#x27;}, internal));

    return Promise.join(getAllNotifications, getSeenNotifications, function joined(all, seen) {
var isSeen      = _.includes(JSON.parse(seen.settings[0].value || []), notification.uuid),
    isDuplicate = _.some(all.notifications, {message: notification.message});

if (!isSeen &#x26;&#x26; !isDuplicate) {
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.ghost.sandbox" id="apidoc.module.ghost.sandbox">module ghost.sandbox</a></h1>


    <h2>
        <a href="#apidoc.element.ghost.sandbox.sandbox" id="apidoc.element.ghost.sandbox.sandbox">
        function <span class="apidocSignatureSpan">ghost.</span>sandbox
        <span class="apidocSignatureSpan">(opts)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function AppSandbox(opts) {
    this.opts = _.defaults(opts || {}, AppSandbox.defaults);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>




</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.ghost.sandbox.prototype" id="apidoc.module.ghost.sandbox.prototype">module ghost.sandbox.prototype</a></h1>


    <h2>
        <a href="#apidoc.element.ghost.sandbox.prototype.loadApp" id="apidoc.element.ghost.sandbox.prototype.loadApp">
        function <span class="apidocSignatureSpan">ghost.sandbox.prototype.</span>loadApp
        <span class="apidocSignatureSpan">(appPath)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function loadAppSandboxed(appPath) {
    var appFile = require.resolve(appPath),
        appBase = path.dirname(appFile);

    this.opts.appRoot = appBase;

    return this.loadModule(appPath);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
return relativePath;
}

// Load apps through a pseudo sandbox
function loadApp(appPath, isInternal) {
var sandbox = new AppSandbox({internal: isInternal});

return sandbox.<span class="apidocCodeKeywordSpan">loadApp</span>(appPath);
}

function getAppByName(name, permissions) {
// Grab the app class to instantiate
var AppClass = loadApp(getAppRelativePath(name), isInternalApp(name)),
    appProxy = new AppProxy({
        name: name,
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ghost.sandbox.prototype.loadModule" id="apidoc.element.ghost.sandbox.prototype.loadModule">
        function <span class="apidocSignatureSpan">ghost.sandbox.prototype.</span>loadModule
        <span class="apidocSignatureSpan">(modulePath)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function loadModuleSandboxed(modulePath) {
    // Set loaded modules parent to this
    var self = this,
        moduleDir = path.dirname(modulePath),
        parentModulePath = self.opts.parent || module.parent,
        appRoot = self.opts.appRoot || moduleDir,
        currentModule,
        nodeRequire;

    // Resolve the modules path
    modulePath = Module._resolveFilename(modulePath, parentModulePath);

    // Instantiate a Node Module class
    currentModule = new Module(modulePath, parentModulePath);

    if (this.opts.internal) {
        currentModule.load(currentModule.id);

        return currentModule.exports;
    }

    // Grab the original modules require function
    nodeRequire = currentModule.require;

    // Set a new proxy require function
    currentModule.require = function requireProxy(module) {
        // check whitelist, plugin config, etc.
        if (_.includes(self.opts.blacklist, module)) {
            throw new Error(i18n.t(&#x27;errors.apps.unsafeAppRequire.error&#x27;, {msg: module}));
        }

        var firstTwo = module.slice(0, 2),
            resolvedPath,
            relPath,
            innerBox,
            newOpts;

        // Load relative modules with their own sandbox
        if (firstTwo === &#x27;./&#x27; || firstTwo === &#x27;..&#x27;) {
            // Get the path relative to the modules directory
            resolvedPath = path.resolve(moduleDir, module);

            // Check relative path from the appRoot for outside requires
            relPath = path.relative(appRoot, resolvedPath);
            if (relPath.slice(0, 2) === &#x27;..&#x27;) {
                throw new Error(i18n.t(&#x27;errors.apps.unsafeAppRequire.error&#x27;, {msg: relPath}));
            }

            // Assign as new module path
            module = resolvedPath;

            // Pass down the same options
            newOpts = _.extend({}, self.opts);

            // Make sure the appRoot and parent are appropriate
            newOpts.appRoot = appRoot;
            newOpts.parent = currentModule.parent;

            // Create the inner sandbox for loading this module.
            innerBox = new AppSandbox(newOpts);

            return innerBox.loadModule(module);
        }

        // Call the original require method for white listed named modules
        return nodeRequire.call(currentModule, module);
    };

    currentModule.load(currentModule.id);

    return currentModule.exports;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

AppSandbox.prototype.loadApp = function loadAppSandboxed(appPath) {
var appFile = require.resolve(appPath),
    appBase = path.dirname(appFile);

this.opts.appRoot = appBase;

return this.<span class="apidocCodeKeywordSpan">loadModule</span>(appPath);
};

AppSandbox.prototype.loadModule = function loadModuleSandboxed(modulePath) {
// Set loaded modules parent to this
var self = this,
    moduleDir = path.dirname(modulePath),
    parentModulePath = self.opts.parent || module.parent,
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.ghost.schedules" id="apidoc.module.ghost.schedules">module ghost.schedules</a></h1>


    <h2>
        <a href="#apidoc.element.ghost.schedules.getScheduledPosts" id="apidoc.element.ghost.schedules.getScheduledPosts">
        function <span class="apidocSignatureSpan">ghost.schedules.</span>getScheduledPosts
        <span class="apidocSignatureSpan">(options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function readPosts(options) {
    options = options || {};
    options.context = {internal: true};

    return pipeline([
        utils.validate(&#x27;posts&#x27;, {opts: [&#x27;from&#x27;, &#x27;to&#x27;]}),
        function (cleanOptions) {
            cleanOptions.filter = &#x27;status:scheduled&#x27;;
            cleanOptions.columns = [&#x27;id&#x27;, &#x27;published_at&#x27;, &#x27;created_at&#x27;];

            if (cleanOptions.from) {
                cleanOptions.filter += &#x27;+created_at:&#x3e;=\&#x27;&#x27; + moment(cleanOptions.from).format(&#x27;YYYY-MM-DD HH:mm:ss&#x27;) + &#x27;\&#x27;&#x27;;
            }

            if (cleanOptions.to) {
                cleanOptions.filter += &#x27;+created_at:&#x3c;=\&#x27;&#x27; + moment(cleanOptions.to).format(&#x27;YYYY-MM-DD HH:mm:ss&#x27;) + &#x27;\&#x27;&#x27;;
            }

            return dataProvider.Post.findAll(cleanOptions)
                .then(function (result) {
                    return Promise.resolve({posts: result.models});
                });
        }
    ], options);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ghost.schedules.publishPost" id="apidoc.element.ghost.schedules.publishPost">
        function <span class="apidocSignatureSpan">ghost.schedules.</span>publishPost
        <span class="apidocSignatureSpan">(object, options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function publishPost(object, options) {
    if (_.isEmpty(options)) {
        options = object || {};
        object = {};
    }

    var post, publishedAtMoment,
        publishAPostBySchedulerToleranceInMinutes = config.times.publishAPostBySchedulerToleranceInMinutes;

    // CASE: only the scheduler client is allowed to publish (hardcoded because of missing client permission system)
    if (!options.context || !options.context.client || options.context.client !== &#x27;ghost-scheduler&#x27;) {
        return Promise.reject(new errors.NoPermissionError(i18n.t(&#x27;errors.permissions.noPermissionToAction&#x27;)));
    }

    options.context = {internal: true};

    return pipeline([
        utils.validate(&#x27;posts&#x27;, {opts: utils.idDefaultOptions}),
        function (cleanOptions) {
            cleanOptions.status = &#x27;scheduled&#x27;;

            return dataProvider.Base.transaction(function (transacting) {
                cleanOptions.transacting = transacting;
                cleanOptions.forUpdate = true;

                // CASE: extend allowed options, see api/utils.js
                cleanOptions.opts = [&#x27;forUpdate&#x27;, &#x27;transacting&#x27;];

                return apiPosts.read(cleanOptions)
                    .then(function (result) {
                        post = result.posts[0];
                        publishedAtMoment = moment(post.published_at);

                        if (publishedAtMoment.diff(moment(), &#x27;minutes&#x27;) &#x3e; publishAPostBySchedulerToleranceInMinutes) {
                            return Promise.reject(new errors.NotFoundError(i18n.t(&#x27;errors.api.job.notFound&#x27;)));
                        }

                        if (publishedAtMoment.diff(moment(), &#x27;minutes&#x27;) &#x3c; publishAPostBySchedulerToleranceInMinutes * -1 &#x26;&#x26; object
.force !== true) {
                            return Promise.reject(new errors.NotFoundError(i18n.t(&#x27;errors.api.job.publishInThePast&#x27;)));
                        }

                        return apiPosts.edit({
                            posts: [{status: &#x27;published&#x27;}]},
                            _.pick(cleanOptions, [&#x27;context&#x27;, &#x27;id&#x27;, &#x27;transacting&#x27;, &#x27;forUpdate&#x27;, &#x27;opts&#x27;])
                        );
                    });
            });
        }
    ], options);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.ghost.settings" id="apidoc.module.ghost.settings">module ghost.settings</a></h1>


    <h2>
        <a href="#apidoc.element.ghost.settings.browse" id="apidoc.element.ghost.settings.browse">
        function <span class="apidocSignatureSpan">ghost.settings.</span>browse
        <span class="apidocSignatureSpan">(options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function browse(options) {
    // First, check if we have populated the settings from default-settings yet
    if (!hasPopulatedDefaults) {
        return dataProvider.Settings.populateDefaults().then(function () {
            hasPopulatedDefaults = true;
            return settings.browse(options);
        });
    }

    options = options || {};

    var result = settingsResult(settingsCache, options.type);

    // If there is no context, return only blog settings
    if (!options.context) {
        return Promise.resolve(_.filter(result.settings, function (setting) { return setting.type === &#x27;blog&#x27;; }));
    }

    // Otherwise return whatever this context is allowed to browse
    return canThis(options.context).browse.setting().then(function () {
        // Omit core settings unless internal request
        if (!options.context.internal) {
            result.settings = _.filter(result.settings, function (setting) { return setting.type !== &#x27;core&#x27;; });
        }

        return result;
    });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
status: &#x27;alert&#x27;,
type: &#x27;info&#x27;,
custom: true,
uuid: message.id,
dismissible: true,
message: message.content
    },
    getAllNotifications = api.notifications.<span class="apidocCodeKeywordSpan">browse</span>({context: {internal: true}}),
    getSeenNotifications = api.settings.read(_.extend({key: &#x27;seenNotifications&#x27;}, internal));

    return Promise.join(getAllNotifications, getSeenNotifications, function joined(all, seen) {
var isSeen      = _.includes(JSON.parse(seen.settings[0].value || []), notification.uuid),
    isDuplicate = _.some(all.notifications, {message: notification.message});

if (!isSeen &#x26;&#x26; !isDuplicate) {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ghost.settings.edit" id="apidoc.element.ghost.settings.edit">
        function <span class="apidocSignatureSpan">ghost.settings.</span>edit
        <span class="apidocSignatureSpan">(object, options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function edit(object, options) {
    options = options || {};
    var self = this,
        type;

    // Allow shorthand syntax where a single key and value are passed to edit instead of object and options
    if (_.isString(object)) {
        object = {settings: [{key: object, value: options}]};
    }

    // clean data
    _.each(object.settings, function (setting) {
        if (!_.isString(setting.value)) {
            setting.value = JSON.stringify(setting.value);
        }
    });

    type = _.find(object.settings, function (setting) { return setting.key === &#x27;type&#x27;; });
    if (_.isObject(type)) {
        type = type.value;
    }

    object.settings = _.reject(object.settings, function (setting) {
        return setting.key === &#x27;type&#x27; || setting.key === &#x27;availableThemes&#x27;;
    });

    return canEditAllSettings(object.settings, options).then(function () {
        return utils.checkObject(object, docName).then(function (checkedData) {
            options.user = self.user;
            return dataProvider.Settings.edit(checkedData.settings, options);
        }).then(function (result) {
            var readResult = readSettingsResult(result);

            return updateSettingsCache(readResult).then(function () {
                return settingsResult(readResult, type);
            });
        });
    });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
var hash = response.settings[0].value,
    initHash;

dbHash = hash;

if (dbHash === null) {
    initHash = uuid.v4();
    return api.settings.<span class="apidocCodeKeywordSpan">edit</span>({settings: [{key: &#x27;dbHash&#x27;, value: initHash}]}, {
context: {internal: true}})
        .then(function (response) {
            dbHash = response.settings[0].value;
            return dbHash;
            // Use `then` here to do &#x27;first run&#x27; actions
        });
}
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ghost.settings.read" id="apidoc.element.ghost.settings.read">
        function <span class="apidocSignatureSpan">ghost.settings.</span>read
        <span class="apidocSignatureSpan">(options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function read(options) {
    if (_.isString(options)) {
        options = {key: options};
    }

    var getSettingsResult = function () {
            var setting = settingsCache[options.key],
                result = {};

            result[options.key] = setting;

            if (setting.type === &#x27;core&#x27; &#x26;&#x26; !(options.context &#x26;&#x26; options.context.internal)) {
                return Promise.reject(
                    new errors.NoPermissionError(i18n.t(&#x27;errors.api.settings.accessCoreSettingFromExtReq&#x27;))
                );
            }

            if (setting.type === &#x27;blog&#x27;) {
                return Promise.resolve(settingsResult(result));
            }

            return canThis(options.context).read.setting(options.key).then(function () {
                return settingsResult(result);
            }, function () {
                return Promise.reject(new errors.NoPermissionError(i18n.t(&#x27;errors.api.settings.noPermissionToReadSettings&#x27;)));
            });
        };

    // If the setting is not already in the cache
    if (!settingsCache[options.key]) {
        // Try to populate the setting from default-settings file
        return populateDefaultSetting(options.key).then(function () {
            // Get the result from the cache with permission checks
            return getSettingsResult();
        });
    }

    // Get the result from the cache with permission checks
    return getSettingsResult();
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    xmlrpc = require(&#x27;./data/xml/xmlrpc&#x27;),
    slack = require(&#x27;./data/slack&#x27;),
    GhostServer = require(&#x27;./ghost-server&#x27;),
    scheduling = require(&#x27;./scheduling&#x27;),
    dbHash;

function initDbHashAndFirstRun() {
    return api.settings.<span class="apidocCodeKeywordSpan">read</span>({key: &#x27;dbHash&#x27;, context: {internal: true}}).then
(function (response) {
var hash = response.settings[0].value,
    initHash;

dbHash = hash;

if (dbHash === null) {
    initHash = uuid.v4();
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ghost.settings.updateSettingsCache" id="apidoc.element.ghost.settings.updateSettingsCache">
        function <span class="apidocSignatureSpan">ghost.settings.</span>updateSettingsCache
        <span class="apidocSignatureSpan">(settings, options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">updateSettingsCache = function (settings, options) {
    options = options || {};
    settings = settings || {};

    if (!_.isEmpty(settings)) {
        _.map(settings, function (setting, key) {
            settingsCache[key] = setting;
        });

        updateConfigCache();

        return Promise.resolve(settingsCache);
    }

    return dataProvider.Settings.findAll(options)
        .then(function (result) {
            settingsCache = readSettingsResult(result.models);

            updateConfigCache();

            return settingsCache;
        });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    importContent: function (options) {
var tasks = [];
options = options || {};

function importContent(options) {
    return importer.importFromFile(options)
        .then(function () {
            api.settings.<span class="apidocCodeKeywordSpan">updateSettingsCache</span>();
        })
        .return({db: []});
}

tasks = [
    utils.handlePermissions(docName, &#x27;importContent&#x27;),
    importContent
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.ghost.slack" id="apidoc.module.ghost.slack">module ghost.slack</a></h1>


    <h2>
        <a href="#apidoc.element.ghost.slack.sendTest" id="apidoc.element.ghost.slack.sendTest">
        function <span class="apidocSignatureSpan">ghost.slack.</span>sendTest
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">sendTest = function () {
    events.emit(&#x27;slack.test&#x27;);
    return Promise.resolve();
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.ghost.slugs" id="apidoc.module.ghost.slugs">module ghost.slugs</a></h1>


    <h2>
        <a href="#apidoc.element.ghost.slugs.generate" id="apidoc.element.ghost.slugs.generate">
        function <span class="apidocSignatureSpan">ghost.slugs.</span>generate
        <span class="apidocSignatureSpan">(options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">generate = function (options) {
    var opts = [&#x27;type&#x27;],
        attrs = [&#x27;name&#x27;],
        tasks;

    // `allowedTypes` is used to define allowed slug types and map them against its model class counterpart
    allowedTypes = {
        post: dataProvider.Post,
        tag: dataProvider.Tag,
        user: dataProvider.User,
        app: dataProvider.App
    };

<span class="apidocCodeCommentSpan">    /**
     * ### Check allowed types
     * check if options.type contains an allowed type
     * @param {Object} options
     * @returns {Object} options
     */
</span>    function checkAllowedTypes(options) {
        if (allowedTypes[options.type] === undefined) {
            return Promise.reject(new errors.BadRequestError(i18n.t(&#x27;errors.api.slugs.unknownSlugType&#x27;, {type: options.type})));
        }
        return options;
    }

    /**
     * ### Model Query
     * Make the call to the Model layer
     * @param {Object} options
     * @returns {Object} options
     */
    function modelQuery(options) {
        return dataProvider.Base.Model.generateSlug(allowedTypes[options.type], options.data.name, {status: &#x27;all&#x27;});
    }

    // Push all of our tasks into a `tasks` array in the correct order
    tasks = [
        utils.validate(docName, {opts: opts, attrs: attrs}),
        utils.handlePermissions(docName, &#x27;generate&#x27;),
        checkAllowedTypes,
        modelQuery
    ];

    // Pipeline calls each task passing the result of one to be the arguments for the next
    return pipeline(tasks, options).then(function (slug) {
        if (!slug) {
            return Promise.reject(new errors.InternalServerError(i18n.t(&#x27;errors.api.slugs.couldNotGenerateSlug&#x27;)));
        }

        return {slugs: [{slug: slug}]};
    });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.ghost.social_urls" id="apidoc.module.ghost.social_urls">module ghost.social_urls</a></h1>


    <h2>
        <a href="#apidoc.element.ghost.social_urls.facebookUrl" id="apidoc.element.ghost.social_urls.facebookUrl">
        function <span class="apidocSignatureSpan">ghost.social_urls.</span>facebookUrl
        <span class="apidocSignatureSpan">(username)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function facebookUrl(username) {
    // Handles a starting slash, this shouldn&#x27;t happen, but just in case
    return &#x27;https://www.facebook.com/&#x27; + username.replace(/^\//, &#x27;&#x27;);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
facebook_url = function (username, options) {
    if (!options) {
        options = username;
        username = findKey(&#x27;facebook&#x27;, this, options.data.blog);
    }

    if (username) {
        return socialUrls.<span class="apidocCodeKeywordSpan">facebookUrl</span>(username);
    }

    return null;
};

module.exports = facebook_url;
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ghost.social_urls.twitterUrl" id="apidoc.element.ghost.social_urls.twitterUrl">
        function <span class="apidocSignatureSpan">ghost.social_urls.</span>twitterUrl
        <span class="apidocSignatureSpan">(username)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function twitterUrl(username) {
    // Creates the canonical twitter URL without the &#x27;@&#x27;
    return &#x27;https://twitter.com/&#x27; + username.replace(/^@/, &#x27;&#x27;);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
twitter_url = function twitter_url(username, options) {
    if (!options) {
        options = username;
        username = findKey(&#x27;twitter&#x27;, this, options.data.blog);
    }

    if (username) {
        return socialUrls.<span class="apidocCodeKeywordSpan">twitterUrl</span>(username);
    }

    return null;
};

module.exports = twitter_url;
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.ghost.spam_prevention" id="apidoc.module.ghost.spam_prevention">module ghost.spam_prevention</a></h1>


    <h2>
        <a href="#apidoc.element.ghost.spam_prevention.forgotten" id="apidoc.element.ghost.spam_prevention.forgotten">
        function <span class="apidocSignatureSpan">ghost.spam_prevention.</span>forgotten
        <span class="apidocSignatureSpan">(req, res, next)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function forgotten(req, res, next) {
    var currentTime = process.hrtime()[0],
        remoteAddress = req.connection.remoteAddress,
        rateForgottenPeriod = config.rateForgottenPeriod || 3600,
        rateForgottenAttempts = config.rateForgottenAttempts || 5,
        email = req.body.passwordreset[0].email,
        ipCount = &#x27;&#x27;,
        deniedRateLimit = &#x27;&#x27;,
        deniedEmailRateLimit = &#x27;&#x27;,
        message = i18n.t(&#x27;errors.middleware.spamprevention.tooManyAttempts&#x27;),
        index = _.findIndex(forgottenSecurity, function findIndex(logTime) {
            return (logTime.ip === remoteAddress &#x26;&#x26; logTime.email === email);
        });

    if (email) {
        if (index !== -1) {
            forgottenSecurity[index].count = forgottenSecurity[index].count + 1;
        } else {
            forgottenSecurity.push({ip: remoteAddress, time: currentTime, email: email, count: 0});
        }
    } else {
        return next(new errors.BadRequestError(i18n.t(&#x27;errors.middleware.spamprevention.noEmail&#x27;)));
    }

    // filter entries that are older than rateForgottenPeriod
    forgottenSecurity = _.filter(forgottenSecurity, function filter(logTime) {
        return (logTime.time + rateForgottenPeriod &#x3e; currentTime);
    });

    // check number of tries with different email addresses per IP
    ipCount = _.chain(forgottenSecurity).countBy(&#x27;ip&#x27;).value();
    deniedRateLimit = (ipCount[remoteAddress] &#x3e; rateForgottenAttempts);

    if (index !== -1) {
        deniedEmailRateLimit = (forgottenSecurity[index].count &#x3e; rateForgottenAttempts);
    }

    if (deniedEmailRateLimit) {
        errors.logError(
            i18n.t(&#x27;errors.middleware.spamprevention.forgottenPasswordEmail.error&#x27;, {rfa: rateForgottenAttempts, rfp: rateForgottenPeriod
}),
            i18n.t(&#x27;errors.middleware.spamprevention.forgottenPasswordEmail.context&#x27;)
        );
    }

    if (deniedRateLimit) {
        errors.logError(
            i18n.t(&#x27;errors.middleware.spamprevention.forgottenPasswordIp.error&#x27;, {rfa: rateForgottenAttempts, rfp: rateForgottenPeriod
}),
            i18n.t(&#x27;errors.middleware.spamprevention.forgottenPasswordIp.context&#x27;)
        );
    }

    if (deniedEmailRateLimit || deniedRateLimit) {
        message += rateForgottenPeriod === 3600 ? i18n.t(&#x27;errors.middleware.spamprevention.waitOneHour&#x27;) : i18n.t(&#x27;errors.middleware
.spamprevention.tryAgainLater&#x27;);
        return next(new errors.TooManyRequestsError(message));
    }

    next();
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ghost.spam_prevention.resetCounter" id="apidoc.element.ghost.spam_prevention.resetCounter">
        function <span class="apidocSignatureSpan">ghost.spam_prevention.</span>resetCounter
        <span class="apidocSignatureSpan">(email)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function resetCounter(email) {
    loginSecurity = _.filter(loginSecurity, function filter(logTime) {
        return (logTime.email !== email);
    });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
            return models.Accesstoken.add(
                {token: accessToken, user_id: user.id, client_id: client.id, expires: accessExpires}
            ).then(function then() {
                return models.Refreshtoken.add(
                    {token: refreshToken, user_id: user.id, client_id: client.id, expires: refreshExpires}
                );
            }).then(function then() {
                spamPrevention.<span class="apidocCodeKeywordSpan">resetCounter</span>(username);
                return done(null, accessToken, refreshToken, {expires_in: utils.ONE_HOUR_S});
            });
        }).catch(function handleError(error) {
            return done(error, false);
        });
    });
}
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ghost.spam_prevention.signin" id="apidoc.element.ghost.spam_prevention.signin">
        function <span class="apidocSignatureSpan">ghost.spam_prevention.</span>signin
        <span class="apidocSignatureSpan">(req, res, next)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function signin(req, res, next) {
    var currentTime = process.hrtime()[0],
        remoteAddress = req.connection.remoteAddress,
        deniedRateLimit = &#x27;&#x27;,
        ipCount = &#x27;&#x27;,
        message = i18n.t(&#x27;errors.middleware.spamprevention.tooManyAttempts&#x27;),
        rateSigninPeriod = config.rateSigninPeriod || 3600,
        rateSigninAttempts = config.rateSigninAttempts || 10;

    if (req.body.username &#x26;&#x26; req.body.grant_type === &#x27;password&#x27;) {
        loginSecurity.push({ip: remoteAddress, time: currentTime, email: req.body.username});
    } else if (req.body.grant_type === &#x27;refresh_token&#x27;) {
        return next();
    } else {
        return next(new errors.BadRequestError(i18n.t(&#x27;errors.middleware.spamprevention.noUsername&#x27;)));
    }

    // filter entries that are older than rateSigninPeriod
    loginSecurity = _.filter(loginSecurity, function filter(logTime) {
        return (logTime.time + rateSigninPeriod &#x3e; currentTime);
    });

    // check number of tries per IP address
    ipCount = _.chain(loginSecurity).countBy(&#x27;ip&#x27;).value();
    deniedRateLimit = (ipCount[remoteAddress] &#x3e; rateSigninAttempts);

    if (deniedRateLimit) {
        errors.logError(
            i18n.t(&#x27;errors.middleware.spamprevention.tooManySigninAttempts.error&#x27;, {rateSigninAttempts: rateSigninAttempts, rateSigninPeriod
: rateSigninPeriod}),
            i18n.t(&#x27;errors.middleware.spamprevention.tooManySigninAttempts.context&#x27;)
        );
        message += rateSigninPeriod === 3600 ? i18n.t(&#x27;errors.middleware.spamprevention.waitOneHour&#x27;) : i18n.t(&#x27;errors.middleware
.spamprevention.tryAgainLater&#x27;);
        return next(new errors.TooManyRequestsError(message));
    }
    next();
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.ghost.startup_check" id="apidoc.module.ghost.startup_check">module ghost.startup_check</a></h1>


    <h2>
        <a href="#apidoc.element.ghost.startup_check.builtFilesExist" id="apidoc.element.ghost.startup_check.builtFilesExist">
        function <span class="apidocSignatureSpan">ghost.startup_check.</span>builtFilesExist
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function builtFilesExist() {
    var configFile,
        config,
        location,
        fileNames = [&#x27;ghost.js&#x27;, &#x27;vendor.js&#x27;, &#x27;ghost.css&#x27;, &#x27;vendor.css&#x27;];

    try {
        configFile = require(configFilePath);
        config = configFile[mode];

        if (config.paths &#x26;&#x26; config.paths.clientAssets) {
            location = config.paths.clientAssets;
        } else {
            location = path.join(appRoot, &#x27;/core/built/assets/&#x27;);
        }
    } catch (e) {
        location = path.join(appRoot, &#x27;/core/built/assets/&#x27;);
    }

    if (process.env.NODE_ENV === &#x27;production&#x27;) {
        // Production uses `.min` files
        fileNames = fileNames.map(function (file) {
            return file.replace(&#x27;.&#x27;, &#x27;.min.&#x27;);
        });
    }

    function checkExist(fileName) {
        try {
            fs.statSync(fileName);
        } catch (e) {
            console.error(&#x27;\x1B[31mERROR: Javascript files have not been built.\033[0m&#x27;);
            console.error(&#x27;\n\x1B[32mPlease read the getting started instructions at:&#x27;);
            console.error(&#x27;https://github.com/TryGhost/Ghost#getting-started\033[0m&#x27;);
            process.exit(exitCodes.BUILT_FILES_DO_NOT_EXIST);
        }
    }

    fileNames.forEach(function (fileName) {
        checkExist(location + fileName);
    });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
check: function check() {
    this.nodeVersion();
    this.nodeEnv();
    this.packages();
    this.contentPath();
    this.mail();
    this.sqlite();
    this.<span class="apidocCodeKeywordSpan">builtFilesExist</span>();
},

// Make sure the node version is supported
nodeVersion: function checkNodeVersion() {
    // Tell users if their node version is not supported, and exit
    var semver = require(&#x27;semver&#x27;);
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ghost.startup_check.check" id="apidoc.element.ghost.startup_check.check">
        function <span class="apidocSignatureSpan">ghost.startup_check.</span>check
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function check() {
    this.nodeVersion();
    this.nodeEnv();
    this.packages();
    this.contentPath();
    this.mail();
    this.sqlite();
    this.builtFilesExist();
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

var ghost = require(&#x27;./core&#x27;),
express = require(&#x27;express&#x27;),
errors = require(&#x27;./core/server/errors&#x27;),
parentApp = express();

// Make sure dependencies are installed and file system permissions are correct.
require(&#x27;./core/server/utils/startup-check&#x27;).<span class="apidocCodeKeywordSpan">check</span>();

ghost().then(function (ghostServer) {
// Mount our Ghost instance on our desired subdirectory path if it exists.
parentApp.use(ghostServer.config.paths.subdir, ghostServer.rootApp);

// Let Ghost handle starting our server instance.
ghostServer.start(parentApp);
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ghost.startup_check.contentPath" id="apidoc.element.ghost.startup_check.contentPath">
        function <span class="apidocSignatureSpan">ghost.startup_check.</span>contentPath
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function checkContentPaths() {
    if (mode !== &#x27;production&#x27; &#x26;&#x26; mode !== &#x27;development&#x27;) {
        return;
    }

    var configFile,
        config,
        contentPath,
        contentSubPaths = [&#x27;apps&#x27;, &#x27;data&#x27;, &#x27;images&#x27;, &#x27;themes&#x27;],
        fd,
        errorHeader = &#x27;\x1B[31mERROR: Unable to access Ghost\&#x27;s content path:\033[0m&#x27;,
        errorHelp = &#x27;\x1B[32mCheck that the content path exists and file system permissions are correct.&#x27; +
            &#x27;\nHelp and documentation can be found at http://support.ghost.org.\033[0m&#x27;;

    // Get the content path to test.  If it&#x27;s defined in config.js use that, if not use the default
    try {
        configFile = require(configFilePath);
        config = configFile[mode];

        if (config &#x26;&#x26; config.paths &#x26;&#x26; config.paths.contentPath) {
            contentPath = config.paths.contentPath;
        } else {
            contentPath = path.join(appRoot, &#x27;content&#x27;);
        }
    } catch (e) {
        // If config.js doesn&#x27;t exist yet, check the default content path location
        contentPath = path.join(appRoot, &#x27;content&#x27;);
    }

    // Use all sync io calls so that we stay in this function until all checks are complete

    // Check the root content path
    try {
        fd = fs.openSync(contentPath, &#x27;r&#x27;);
        fs.closeSync(fd);
    } catch (e) {
        console.error(errorHeader);
        console.error(&#x27;  &#x27; + e.message);
        console.error(&#x27;\n&#x27; + errorHelp);

        process.exit(exitCodes.CONTENT_PATH_NOT_ACCESSIBLE);
    }

    // Check each of the content path subdirectories
    try {
        contentSubPaths.forEach(function (sub) {
            var dir = path.join(contentPath, sub),
                randomFile = path.join(dir, crypto.randomBytes(8).toString(&#x27;hex&#x27;));

            fd = fs.openSync(dir, &#x27;r&#x27;);
            fs.closeSync(fd);

            // Check write access to directory by attempting to create a random file
            fd = fs.openSync(randomFile, &#x27;wx+&#x27;);
            fs.closeSync(fd);
            fs.unlinkSync(randomFile);
        });
    } catch (e) {
        console.error(errorHeader);
        console.error(&#x27;  &#x27; + e.message);
        console.error(&#x27;\n&#x27; + errorHelp);

        process.exit(exitCodes.CONTENT_PATH_NOT_WRITABLE);
    }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
};

checks = {
check: function check() {
    this.nodeVersion();
    this.nodeEnv();
    this.packages();
    this.<span class="apidocCodeKeywordSpan">contentPath</span>();
    this.mail();
    this.sqlite();
    this.builtFilesExist();
},

// Make sure the node version is supported
nodeVersion: function checkNodeVersion() {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ghost.startup_check.mail" id="apidoc.element.ghost.startup_check.mail">
        function <span class="apidocSignatureSpan">ghost.startup_check.</span>mail
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function checkMail() {
    var configFile,
        config;

    try {
        configFile = require(configFilePath);
        config = configFile[mode];
    } catch (e) {
        configFilePath = path.join(appRoot, &#x27;config.example.js&#x27;);
    }

    if (!config.mail || !config.mail.transport) {
        console.error(&#x27;\x1B[31mWARNING: Ghost is attempting to use a direct method to send email. \nIt is recommended that you explicitly
 configure an email service.\033[0m&#x27;);
        console.error(&#x27;\x1B[32mHelp and documentation can be found at http://support.ghost.org/mail.\033[0m\n&#x27;);
    }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

checks = {
check: function check() {
    this.nodeVersion();
    this.nodeEnv();
    this.packages();
    this.contentPath();
    this.<span class="apidocCodeKeywordSpan">mail</span>();
    this.sqlite();
    this.builtFilesExist();
},

// Make sure the node version is supported
nodeVersion: function checkNodeVersion() {
    // Tell users if their node version is not supported, and exit
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ghost.startup_check.nodeEnv" id="apidoc.element.ghost.startup_check.nodeEnv">
        function <span class="apidocSignatureSpan">ghost.startup_check.</span>nodeEnv
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function checkNodeEnvState() {
    // Check if config path resolves, if not check for NODE_ENV in config.example.js prior to copy
    var fd,
        configFile,
        config;

    try {
        fd = fs.openSync(configFilePath, &#x27;r&#x27;);
        fs.closeSync(fd);
    } catch (e) {
        configFilePath = path.join(appRoot, &#x27;config.example.js&#x27;);
    }

    configFile = require(configFilePath);
    config = configFile[mode];

    if (!config) {
        console.error(&#x27;\x1B[31mERROR: Cannot find the configuration for the current NODE_ENV: &#x27; +
                        process.env.NODE_ENV + &#x27;\033[0m\n&#x27;);
        console.error(&#x27;\x1B[32mEnsure your config.js has a section for the current NODE_ENV value&#x27; +
                        &#x27; and is formatted properly.\033[0m&#x27;);

        process.exit(exitCodes.NODE_ENV_CONFIG_MISSING);
    }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    SQLITE_DB_NOT_WRITABLE: 236,
    BUILT_FILES_DO_NOT_EXIST: 237
};

checks = {
check: function check() {
    this.nodeVersion();
    this.<span class="apidocCodeKeywordSpan">nodeEnv</span>();
    this.packages();
    this.contentPath();
    this.mail();
    this.sqlite();
    this.builtFilesExist();
},
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ghost.startup_check.nodeVersion" id="apidoc.element.ghost.startup_check.nodeVersion">
        function <span class="apidocSignatureSpan">ghost.startup_check.</span>nodeVersion
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function checkNodeVersion() {
    // Tell users if their node version is not supported, and exit
    var semver = require(&#x27;semver&#x27;);

    if (process.env.GHOST_NODE_VERSION_CHECK !== &#x27;false&#x27; &#x26;&#x26;
        !semver.satisfies(process.versions.node, packages.engines.node)) {
        console.error(&#x27;\x1B[31mERROR: Unsupported version of Node&#x27;);
        console.error(&#x27;\x1B[31mGhost needs Node version &#x27; + packages.engines.node +
                      &#x27; you are using version &#x27; + process.versions.node + &#x27;\033[0m\n&#x27;);
        console.error(&#x27;\x1B[32mPlease see http://support.ghost.org/supported-node-versions/ for more information\033[0m&#x27;);

        process.exit(exitCodes.NODE_VERSION_UNSUPPORTED);
    }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    CONTENT_PATH_NOT_WRITABLE: 235,
    SQLITE_DB_NOT_WRITABLE: 236,
    BUILT_FILES_DO_NOT_EXIST: 237
};

checks = {
check: function check() {
    this.<span class="apidocCodeKeywordSpan">nodeVersion</span>();
    this.nodeEnv();
    this.packages();
    this.contentPath();
    this.mail();
    this.sqlite();
    this.builtFilesExist();
},
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ghost.startup_check.packages" id="apidoc.element.ghost.startup_check.packages">
        function <span class="apidocSignatureSpan">ghost.startup_check.</span>packages
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function checkPackages() {
    if (mode !== &#x27;production&#x27; &#x26;&#x26; mode !== &#x27;development&#x27;) {
        return;
    }

    var errors = [];

    Object.keys(packages.dependencies).forEach(function (p) {
        try {
            require.resolve(p);
        } catch (e) {
            errors.push(e.message);
        }
    });

    if (!errors.length) {
        return;
    }

    errors = errors.join(&#x27;\n  &#x27;);

    console.error(&#x27;\x1B[31mERROR: Ghost is unable to start due to missing dependencies:\033[0m\n  &#x27; + errors);
    console.error(&#x27;\x1B[32m\nPlease run `npm install --production` and try starting Ghost again.&#x27;);
    console.error(&#x27;\x1B[32mHelp and documentation can be found at http://support.ghost.org.\033[0m\n&#x27;);

    process.exit(exitCodes.DEPENDENCIES_MISSING);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    BUILT_FILES_DO_NOT_EXIST: 237
};

checks = {
check: function check() {
    this.nodeVersion();
    this.nodeEnv();
    this.<span class="apidocCodeKeywordSpan">packages</span>();
    this.contentPath();
    this.mail();
    this.sqlite();
    this.builtFilesExist();
},

// Make sure the node version is supported
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ghost.startup_check.sqlite" id="apidoc.element.ghost.startup_check.sqlite">
        function <span class="apidocSignatureSpan">ghost.startup_check.</span>sqlite
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function checkSqlite() {
    if (mode !== &#x27;production&#x27; &#x26;&#x26; mode !== &#x27;development&#x27;) {
        return;
    }

    var configFile,
        config,
        appRoot = path.resolve(__dirname, &#x27;../../../&#x27;),
        dbPath,
        fd;

    try {
        configFile = require(configFilePath);
        config = configFile[mode];

        // Abort check if database type is not sqlite3
        if (config &#x26;&#x26; config.database &#x26;&#x26; config.database.client !== &#x27;sqlite3&#x27;) {
            return;
        }

        if (config &#x26;&#x26; config.database &#x26;&#x26; config.database.connection) {
            dbPath = config.database.connection.filename;
        }
    } catch (e) {
        // If config.js doesn&#x27;t exist, use the default path
        dbPath = path.join(appRoot, &#x27;content&#x27;, &#x27;data&#x27;, mode === &#x27;production&#x27; ? &#x27;ghost.db&#x27; : &#x27;ghost-dev.db&#x27;);
    }

    // Check for read/write access on sqlite db file
    try {
        fd = fs.openSync(dbPath, &#x27;r+&#x27;);
        fs.closeSync(fd);
    } catch (e) {
        // Database file not existing is not an error as sqlite will create it.
        if (e.code === &#x27;ENOENT&#x27;) {
            return;
        }

        console.error(&#x27;\x1B[31mERROR: Unable to open sqlite3 database file for read/write\033[0m&#x27;);
        console.error(&#x27;  &#x27; + e.message);
        console.error(&#x27;\n\x1B[32mCheck that the sqlite3 database file permissions allow read and write access.&#x27;);
        console.error(&#x27;Help and documentation can be found at http://support.ghost.org.\033[0m&#x27;);

        process.exit(exitCodes.SQLITE_DB_NOT_WRITABLE);
    }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
checks = {
check: function check() {
    this.nodeVersion();
    this.nodeEnv();
    this.packages();
    this.contentPath();
    this.mail();
    this.<span class="apidocCodeKeywordSpan">sqlite</span>();
    this.builtFilesExist();
},

// Make sure the node version is supported
nodeVersion: function checkNodeVersion() {
    // Tell users if their node version is not supported, and exit
    var semver = require(&#x27;semver&#x27;);
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.ghost.subscriber" id="apidoc.module.ghost.subscriber">module ghost.subscriber</a></h1>


    <h2>
        <a href="#apidoc.element.ghost.subscriber.Subscriber" id="apidoc.element.ghost.subscriber.Subscriber">
        function <span class="apidocSignatureSpan">ghost.subscriber.</span>Subscriber
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">Subscriber = function () {
  return Parent.apply(this, arguments);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ghost.subscriber.Subscribers" id="apidoc.element.ghost.subscriber.Subscribers">
        function <span class="apidocSignatureSpan">ghost.subscriber.</span>Subscribers
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">Subscribers = function () {
  return Parent.apply(this, arguments);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.ghost.subscribers" id="apidoc.module.ghost.subscribers">module ghost.subscribers</a></h1>


    <h2>
        <a href="#apidoc.element.ghost.subscribers.add" id="apidoc.element.ghost.subscribers.add">
        function <span class="apidocSignatureSpan">ghost.subscribers.</span>add
        <span class="apidocSignatureSpan">(object, options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function add(object, options) {
    var tasks;

<span class="apidocCodeCommentSpan">    /**
     * ### Model Query
     * Make the call to the Model layer
     * @param {Object} options
     * @returns {Object} options
     */
</span>    function doQuery(options) {
        return dataProvider.Subscriber.getByEmail(options.data.subscribers[0].email)
            .then(function (subscriber) {
                if (subscriber &#x26;&#x26; options.context.external) {
                    // we don&#x27;t expose this information
                    return Promise.resolve(subscriber);
                } else if (subscriber) {
                    return Promise.reject(new errors.ValidationError(i18n.t(&#x27;errors.api.subscribers.subscriberAlreadyExists&#x27;)));
                }

                return dataProvider.Subscriber.add(options.data.subscribers[0], _.omit(options, [&#x27;data&#x27;])).catch(function (error
) {
                    if (error.code &#x26;&#x26; error.message.toLowerCase().indexOf(&#x27;unique&#x27;) !== -1) {
                        return Promise.reject(new errors.ValidationError(i18n.t(&#x27;errors.api.subscribers.subscriberAlreadyExists&#x27;)));
                    }

                    return Promise.reject(error);
                });
            });
    }

    // Push all of our tasks into a `tasks` array in the correct order
    tasks = [
        utils.validate(docName),
        utils.handlePermissions(docName, &#x27;add&#x27;),
        doQuery
    ];

    // Pipeline calls each task passing the result of one to be the arguments for the next
    return pipeline(tasks, object, options).then(function formatResponse(result) {
        var subscriber = result.toJSON(options);
        return {subscribers: [subscriber]};
    });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
getSeenNotifications = api.settings.read(_.extend({key: &#x27;seenNotifications&#x27;}, internal));

return Promise.join(getAllNotifications, getSeenNotifications, function joined(all, seen) {
    var isSeen      = _.includes(JSON.parse(seen.settings[0].value || []), notification.uuid),
        isDuplicate = _.some(all.notifications, {message: notification.message});

    if (!isSeen &#x26;&#x26; !isDuplicate) {
        return api.notifications.<span class="apidocCodeKeywordSpan">add</span>({notifications: [notification]}, {context: {internal
: true}});
    }
});
}

function updateCheckData() {
var data = {},
    mailConfig = config.mail;
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ghost.subscribers.browse" id="apidoc.element.ghost.subscribers.browse">
        function <span class="apidocSignatureSpan">ghost.subscribers.</span>browse
        <span class="apidocSignatureSpan">(options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function browse(options) {
    var tasks;

<span class="apidocCodeCommentSpan">    /**
     * ### Model Query
     * Make the call to the Model layer
     * @param {Object} options
     * @returns {Object} options
     */
</span>    function doQuery(options) {
        return dataProvider.Subscriber.findPage(options);
    }

    // Push all of our tasks into a `tasks` array in the correct order
    tasks = [
        utils.validate(docName, {opts: utils.browseDefaultOptions}),
        utils.handlePermissions(docName, &#x27;browse&#x27;),
        doQuery
    ];

    // Pipeline calls each task passing the result of one to be the arguments for the next
    return pipeline(tasks, options);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
status: &#x27;alert&#x27;,
type: &#x27;info&#x27;,
custom: true,
uuid: message.id,
dismissible: true,
message: message.content
    },
    getAllNotifications = api.notifications.<span class="apidocCodeKeywordSpan">browse</span>({context: {internal: true}}),
    getSeenNotifications = api.settings.read(_.extend({key: &#x27;seenNotifications&#x27;}, internal));

    return Promise.join(getAllNotifications, getSeenNotifications, function joined(all, seen) {
var isSeen      = _.includes(JSON.parse(seen.settings[0].value || []), notification.uuid),
    isDuplicate = _.some(all.notifications, {message: notification.message});

if (!isSeen &#x26;&#x26; !isDuplicate) {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ghost.subscribers.destroy" id="apidoc.element.ghost.subscribers.destroy">
        function <span class="apidocSignatureSpan">ghost.subscribers.</span>destroy
        <span class="apidocSignatureSpan">(options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function destroy(options) {
    var tasks;

<span class="apidocCodeCommentSpan">    /**
     * ### Delete Subscriber
     * Make the call to the Model layer
     * @param {Object} options
     */
</span>    function doQuery(options) {
        return dataProvider.Subscriber.destroy(options).return(null);
    }

    // Push all of our tasks into a `tasks` array in the correct order
    tasks = [
        utils.validate(docName, {opts: utils.idDefaultOptions}),
        utils.handlePermissions(docName, &#x27;destroy&#x27;),
        doQuery
    ];

    // Pipeline calls each task passing the result of one to be the arguments for the next
    return pipeline(tasks, options);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
GhostServer.prototype.closeConnections = function () {
   var self = this;

   Object.keys(self.connections).forEach(function (socketId) {
       var socket = self.connections[socketId];

       if (socket) {
           socket.<span class="apidocCodeKeywordSpan">destroy</span>();
       }
   });
};

/**
* ### Log Start Messages
*/
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ghost.subscribers.edit" id="apidoc.element.ghost.subscribers.edit">
        function <span class="apidocSignatureSpan">ghost.subscribers.</span>edit
        <span class="apidocSignatureSpan">(object, options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function edit(object, options) {
    var tasks;

<span class="apidocCodeCommentSpan">    /**
     * Make the call to the Model layer
     * @param {Object} options
     * @returns {Object} options
     */
</span>    function doQuery(options) {
        return dataProvider.Subscriber.edit(options.data.subscribers[0], _.omit(options, [&#x27;data&#x27;]));
    }

    // Push all of our tasks into a `tasks` array in the correct order
    tasks = [
        utils.validate(docName, {opts: utils.idDefaultOptions}),
        utils.handlePermissions(docName, &#x27;edit&#x27;),
        doQuery
    ];

    // Pipeline calls each task passing the result of one to be the arguments for the next
    return pipeline(tasks, object, options).then(function formatResponse(result) {
        if (result) {
            var subscriber = result.toJSON(options);

            return {subscribers: [subscriber]};
        }

        return Promise.reject(new errors.NotFoundError(i18n.t(&#x27;errors.api.subscribers.subscriberNotFound&#x27;)));
    });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
var hash = response.settings[0].value,
    initHash;

dbHash = hash;

if (dbHash === null) {
    initHash = uuid.v4();
    return api.settings.<span class="apidocCodeKeywordSpan">edit</span>({settings: [{key: &#x27;dbHash&#x27;, value: initHash}]}, {
context: {internal: true}})
        .then(function (response) {
            dbHash = response.settings[0].value;
            return dbHash;
            // Use `then` here to do &#x27;first run&#x27; actions
        });
}
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ghost.subscribers.exportCSV" id="apidoc.element.ghost.subscribers.exportCSV">
        function <span class="apidocSignatureSpan">ghost.subscribers.</span>exportCSV
        <span class="apidocSignatureSpan">(options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function exportCSV(options) {
    var tasks = [];

    options = options || {};

    function formatCSV(data) {
        var fields = [&#x27;id&#x27;, &#x27;email&#x27;, &#x27;created_at&#x27;, &#x27;deleted_at&#x27;],
            csv = fields.join(&#x27;,&#x27;) + &#x27;\r\n&#x27;,
            subscriber,
            field,
            j,
            i;

        for (j = 0; j &#x3c; data.length; j = j + 1) {
            subscriber = data[j];

            for (i = 0; i &#x3c; fields.length; i = i + 1) {
                field = fields[i];
                csv += subscriber[field] !== null ? subscriber[field] : &#x27;&#x27;;
                if (i !== fields.length - 1) {
                    csv += &#x27;,&#x27;;
                }
            }
            csv += &#x27;\r\n&#x27;;
        }
        return csv;
    }

    // Export data, otherwise send error 500
    function exportSubscribers() {
        return dataProvider.Subscriber.findAll(options).then(function (data) {
            return formatCSV(data.toJSON(options));
        }).catch(function (error) {
            return Promise.reject(new errors.InternalServerError(error.message || error));
        });
    }

    tasks = [
        utils.handlePermissions(docName, &#x27;browse&#x27;),
        exportSubscribers
    ];

    return pipeline(tasks, options);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ghost.subscribers.importCSV" id="apidoc.element.ghost.subscribers.importCSV">
        function <span class="apidocSignatureSpan">ghost.subscribers.</span>importCSV
        <span class="apidocSignatureSpan">(options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">importCSV = function (options) {
    var tasks = [];
    options = options || {};

    function importCSV(options) {
        var filePath = options.path,
            fulfilled = 0,
            invalid = 0,
            duplicates = 0;

        return serverUtils.readCSV({
            path: filePath,
            columnsToExtract: [{name: &#x27;email&#x27;, lookup: /email/i}]
        }).then(function (result) {
            return Promise.all(result.map(function (entry) {
                return subscribers.add(
                    {subscribers: [{email: entry.email}]},
                    {context: options.context}
                ).reflect();
            })).each(function (inspection) {
                if (inspection.isFulfilled()) {
                    fulfilled = fulfilled + 1;
                } else {
                    if (inspection.reason() instanceof errors.ValidationError) {
                        duplicates = duplicates + 1;
                    } else {
                        invalid = invalid + 1;
                    }
                }
            });
        }).then(function () {
            return {
                meta: {
                    stats: {
                        imported: fulfilled,
                        duplicates: duplicates,
                        invalid: invalid
                    }
                }
            };
        }).finally(function () {
            // Remove uploaded file from tmp location
            return Promise.promisify(fs.unlink)(filePath);
        });
    }

    tasks = [
        utils.handlePermissions(docName, &#x27;add&#x27;),
        importCSV
    ];

    return pipeline(tasks, options);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ghost.subscribers.read" id="apidoc.element.ghost.subscribers.read">
        function <span class="apidocSignatureSpan">ghost.subscribers.</span>read
        <span class="apidocSignatureSpan">(options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function read(options) {
    var attrs = [&#x27;id&#x27;],
        tasks;

<span class="apidocCodeCommentSpan">    /**
     * ### Model Query
     * Make the call to the Model layer
     * @param {Object} options
     * @returns {Object} options
     */
</span>    function doQuery(options) {
        return dataProvider.Subscriber.findOne(options.data, _.omit(options, [&#x27;data&#x27;]));
    }

    // Push all of our tasks into a `tasks` array in the correct order
    tasks = [
        utils.validate(docName, {attrs: attrs}),
        utils.handlePermissions(docName, &#x27;read&#x27;),
        doQuery
    ];

    // Pipeline calls each task passing the result of one to be the arguments for the next
    return pipeline(tasks, options).then(function formatResponse(result) {
        if (result) {
            return {subscribers: [result.toJSON(options)]};
        }

        return Promise.reject(new errors.NotFoundError(i18n.t(&#x27;errors.api.subscribers.subscriberNotFound&#x27;)));
    });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    xmlrpc = require(&#x27;./data/xml/xmlrpc&#x27;),
    slack = require(&#x27;./data/slack&#x27;),
    GhostServer = require(&#x27;./ghost-server&#x27;),
    scheduling = require(&#x27;./scheduling&#x27;),
    dbHash;

function initDbHashAndFirstRun() {
    return api.settings.<span class="apidocCodeKeywordSpan">read</span>({key: &#x27;dbHash&#x27;, context: {internal: true}}).then
(function (response) {
var hash = response.settings[0].value,
    initHash;

dbHash = hash;

if (dbHash === null) {
    initHash = uuid.v4();
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.ghost.tag" id="apidoc.module.ghost.tag">module ghost.tag</a></h1>


    <h2>
        <a href="#apidoc.element.ghost.tag.Tag" id="apidoc.element.ghost.tag.Tag">
        function <span class="apidocSignatureSpan">ghost.tag.</span>Tag
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">Tag = function () {
  return Parent.apply(this, arguments);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ghost.tag.Tags" id="apidoc.element.ghost.tag.Tags">
        function <span class="apidocSignatureSpan">ghost.tag.</span>Tags
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">Tags = function () {
  return Parent.apply(this, arguments);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.ghost.tags" id="apidoc.module.ghost.tags">module ghost.tags</a></h1>


    <h2>
        <a href="#apidoc.element.ghost.tags.add" id="apidoc.element.ghost.tags.add">
        function <span class="apidocSignatureSpan">ghost.tags.</span>add
        <span class="apidocSignatureSpan">(object, options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function add(object, options) {
    var tasks;

<span class="apidocCodeCommentSpan">    /**
     * ### Model Query
     * Make the call to the Model layer
     * @param {Object} options
     * @returns {Object} options
     */
</span>    function doQuery(options) {
        return dataProvider.Tag.add(options.data.tags[0], _.omit(options, [&#x27;data&#x27;]));
    }

    // Push all of our tasks into a `tasks` array in the correct order
    tasks = [
        utils.validate(docName),
        utils.handlePermissions(docName, &#x27;add&#x27;),
        utils.convertOptions(allowedIncludes),
        doQuery
    ];

    // Pipeline calls each task passing the result of one to be the arguments for the next
    return pipeline(tasks, object, options).then(function formatResponse(result) {
        var tag = result.toJSON(options);

        return {tags: [tag]};
    });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
getSeenNotifications = api.settings.read(_.extend({key: &#x27;seenNotifications&#x27;}, internal));

return Promise.join(getAllNotifications, getSeenNotifications, function joined(all, seen) {
    var isSeen      = _.includes(JSON.parse(seen.settings[0].value || []), notification.uuid),
        isDuplicate = _.some(all.notifications, {message: notification.message});

    if (!isSeen &#x26;&#x26; !isDuplicate) {
        return api.notifications.<span class="apidocCodeKeywordSpan">add</span>({notifications: [notification]}, {context: {internal
: true}});
    }
});
}

function updateCheckData() {
var data = {},
    mailConfig = config.mail;
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ghost.tags.browse" id="apidoc.element.ghost.tags.browse">
        function <span class="apidocSignatureSpan">ghost.tags.</span>browse
        <span class="apidocSignatureSpan">(options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function browse(options) {
    var tasks;

<span class="apidocCodeCommentSpan">    /**
     * ### Model Query
     * Make the call to the Model layer
     * @param {Object} options
     * @returns {Object} options
     */
</span>    function doQuery(options) {
        return dataProvider.Tag.findPage(options);
    }

    // Push all of our tasks into a `tasks` array in the correct order
    tasks = [
        utils.validate(docName, {opts: utils.browseDefaultOptions}),
        utils.handlePublicPermissions(docName, &#x27;browse&#x27;),
        utils.convertOptions(allowedIncludes),
        doQuery
    ];

    // Pipeline calls each task passing the result of one to be the arguments for the next
    return pipeline(tasks, options);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
status: &#x27;alert&#x27;,
type: &#x27;info&#x27;,
custom: true,
uuid: message.id,
dismissible: true,
message: message.content
    },
    getAllNotifications = api.notifications.<span class="apidocCodeKeywordSpan">browse</span>({context: {internal: true}}),
    getSeenNotifications = api.settings.read(_.extend({key: &#x27;seenNotifications&#x27;}, internal));

    return Promise.join(getAllNotifications, getSeenNotifications, function joined(all, seen) {
var isSeen      = _.includes(JSON.parse(seen.settings[0].value || []), notification.uuid),
    isDuplicate = _.some(all.notifications, {message: notification.message});

if (!isSeen &#x26;&#x26; !isDuplicate) {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ghost.tags.destroy" id="apidoc.element.ghost.tags.destroy">
        function <span class="apidocSignatureSpan">ghost.tags.</span>destroy
        <span class="apidocSignatureSpan">(options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function destroy(options) {
    var tasks;

<span class="apidocCodeCommentSpan">    /**
     * ### Delete Tag
     * Make the call to the Model layer
     * @param {Object} options
     */
</span>    function deleteTag(options) {
        return dataProvider.Tag.destroy(options).return(null);
    }

    // Push all of our tasks into a `tasks` array in the correct order
    tasks = [
        utils.validate(docName, {opts: utils.idDefaultOptions}),
        utils.handlePermissions(docName, &#x27;destroy&#x27;),
        utils.convertOptions(allowedIncludes),
        deleteTag
    ];

    // Pipeline calls each task passing the result of one to be the arguments for the next
    return pipeline(tasks, options);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
GhostServer.prototype.closeConnections = function () {
   var self = this;

   Object.keys(self.connections).forEach(function (socketId) {
       var socket = self.connections[socketId];

       if (socket) {
           socket.<span class="apidocCodeKeywordSpan">destroy</span>();
       }
   });
};

/**
* ### Log Start Messages
*/
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ghost.tags.edit" id="apidoc.element.ghost.tags.edit">
        function <span class="apidocSignatureSpan">ghost.tags.</span>edit
        <span class="apidocSignatureSpan">(object, options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function edit(object, options) {
    var tasks;

<span class="apidocCodeCommentSpan">    /**
     * Make the call to the Model layer
     * @param {Object} options
     * @returns {Object} options
     */
</span>    function doQuery(options) {
        return dataProvider.Tag.edit(options.data.tags[0], _.omit(options, [&#x27;data&#x27;]));
    }

    // Push all of our tasks into a `tasks` array in the correct order
    tasks = [
        utils.validate(docName, {opts: utils.idDefaultOptions}),
        utils.handlePermissions(docName, &#x27;edit&#x27;),
        utils.convertOptions(allowedIncludes),
        doQuery
    ];

    // Pipeline calls each task passing the result of one to be the arguments for the next
    return pipeline(tasks, object, options).then(function formatResponse(result) {
        if (result) {
            var tag = result.toJSON(options);

            return {tags: [tag]};
        }

        return Promise.reject(new errors.NotFoundError(i18n.t(&#x27;errors.api.tags.tagNotFound&#x27;)));
    });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
var hash = response.settings[0].value,
    initHash;

dbHash = hash;

if (dbHash === null) {
    initHash = uuid.v4();
    return api.settings.<span class="apidocCodeKeywordSpan">edit</span>({settings: [{key: &#x27;dbHash&#x27;, value: initHash}]}, {
context: {internal: true}})
        .then(function (response) {
            dbHash = response.settings[0].value;
            return dbHash;
            // Use `then` here to do &#x27;first run&#x27; actions
        });
}
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ghost.tags.read" id="apidoc.element.ghost.tags.read">
        function <span class="apidocSignatureSpan">ghost.tags.</span>read
        <span class="apidocSignatureSpan">(options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function read(options) {
    var attrs = [&#x27;id&#x27;, &#x27;slug&#x27;, &#x27;visibility&#x27;],
        tasks;

<span class="apidocCodeCommentSpan">    /**
     * ### Model Query
     * Make the call to the Model layer
     * @param {Object} options
     * @returns {Object} options
     */
</span>    function doQuery(options) {
        return dataProvider.Tag.findOne(options.data, _.omit(options, [&#x27;data&#x27;]));
    }

    // Push all of our tasks into a `tasks` array in the correct order
    tasks = [
        utils.validate(docName, {attrs: attrs}),
        utils.handlePublicPermissions(docName, &#x27;read&#x27;),
        utils.convertOptions(allowedIncludes),
        doQuery
    ];

    // Pipeline calls each task passing the result of one to be the arguments for the next
    return pipeline(tasks, options).then(function formatResponse(result) {
        if (result) {
            return {tags: [result.toJSON(options)]};
        }

        return Promise.reject(new errors.NotFoundError(i18n.t(&#x27;errors.api.tags.tagNotFound&#x27;)));
    });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    xmlrpc = require(&#x27;./data/xml/xmlrpc&#x27;),
    slack = require(&#x27;./data/slack&#x27;),
    GhostServer = require(&#x27;./ghost-server&#x27;),
    scheduling = require(&#x27;./scheduling&#x27;),
    dbHash;

function initDbHashAndFirstRun() {
    return api.settings.<span class="apidocCodeKeywordSpan">read</span>({key: &#x27;dbHash&#x27;, context: {internal: true}}).then
(function (response) {
var hash = response.settings[0].value,
    initHash;

dbHash = hash;

if (dbHash === null) {
    initHash = uuid.v4();
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.ghost.template" id="apidoc.module.ghost.template">module ghost.template</a></h1>


    <h2>
        <a href="#apidoc.element.ghost.template.execute" id="apidoc.element.ghost.template.execute">
        function <span class="apidocSignatureSpan">ghost.template.</span>execute
        <span class="apidocSignatureSpan">(name, context, options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">execute = function (name, context, options) {
    var partial = hbs.handlebars.partials[name];

    if (partial === undefined) {
        errors.logAndThrowError(i18n.t(&#x27;warnings.helpers.template.templateNotFound&#x27;, {name: name}));
        return;
    }

    // If the partial view is not compiled, it compiles and saves in handlebars
    if (typeof partial === &#x27;string&#x27;) {
        hbs.registerPartial(partial);
    }

    return new hbs.handlebars.SafeString(partial(context, options));
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
forceMigration: process.env.FORCE_MIGRATION
        }), maintenanceState;

        if (response.migrate === true) {
maintenanceState = config.maintenance.enabled || false;
config.maintenance.enabled = true;

migrations.update.<span class="apidocCodeKeywordSpan">execute</span>({
    fromVersion: currentDatabaseVersion,
    toVersion: versioning.getNewestDatabaseVersion(),
    forceMigration: process.env.FORCE_MIGRATION
}).then(function () {
    config.maintenance.enabled = maintenanceState;
}).catch(function (err) {
    if (!err) {
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.ghost.theme_handler" id="apidoc.module.ghost.theme_handler">module ghost.theme_handler</a></h1>


    <h2>
        <a href="#apidoc.element.ghost.theme_handler.activateTheme" id="apidoc.element.ghost.theme_handler.activateTheme">
        function <span class="apidocSignatureSpan">ghost.theme_handler.</span>activateTheme
        <span class="apidocSignatureSpan">(blogApp, activeTheme)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function activateTheme(blogApp, activeTheme) {
    var hbsOptions,
        themePartials = path.join(config.paths.themePath, activeTheme, &#x27;partials&#x27;);

    // clear the view cache
    blogApp.cache = {};
    // reset the asset hash
    config.assetHash = null;

    // set view engine
    hbsOptions = {
        partialsDir: [config.paths.helperTemplates],
        onCompile: function onCompile(exhbs, source) {
            return exhbs.handlebars.compile(source, {preventIndent: true});
        }
    };

    fs.stat(themePartials, function stat(err, stats) {
        // Check that the theme has a partials directory before trying to use it
        if (!err &#x26;&#x26; stats &#x26;&#x26; stats.isDirectory()) {
            hbsOptions.partialsDir.push(themePartials);
        }
    });

    blogApp.engine(&#x27;hbs&#x27;, hbs.express3(hbsOptions));

    // Update user error template
    errors.updateActiveTheme(activeTheme);

    // Set active theme variable on the express server
    blogApp.set(&#x27;activeTheme&#x27;, activeTheme);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
                // processing can continue.
                blogApp.engine(&#x27;hbs&#x27;, hbs.express3());
                errors.logWarn(i18n.t(&#x27;errors.middleware.themehandler.missingTheme&#x27;, {theme: activeTheme.value}));

                return next();
            }
        } else {
            themeHandler.<span class="apidocCodeKeywordSpan">activateTheme</span>(blogApp, activeTheme.value);
        }
    }
    next();
}).catch(function handleError(err) {
    // Trying to start up without the active theme present, setup a simple hbs instance
    // and render an error page straight away.
    blogApp.engine(&#x27;hbs&#x27;, hbs.express3());
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ghost.theme_handler.configHbsForContext" id="apidoc.element.ghost.theme_handler.configHbsForContext">
        function <span class="apidocSignatureSpan">ghost.theme_handler.</span>configHbsForContext
        <span class="apidocSignatureSpan">(req, res, next)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function configHbsForContext(req, res, next) {
    var themeData = _.cloneDeep(config.theme),
        labsData = _.cloneDeep(config.labs),
        blogApp = req.app;

    if (req.secure &#x26;&#x26; config.urlSSL) {
        // For secure requests override .url property with the SSL version
        themeData.url = config.urlSSL.replace(/\/$/, &#x27;&#x27;);
    }

    // Change camelCase to snake_case
    themeData.posts_per_page = themeData.postsPerPage;
    delete themeData.postsPerPage;

    hbs.updateTemplateOptions({data: {blog: themeData, labs: labsData}});

    if (config.paths.themePath &#x26;&#x26; blogApp.get(&#x27;activeTheme&#x27;)) {
        blogApp.set(&#x27;views&#x27;, path.join(config.paths.themePath, blogApp.get(&#x27;activeTheme&#x27;)));
    }

    // Pass &#x27;secure&#x27; flag to the view engine
    // so that templates can choose &#x27;url&#x27; vs &#x27;urlSSL&#x27;
    res.locals.secure = req.secure;

    next();
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ghost.theme_handler.ghostLocals" id="apidoc.element.ghost.theme_handler.ghostLocals">
        function <span class="apidocSignatureSpan">ghost.theme_handler.</span>ghostLocals
        <span class="apidocSignatureSpan">(req, res, next)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function ghostLocals(req, res, next) {
    // Make sure we have a locals value.
    res.locals = res.locals || {};
    res.locals.version = config.ghostVersion;
    res.locals.safeVersion = config.ghostVersion.match(/^(\d+\.)?(\d+)/)[0];
    // relative path from the URL
    res.locals.relativeUrl = req.path;

    next();
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ghost.theme_handler.updateActiveTheme" id="apidoc.element.ghost.theme_handler.updateActiveTheme">
        function <span class="apidocSignatureSpan">ghost.theme_handler.</span>updateActiveTheme
        <span class="apidocSignatureSpan">(req, res, next)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function updateActiveTheme(req, res, next) {
    var blogApp = req.app;

    api.settings.read({context: {internal: true}, key: &#x27;activeTheme&#x27;}).then(function then(response) {
        var activeTheme = response.settings[0];

        // Check if the theme changed
        if (activeTheme.value !== blogApp.get(&#x27;activeTheme&#x27;)) {
            // Change theme
            if (!config.paths.availableThemes.hasOwnProperty(activeTheme.value)) {
                if (!res.isAdmin) {
                    // Throw an error if the theme is not available, but not on the admin UI
                    return errors.throwError(i18n.t(&#x27;errors.middleware.themehandler.missingTheme&#x27;, {theme: activeTheme.value}));
                } else {
                    // At this point the activated theme is not present and the current
                    // request is for the admin client.  In order to allow the user access
                    // to the admin client we set an hbs instance on the app so that middleware
                    // processing can continue.
                    blogApp.engine(&#x27;hbs&#x27;, hbs.express3());
                    errors.logWarn(i18n.t(&#x27;errors.middleware.themehandler.missingTheme&#x27;, {theme: activeTheme.value}));

                    return next();
                }
            } else {
                themeHandler.activateTheme(blogApp, activeTheme.value);
            }
        }
        next();
    }).catch(function handleError(err) {
        // Trying to start up without the active theme present, setup a simple hbs instance
        // and render an error page straight away.
        blogApp.engine(&#x27;hbs&#x27;, hbs.express3());
        next(err);
    });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
            hbsOptions.partialsDir.push(themePartials);
        }
    });

    blogApp.engine(&#x27;hbs&#x27;, hbs.express3(hbsOptions));

    // Update user error template
    errors.<span class="apidocCodeKeywordSpan">updateActiveTheme</span>(activeTheme);

    // Set active theme variable on the express server
    blogApp.set(&#x27;activeTheme&#x27;, activeTheme);
},

// ### updateActiveTheme
// Updates the blogApp&#x27;s activeTheme variable and subsequently
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.ghost.themes" id="apidoc.module.ghost.themes">module ghost.themes</a></h1>


    <h2>
        <a href="#apidoc.element.ghost.themes.destroy" id="apidoc.element.ghost.themes.destroy">
        function <span class="apidocSignatureSpan">ghost.themes.</span>destroy
        <span class="apidocSignatureSpan">(options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function destroy(options) {
    var name = options.name,
        theme,
        storageAdapter = storage.getStorage(&#x27;themes&#x27;);

    return utils.handlePermissions(&#x27;themes&#x27;, &#x27;destroy&#x27;)(options)
        .then(function () {
            if (name === &#x27;casper&#x27;) {
                throw new errors.ValidationError(i18n.t(&#x27;errors.api.themes.destroyCasper&#x27;));
            }

            theme = config.paths.availableThemes[name];

            if (!theme) {
                throw new errors.NotFoundError(i18n.t(&#x27;errors.api.themes.themeDoesNotExist&#x27;));
            }

            events.emit(&#x27;theme.deleted&#x27;, name);
            return storageAdapter.delete(name, config.paths.themePath);
        })
        .then(function () {
            return config.loadThemes();
        })
        .then(function () {
            return settings.updateSettingsCache();
        });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
GhostServer.prototype.closeConnections = function () {
   var self = this;

   Object.keys(self.connections).forEach(function (socketId) {
       var socket = self.connections[socketId];

       if (socket) {
           socket.<span class="apidocCodeKeywordSpan">destroy</span>();
       }
   });
};

/**
* ### Log Start Messages
*/
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ghost.themes.download" id="apidoc.element.ghost.themes.download">
        function <span class="apidocSignatureSpan">ghost.themes.</span>download
        <span class="apidocSignatureSpan">(options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function download(options) {
    var themeName = options.name,
        theme = config.paths.availableThemes[themeName],
        storageAdapter = storage.getStorage(&#x27;themes&#x27;);

    if (!theme) {
        return Promise.reject(new errors.BadRequestError(i18n.t(&#x27;errors.api.themes.invalidRequest&#x27;)));
    }

    return utils.handlePermissions(&#x27;themes&#x27;, &#x27;read&#x27;)(options)
        .then(function () {
            events.emit(&#x27;theme.downloaded&#x27;, themeName);
            return storageAdapter.serve({isTheme: true, name: themeName});
        });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ghost.themes.upload" id="apidoc.element.ghost.themes.upload">
        function <span class="apidocSignatureSpan">ghost.themes.</span>upload
        <span class="apidocSignatureSpan">(options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function upload(options) {
    options = options || {};

    // consistent filename uploads
    options.originalname = options.originalname.toLowerCase();

    var storageAdapter = storage.getStorage(&#x27;themes&#x27;),
    zip = {
        path: options.path,
        name: options.originalname,
        shortName: storageAdapter.getSanitizedFileName(options.originalname.split(&#x27;.zip&#x27;)[0])
    }, theme;

    // check if zip name is casper.zip
    if (zip.name === &#x27;casper.zip&#x27;) {
        throw new errors.ValidationError(i18n.t(&#x27;errors.api.themes.overrideCasper&#x27;));
    }

    return utils.handlePermissions(&#x27;themes&#x27;, &#x27;add&#x27;)(options)
        .then(function () {
            return gscan.checkZip(zip, {keepExtractedDir: true});
        })
        .then(function (_theme) {
            theme = _theme;
            theme = gscan.format(theme);

            if (!theme.results.error.length) {
                return;
            }

            throw new errors.ThemeValidationError(
                i18n.t(&#x27;errors.api.themes.invalidTheme&#x27;),
                theme.results.error
            );
        })
        .then(function () {
            return storageAdapter.exists(config.paths.themePath + &#x27;/&#x27; + zip.shortName);
        })
        .then(function (themeExists) {
            // delete existing theme
            if (themeExists) {
                return storageAdapter.delete(zip.shortName, config.paths.themePath);
            }
        })
        .then(function () {
            events.emit(&#x27;theme.uploaded&#x27;, zip.shortName);
            // store extracted theme
            return storageAdapter.save({
                name: zip.shortName,
                path: theme.path
            }, config.paths.themePath);
        })
        .then(function () {
            // force reload of availableThemes
            // right now the logic is in the ConfigManager
            // if we create a theme collection, we don&#x27;t have to read them from disk
            return config.loadThemes();
        })
        .then(function () {
            // the settings endpoint is used to fetch the availableThemes
            // so we have to force updating the in process cache
            return settings.updateSettingsCache();
        })
        .then(function (settings) {
            // gscan theme structure !== ghost theme structure
            var themeObject = _.find(settings.availableThemes.value, {name: zip.shortName}) || {};
            if (theme.results.warning.length &#x3e; 0) {
                themeObject.warnings = _.cloneDeep(theme.results.warning);
            }
            return {themes: [themeObject]};
        })
        .finally(function () {
            // remove zip upload from multer
            // happens in background
            Promise.promisify(fs.removeSync)(zip.path)
                .catch(function (err) {
                    errors.logError(err);
                });

            // remove extracted dir from gscan
            // happens in background
            if (theme) {
                Promise.promisify(fs.removeSync)(theme.path)
                    .catch(function (err) {
                        errors.logError(err);
                    });
            }
        });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
// ## Subscribers
router.get(&#x27;/subscribers&#x27;, middleware.api.labs.subscribers, authenticatePrivate, api.http(api.subscribers.browse));
router.get(&#x27;/subscribers/csv&#x27;, middleware.api.labs.subscribers, authenticatePrivate, api.http(api.subscribers.exportCSV
));
router.post(&#x27;/subscribers/csv&#x27;,
    middleware.api.labs.subscribers,
    authenticatePrivate,
    middleware.upload.single(&#x27;subscribersfile&#x27;),
    middleware.validation.<span class="apidocCodeKeywordSpan">upload</span>({type: &#x27;subscribers&#x27;}),
    api.http(api.subscribers.importCSV)
);
router.get(&#x27;/subscribers/:id&#x27;, middleware.api.labs.subscribers, authenticatePrivate, api.http(api.subscribers.read));
router.post(&#x27;/subscribers&#x27;, middleware.api.labs.subscribers, authenticatePublic, api.http(api.subscribers.add));
router.put(&#x27;/subscribers/:id&#x27;, middleware.api.labs.subscribers, authenticatePrivate, api.http(api.subscribers.edit));
router.del(&#x27;/subscribers/:id&#x27;,  middleware.api.labs.subscribers, authenticatePrivate, api.http(api.subscribers.destroy
));
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.ghost.update_check" id="apidoc.module.ghost.update_check">module ghost.update_check</a></h1>


    <h2>
        <a href="#apidoc.element.ghost.update_check.update_check" id="apidoc.element.ghost.update_check.update_check">
        function <span class="apidocSignatureSpan">ghost.</span>update_check
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function updateCheck() {
    // The check will not happen if:
    // 1. updateCheck is defined as false in config.js
    // 2. we&#x27;ve already done a check this session
    // 3. we&#x27;re not in production or development mode
    // TODO: need to remove config.updateCheck in favor of config.privacy.updateCheck in future version (it is now deprecated)
    if (config.updateCheck === false || config.isPrivacyDisabled(&#x27;useUpdateCheck&#x27;) || _.indexOf(allowedCheckEnvironments, process
.env.NODE_ENV) === -1) {
        // No update check
        return Promise.resolve();
    } else {
        return api.settings.read(_.extend({key: &#x27;nextUpdateCheck&#x27;}, internal)).then(function then(result) {
            var nextUpdateCheck = result.settings[0];

            if (nextUpdateCheck &#x26;&#x26; nextUpdateCheck.value &#x26;&#x26; nextUpdateCheck.value &#x3e; moment().unix()) {
                // It&#x27;s not time to check yet
                return;
            } else {
                // We need to do a check
                return updateCheckRequest()
                    .then(updateCheckResponse)
                    .catch(updateCheckError);
            }
        }).catch(updateCheckError);
    }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ghost.update_check.showUpdateNotification" id="apidoc.element.ghost.update_check.showUpdateNotification">
        function <span class="apidocSignatureSpan">ghost.update_check.</span>showUpdateNotification
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function showUpdateNotification() {
    return api.settings.read(_.extend({key: &#x27;displayUpdateNotification&#x27;}, internal)).then(function then(response) {
        var display = response.settings[0];

        // Version 0.4 used boolean to indicate the need for an update. This special case is
        // translated to the version string.
        // TODO: remove in future version.
        if (display.value === &#x27;false&#x27; || display.value === &#x27;true&#x27; || display.value === &#x27;1&#x27; || display.value === &#x27;0&#x27;) {
            display.value = &#x27;0.4.0&#x27;;
        }

        if (display &#x26;&#x26; display.value &#x26;&#x26; currentVersion &#x26;&#x26; semver.gt(display.value, currentVersion)) {
            return display.value;
        }

        return false;
    });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    res.render(&#x27;default&#x27;, {
        configuration: configuration
    });
});
        }

        updateCheck().then(function then() {
return updateCheck.<span class="apidocCodeKeywordSpan">showUpdateNotification</span>();
        }).then(function then(updateVersion) {
if (!updateVersion) {
    return;
}

var notification = {
    status: &#x27;alert&#x27;,
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.ghost.upload" id="apidoc.module.ghost.upload">module ghost.upload</a></h1>


    <h2>
        <a href="#apidoc.element.ghost.upload.add" id="apidoc.element.ghost.upload.add">
        function <span class="apidocSignatureSpan">ghost.upload.</span>add
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">add = function () {
    var ret = new Promise(INTERNAL);
    ret._captureStackTrace();
    ret._pushContext();
    var value = tryCatch(fn).apply(this, arguments);
    var promiseCreated = ret._popContext();
    debug.checkForgottenReturns(
        value, promiseCreated, &#x22;Promise.method&#x22;, ret);
    ret._resolveFromSyncValue(value);
    return ret;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
getSeenNotifications = api.settings.read(_.extend({key: &#x27;seenNotifications&#x27;}, internal));

return Promise.join(getAllNotifications, getSeenNotifications, function joined(all, seen) {
    var isSeen      = _.includes(JSON.parse(seen.settings[0].value || []), notification.uuid),
        isDuplicate = _.some(all.notifications, {message: notification.message});

    if (!isSeen &#x26;&#x26; !isDuplicate) {
        return api.notifications.<span class="apidocCodeKeywordSpan">add</span>({notifications: [notification]}, {context: {internal
: true}});
    }
});
}

function updateCheckData() {
var data = {},
    mailConfig = config.mail;
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.ghost.url" id="apidoc.module.ghost.url">module ghost.url</a></h1>


    <h2>
        <a href="#apidoc.element.ghost.url.apiUrl" id="apidoc.element.ghost.url.apiUrl">
        function <span class="apidocSignatureSpan">ghost.url.</span>apiUrl
        <span class="apidocSignatureSpan">(options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function apiUrl(options) {
    options = options || {cors: false};

    // @TODO unify this with urlFor
    var url;

    if (ghostConfig.forceAdminSSL) {
        url = (ghostConfig.urlSSL || ghostConfig.url).replace(/^.*?:\/\//g, &#x27;https://&#x27;);
    } else if (ghostConfig.urlSSL) {
        url = ghostConfig.urlSSL.replace(/^.*?:\/\//g, &#x27;https://&#x27;);
    } else if (ghostConfig.url.match(/^https:/)) {
        url = ghostConfig.url;
    } else {
        if (options.cors === false) {
            url = ghostConfig.url;
        } else {
            url = ghostConfig.url.replace(/^.*?:\/\//g, &#x27;//&#x27;);
        }
    }

    return url.replace(/\/$/, &#x27;&#x27;) + apiPath + &#x27;/&#x27;;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

        return new GhostServer(parentApp);
    }).then(function (_ghostServer) {
        ghostServer = _ghostServer;

        // scheduling can trigger api requests, that&#x27;s why we initialize the module after the ghost server creation
        // scheduling module can create x schedulers with different adapters
        return scheduling.init(_.extend(config.scheduling, {apiUrl: config.<span class="apidocCodeKeywordSpan">apiUrl</span>()}));
    }).then(function () {
        return ghostServer;
    });
}

module.exports = init;
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ghost.url.getBaseUrl" id="apidoc.element.ghost.url.getBaseUrl">
        function <span class="apidocSignatureSpan">ghost.url.</span>getBaseUrl
        <span class="apidocSignatureSpan">(secure)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function getBaseUrl(secure) {
    if (secure &#x26;&#x26; ghostConfig.urlSSL) {
        return ghostConfig.urlSSL;
    } else {
        if (secure) {
            return ghostConfig.url.replace(&#x27;http://&#x27;, &#x27;https://&#x27;);
        } else {
            return ghostConfig.url;
        }
    }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ghost.url.setConfig" id="apidoc.element.ghost.url.setConfig">
        function <span class="apidocSignatureSpan">ghost.url.</span>setConfig
        <span class="apidocSignatureSpan">(config)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function setConfig(config) {
    ghostConfig = config;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ghost.url.urlFor" id="apidoc.element.ghost.url.urlFor">
        function <span class="apidocSignatureSpan">ghost.url.</span>urlFor
        <span class="apidocSignatureSpan">(context, data, absolute)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function urlFor(context, data, absolute) {
    var urlPath = &#x27;/&#x27;,
        secure, imagePathRe,
        knownObjects = [&#x27;post&#x27;, &#x27;tag&#x27;, &#x27;author&#x27;, &#x27;image&#x27;, &#x27;nav&#x27;], baseUrl,
        hostname,

    // this will become really big
    knownPaths = {
        home: &#x27;/&#x27;,
        rss: &#x27;/rss/&#x27;,
        api: apiPath,
        sitemap_xsl: &#x27;/sitemap.xsl&#x27;
    };

    // Make data properly optional
    if (_.isBoolean(data)) {
        absolute = data;
        data = null;
    }

    // Can pass &#x27;secure&#x27; flag in either context or data arg
    secure = (context &#x26;&#x26; context.secure) || (data &#x26;&#x26; data.secure);

    if (_.isObject(context) &#x26;&#x26; context.relativeUrl) {
        urlPath = context.relativeUrl;
    } else if (_.isString(context) &#x26;&#x26; _.indexOf(knownObjects, context) !== -1) {
        // trying to create a url for an object
        if (context === &#x27;post&#x27; &#x26;&#x26; data.post) {
            urlPath = data.post.url;
            secure = data.secure;
        } else if (context === &#x27;tag&#x27; &#x26;&#x26; data.tag) {
            urlPath = urlJoin(&#x27;/&#x27;, ghostConfig.routeKeywords.tag, data.tag.slug, &#x27;/&#x27;);
            secure = data.tag.secure;
        } else if (context === &#x27;author&#x27; &#x26;&#x26; data.author) {
            urlPath = urlJoin(&#x27;/&#x27;, ghostConfig.routeKeywords.author, data.author.slug, &#x27;/&#x27;);
            secure = data.author.secure;
        } else if (context === &#x27;image&#x27; &#x26;&#x26; data.image) {
            urlPath = data.image;
            imagePathRe = new RegExp(&#x27;^&#x27; + ghostConfig.paths.subdir + &#x27;/&#x27; + ghostConfig.paths.imagesRelPath);
            absolute = imagePathRe.test(data.image) ? absolute : false;
            secure = data.image.secure;

            if (absolute) {
                // Remove the sub-directory from the URL because ghostConfig will add it back.
                urlPath = urlPath.replace(new RegExp(&#x27;^&#x27; + ghostConfig.paths.subdir), &#x27;&#x27;);
                baseUrl = getBaseUrl(secure).replace(/\/$/, &#x27;&#x27;);
                urlPath = baseUrl + urlPath;
            }

            return urlPath;
        } else if (context === &#x27;nav&#x27; &#x26;&#x26; data.nav) {
            urlPath = data.nav.url;
            secure = data.nav.secure || secure;
            baseUrl = getBaseUrl(secure);
            hostname = baseUrl.split(&#x27;//&#x27;)[1] + ghostConfig.paths.subdir;
            if (urlPath.indexOf(hostname) &#x3e; -1
                &#x26;&#x26; !urlPath.split(hostname)[0].match(/\.|mailto:/)
                &#x26;&#x26; urlPath.split(hostname)[1].substring(0,1) !== &#x27;:&#x27;) {
                // make link relative to account for possible
                // mismatch in http/https etc, force absolute
                // do not do so if link is a subdomain of blog url
                // or if hostname is inside of the slug
                // or if slug is a port
                urlPath = urlPath.split(hostname)[1];
                if (urlPath.substring(0, 1) !== &#x27;/&#x27;) {
                    urlPath = &#x27;/&#x27; + urlPath;
                }
                absolute = true;
            }
        }
        // other objects are recognised but not yet supported
    } else if (_.isString(context) &#x26;&#x26; _.indexOf(_.keys(knownPaths), context) !== -1) {
        // trying to create a url for a named path
        urlPath = knownPaths[context] || &#x27;/&#x27;;
    }

    // This url already has a protocol so is likely an external url to be returned
    // or it is an alternative scheme, protocol-less, or an anchor-only path
    if (urlPath &#x26;&#x26; (urlPath.indexOf(&#x27;://&#x27;) !== -1 || urlPath.match(/^(\/\/|#|[a-zA-Z0-9\-]+:)/))) {
        return urlPath;
    }

    return createUrl(urlPath, absolute, secure);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

var autolink = _.isString(options.hash.autolink) &#x26;&#x26; options.hash.autolink === &#x27;false&#x27; ? false : true,
    output = &#x27;&#x27;;

if (this.author &#x26;&#x26; this.author.name) {
    if (autolink) {
        output = utils.linkTemplate({
            url: config.<span class="apidocCodeKeywordSpan">urlFor</span>(&#x27;author&#x27;, {author: this.author}),
            text: _.escape(this.author.name)
        });
    } else {
        output = _.escape(this.author.name);
    }
}
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ghost.url.urlJoin" id="apidoc.element.ghost.url.urlJoin">
        function <span class="apidocSignatureSpan">ghost.url.</span>urlJoin
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function urlJoin() {
    var args = Array.prototype.slice.call(arguments),
        prefixDoubleSlash = false,
        subdir = ghostConfig.paths.subdir.replace(/^\/|\/+$/, &#x27;&#x27;),
        subdirRegex,
        url;

    // Remove empty item at the beginning
    if (args[0] === &#x27;&#x27;) {
        args.shift();
    }

    // Handle schemeless protocols
    if (args[0].indexOf(&#x27;//&#x27;) === 0) {
        prefixDoubleSlash = true;
    }

    // join the elements using a slash
    url = args.join(&#x27;/&#x27;);

    // Fix multiple slashes
    url = url.replace(/(^|[^:])\/\/+/g, &#x27;$1/&#x27;);

    // Put the double slash back at the beginning if this was a schemeless protocol
    if (prefixDoubleSlash) {
        url = url.replace(/^\//, &#x27;//&#x27;);
    }

    // Deduplicate subdirectory
    if (subdir) {
        subdirRegex = new RegExp(subdir + &#x27;\/&#x27; + subdir + &#x27;\/&#x27;);
        url = url.replace(subdirRegex, subdir + &#x27;/&#x27;);
    }

    return url;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
            }

            // compose an absolute URL

            // if the relative URL begins with a &#x27;/&#x27; use the blog URL (including sub-directory)
            // as the base URL, otherwise use the post&#x27;s URL.
            baseUrl = attributeValue[0] === &#x27;/&#x27; ? siteUrl : itemUrl;
            attributeValue = config.<span class="apidocCodeKeywordSpan">urlJoin</span>(baseUrl, attributeValue);
            el.attr(attributeName, attributeValue);
        });
    });

    return htmlContent;
}
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ghost.url.urlPathForPost" id="apidoc.element.ghost.url.urlPathForPost">
        function <span class="apidocSignatureSpan">ghost.url.</span>urlPathForPost
        <span class="apidocSignatureSpan">(post)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function urlPathForPost(post) {
    var output = &#x27;&#x27;,
        permalinks = ghostConfig.theme.permalinks,
        publishedAtMoment = moment.tz(post.published_at || Date.now(), ghostConfig.theme.timezone),
        tags = {
            year:   function () { return publishedAtMoment.format(&#x27;YYYY&#x27;); },
            month:  function () { return publishedAtMoment.format(&#x27;MM&#x27;); },
            day:    function () { return publishedAtMoment.format(&#x27;DD&#x27;); },
            author: function () { return post.author.slug; },
            slug:   function () { return post.slug; },
            id:     function () { return post.id; }
        };

    if (post.page) {
        output += &#x27;/:slug/&#x27;;
    } else {
        output += permalinks;
    }

    // replace tags like :slug or :year with actual values
    output = output.replace(/(:[a-z]+)/g, function (match) {
        if (_.has(tags, match.substr(1))) {
            return tags[match.substr(1)]();
        }
    });

    return output;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

    if (!options.columns || (options.columns &#x26;&#x26; options.columns.indexOf(&#x27;author&#x27;) &#x3e; -1)) {
        attrs.author = attrs.author || attrs.author_id;
        delete attrs.author_id;
    }

    if (!options.columns || (options.columns &#x26;&#x26; options.columns.indexOf(&#x27;url&#x27;) &#x3e; -1)) {
        attrs.url = config.<span class="apidocCodeKeywordSpan">urlPathForPost</span>(attrs);
    }

    return attrs;
},
enforcedFilters: function enforcedFilters() {
    return this.isPublicContext() ? &#x27;status:published&#x27; : null;
},
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.ghost.user" id="apidoc.module.ghost.user">module ghost.user</a></h1>


    <h2>
        <a href="#apidoc.element.ghost.user.User" id="apidoc.element.ghost.user.User">
        function <span class="apidocSignatureSpan">ghost.user.</span>User
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">User = function () {
  return Parent.apply(this, arguments);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ghost.user.Users" id="apidoc.element.ghost.user.Users">
        function <span class="apidocSignatureSpan">ghost.user.</span>Users
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">Users = function () {
  return Parent.apply(this, arguments);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.ghost.users" id="apidoc.module.ghost.users">module ghost.users</a></h1>


    <h2>
        <a href="#apidoc.element.ghost.users.add" id="apidoc.element.ghost.users.add">
        function <span class="apidocSignatureSpan">ghost.users.</span>add
        <span class="apidocSignatureSpan">(object, options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function add(object, options) {
    var tasks;

<span class="apidocCodeCommentSpan">    /**
     * ### Handle Permissions
     * We need to be an authorised user to perform this action
     * @param {Object} options
     * @returns {Object} options
     */
</span>    function handlePermissions(options) {
        var newUser = options.data.users[0];
        return canThis(options.context).add.user(options.data).then(function () {
            if (newUser.roles &#x26;&#x26; newUser.roles[0]) {
                var roleId = parseInt(newUser.roles[0].id || newUser.roles[0], 10);

                // @TODO move this logic to permissible
                // Make sure user is allowed to add a user with this role
                return dataProvider.Role.findOne({id: roleId}).then(function (role) {
                    if (role.get(&#x27;name&#x27;) === &#x27;Owner&#x27;) {
                        return Promise.reject(new errors.NoPermissionError(i18n.t(&#x27;errors.api.users.notAllowedToCreateOwner&#x27;)));
                    }

                    return canThis(options.context).assign.role(role);
                }).then(function () {
                    return options;
                });
            }

            return options;
        }).catch(function handleError(error) {
            return errors.formatAndRejectAPIError(error, i18n.t(&#x27;errors.api.users.noPermissionToAddUser&#x27;));
        });
    }

    /**
     * ### Model Query
     * Make the call to the Model layer
     * @param {Object} options
     * @returns {Object} options
     */
    function doQuery(options) {
        var newUser = options.data.users[0],
            user;

        if (newUser.email) {
            newUser.name = newUser.email.substring(0, newUser.email.indexOf(&#x27;@&#x27;));
            newUser.password = globalUtils.uid(50);
            newUser.status = &#x27;invited&#x27;;
        } else {
            return Promise.reject(new errors.BadRequestError(i18n.t(&#x27;errors.api.users.noEmailProvided&#x27;)));
        }

        return dataProvider.User.getByEmail(
            newUser.email
        ).then(function (foundUser) {
            if (!foundUser) {
                return dataProvider.User.add(newUser, options);
            } else {
                // only invitations for already invited users are resent
                if (foundUser.get(&#x27;status&#x27;) === &#x27;invited&#x27; || foundUser.get(&#x27;status&#x27;) === &#x27;invited-pending&#x27;) {
                    return foundUser;
                } else {
                    return Promise.reject(new errors.BadRequestError(i18n.t(&#x27;errors.api.users.userAlreadyRegistered&#x27;)));
                }
            }
        }).then(function (invitedUser) {
            user = invitedUser.toJSON(options);
            return sendInviteEmail(user);
        }).then(function () {
            // If status was invited-pending and sending the invitation succeeded, set status to invited.
            if (user.status === &#x27;invited-pending&#x27;) {
                return dataProvider.User.edit(
                    {status: &#x27;invited&#x27;}, _.extend({}, options, {id: user.id})
                ).then(function (editedUser) {
                        user = editedUser.toJSON(options);
                    });
            }
        }).then(function () {
            return Promise.resolve({users: [user]});
        }).catch(function (error) {
            if (error &#x26;&#x26; error.errorType === &#x27;EmailError&#x27;) {
                error.message = i18n.t(&#x27;errors.api.users.errorSendingEmail.error&#x27;, {message: error.message}) + &#x27; &#x27; +
                    i18n.t(&#x27;errors.api.users.errorSendingEmail.help&#x27;);
                errors.logWarn(error.message);

                // If sending the invitation failed, set status to invited-pending
                return dataProvider.User.edit({status: &#x27;invited-pending&#x27;}, {id: user.id}).then(function (user) {
                    return dataProvider.User.findOne({id: user.id, status: &#x27;all&#x27;}, options).then(function (user) {
                        return {users: [user]};
                    });
                });
            }
            return Promise.reject(error);
        });
    }

    // Push all of our tasks into a `tasks` array in the correct order
    tas ...</pre></li>
    <li>example usage<pre class="apidocCodePre">...
getSeenNotifications = api.settings.read(_.extend({key: &#x27;seenNotifications&#x27;}, internal));

return Promise.join(getAllNotifications, getSeenNotifications, function joined(all, seen) {
    var isSeen      = _.includes(JSON.parse(seen.settings[0].value || []), notification.uuid),
        isDuplicate = _.some(all.notifications, {message: notification.message});

    if (!isSeen &#x26;&#x26; !isDuplicate) {
        return api.notifications.<span class="apidocCodeKeywordSpan">add</span>({notifications: [notification]}, {context: {internal
: true}});
    }
});
}

function updateCheckData() {
var data = {},
    mailConfig = config.mail;
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ghost.users.browse" id="apidoc.element.ghost.users.browse">
        function <span class="apidocSignatureSpan">ghost.users.</span>browse
        <span class="apidocSignatureSpan">(options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function browse(options) {
    var extraOptions = [&#x27;status&#x27;],
        permittedOptions = utils.browseDefaultOptions.concat(extraOptions),
        tasks;

<span class="apidocCodeCommentSpan">    /**
     * ### Model Query
     * Make the call to the Model layer
     * @param {Object} options
     * @returns {Object} options
     */
</span>    function doQuery(options) {
        return dataProvider.User.findPage(options);
    }

    // Push all of our tasks into a `tasks` array in the correct order
    tasks = [
        utils.validate(docName, {opts: permittedOptions}),
        utils.handlePublicPermissions(docName, &#x27;browse&#x27;),
        utils.convertOptions(allowedIncludes),
        doQuery
    ];

    // Pipeline calls each task passing the result of one to be the arguments for the next
    return pipeline(tasks, options);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
status: &#x27;alert&#x27;,
type: &#x27;info&#x27;,
custom: true,
uuid: message.id,
dismissible: true,
message: message.content
    },
    getAllNotifications = api.notifications.<span class="apidocCodeKeywordSpan">browse</span>({context: {internal: true}}),
    getSeenNotifications = api.settings.read(_.extend({key: &#x27;seenNotifications&#x27;}, internal));

    return Promise.join(getAllNotifications, getSeenNotifications, function joined(all, seen) {
var isSeen      = _.includes(JSON.parse(seen.settings[0].value || []), notification.uuid),
    isDuplicate = _.some(all.notifications, {message: notification.message});

if (!isSeen &#x26;&#x26; !isDuplicate) {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ghost.users.changePassword" id="apidoc.element.ghost.users.changePassword">
        function <span class="apidocSignatureSpan">ghost.users.</span>changePassword
        <span class="apidocSignatureSpan">(object, options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function changePassword(object, options) {
    var tasks;

<span class="apidocCodeCommentSpan">    /**
     * ### Handle Permissions
     * We need to be an authorised user to perform this action
     * @param {Object} options
     * @returns {Object} options
     */
</span>    function handlePermissions(options) {
        return canThis(options.context).edit.user(options.data.password[0].user_id).then(function permissionGranted() {
            return options;
        }).catch(function (error) {
            return errors.formatAndRejectAPIError(error, i18n.t(&#x27;errors.api.users.noPermissionToChangeUsersPwd&#x27;));
        });
    }

    /**
     * ### Model Query
     * Make the call to the Model layer
     * @param {Object} options
     * @returns {Object} options
     */
    function doQuery(options) {
        return dataProvider.User.changePassword(
            options.data.password[0],
            _.omit(options, [&#x27;data&#x27;])
        );
    }

    // Push all of our tasks into a `tasks` array in the correct order
    tasks = [
        utils.validate(&#x27;password&#x27;),
        handlePermissions,
        utils.convertOptions(allowedIncludes),
        doQuery
    ];

    // Pipeline calls each task passing the result of one to be the arguments for the next
    return pipeline(tasks, object, options).then(function formatResponse() {
        return Promise.resolve({password: [{message: i18n.t(&#x27;notices.api.users.pwdChangedSuccessfully&#x27;)}]});
    });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
/**
 * ### Model Query
 * Make the call to the Model layer
 * @param {Object} options
 * @returns {Object} options
 */
function doQuery(options) {
    return dataProvider.User.<span class="apidocCodeKeywordSpan">changePassword</span>(
        options.data.password[0],
        _.omit(options, [&#x27;data&#x27;])
    );
}

// Push all of our tasks into a `tasks` array in the correct order
tasks = [
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ghost.users.destroy" id="apidoc.element.ghost.users.destroy">
        function <span class="apidocSignatureSpan">ghost.users.</span>destroy
        <span class="apidocSignatureSpan">(options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function destroy(options) {
    var tasks;

<span class="apidocCodeCommentSpan">    /**
     * ### Handle Permissions
     * We need to be an authorised user to perform this action
     * @param {Object} options
     * @returns {Object} options
     */
</span>    function handlePermissions(options) {
        return canThis(options.context).destroy.user(options.id).then(function permissionGranted() {
            options.status = &#x27;all&#x27;;
            return options;
        }).catch(function handleError(error) {
            return errors.formatAndRejectAPIError(error, i18n.t(&#x27;errors.api.users.noPermissionToDestroyUser&#x27;));
        });
    }

    /**
     * ### Delete User
     * Make the call to the Model layer
     * @param {Object} options
     */
    function deleteUser(options) {
        return dataProvider.Base.transaction(function (t) {
            options.transacting = t;

            return Promise.all([
                dataProvider.Accesstoken.destroyByUser(options),
                dataProvider.Refreshtoken.destroyByUser(options),
                dataProvider.Post.destroyByAuthor(options)
            ]).then(function () {
                return dataProvider.User.destroy(options);
            }).return(null);
        }).catch(function (error) {
            return errors.formatAndRejectAPIError(error);
        });
    }

    // Push all of our tasks into a `tasks` array in the correct order
    tasks = [
        utils.validate(docName, {opts: utils.idDefaultOptions}),
        handlePermissions,
        utils.convertOptions(allowedIncludes),
        deleteUser
    ];

    // Pipeline calls each task passing the result of one to be the arguments for the next
    return pipeline(tasks, options);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
GhostServer.prototype.closeConnections = function () {
   var self = this;

   Object.keys(self.connections).forEach(function (socketId) {
       var socket = self.connections[socketId];

       if (socket) {
           socket.<span class="apidocCodeKeywordSpan">destroy</span>();
       }
   });
};

/**
* ### Log Start Messages
*/
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ghost.users.edit" id="apidoc.element.ghost.users.edit">
        function <span class="apidocSignatureSpan">ghost.users.</span>edit
        <span class="apidocSignatureSpan">(object, options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function edit(object, options) {
    var extraOptions = [&#x27;editRoles&#x27;],
        permittedOptions = extraOptions.concat(utils.idDefaultOptions),
        tasks;

    if (object.users &#x26;&#x26; object.users[0] &#x26;&#x26; object.users[0].roles &#x26;&#x26; object.users[0].roles[0]) {
        options.editRoles = true;
    }

    // The password should never be set via this endpoint, if it is passed, ignore it
    if (object.users &#x26;&#x26; object.users[0] &#x26;&#x26; object.users[0].password) {
        delete object.users[0].password;
    }

<span class="apidocCodeCommentSpan">    /**
     * ### Handle Permissions
     * We need to be an authorised user to perform this action
     * Edit user allows the related role object to be updated as well, with some rules:
     * - No change permitted to the role of the owner
     * - no change permitted to the role of the context user (user making the request)
     * @param {Object} options
     * @returns {Object} options
     */
</span>    function handlePermissions(options) {
        if (options.id === &#x27;me&#x27; &#x26;&#x26; options.context &#x26;&#x26; options.context.user) {
            options.id = options.context.user;
        }

        return canThis(options.context).edit.user(options.id).then(function () {
            // if roles aren&#x27;t in the payload, proceed with the edit
            if (!(options.data.users[0].roles &#x26;&#x26; options.data.users[0].roles[0])) {
                return options;
            }

            // @TODO move role permissions out of here
            var role = options.data.users[0].roles[0],
                roleId = parseInt(role.id || role, 10),
                editedUserId = parseInt(options.id, 10);

            return dataProvider.User.findOne(
                {id: options.context.user, status: &#x27;all&#x27;}, {include: [&#x27;roles&#x27;]}
            ).then(function (contextUser) {
                var contextRoleId = contextUser.related(&#x27;roles&#x27;).toJSON(options)[0].id;

                if (roleId !== contextRoleId &#x26;&#x26; editedUserId === contextUser.id) {
                    return Promise.reject(new errors.NoPermissionError(i18n.t(&#x27;errors.api.users.cannotChangeOwnRole&#x27;)));
                }

                return dataProvider.User.findOne({role: &#x27;Owner&#x27;}).then(function (owner) {
                    if (contextUser.id !== owner.id) {
                        if (editedUserId === owner.id) {
                            if (owner.related(&#x27;roles&#x27;).at(0).id !== roleId) {
                                return Promise.reject(new errors.NoPermissionError(i18n.t(&#x27;errors.api.users.cannotChangeOwnersRole
&#x27;)));
                            }
                        } else if (roleId !== contextRoleId) {
                            return canThis(options.context).assign.role(role).then(function () {
                                return options;
                            });
                        }
                    }

                    return options;
                });
            });
        }).catch(function handleError(error) {
            return errors.formatAndRejectAPIError(error, i18n.t(&#x27;errors.api.users.noPermissionToEditUser&#x27;));
        });
    }

    /**
     * ### Model Query
     * Make the call to the Model layer
     * @param {Object} options
     * @returns {Object} options
     */
    function doQuery(options) {
        return dataProvider.User.edit(options.data.users[0], _.omit(options, [&#x27;data&#x27;]));
    }

    // Push all of our tasks into a `tasks` array in the correct order
    tasks = [
        utils.validate(docName, {opts: permittedOptions}),
        handlePermissions,
        utils.convertOptions(allowedIncludes),
        doQuery
    ];

    return pipeline(tasks, object, options).then(function formatResponse(result) {
        if (result) {
            return {users: [result.toJSON(options)]};
        }

        return Promise.reject(new errors.NotFoundError(i18n.t(&#x27;errors.api.users.userNotFound&#x27;)));
    });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
var hash = response.settings[0].value,
    initHash;

dbHash = hash;

if (dbHash === null) {
    initHash = uuid.v4();
    return api.settings.<span class="apidocCodeKeywordSpan">edit</span>({settings: [{key: &#x27;dbHash&#x27;, value: initHash}]}, {
context: {internal: true}})
        .then(function (response) {
            dbHash = response.settings[0].value;
            return dbHash;
            // Use `then` here to do &#x27;first run&#x27; actions
        });
}
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ghost.users.read" id="apidoc.element.ghost.users.read">
        function <span class="apidocSignatureSpan">ghost.users.</span>read
        <span class="apidocSignatureSpan">(options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function read(options) {
    var attrs = [&#x27;id&#x27;, &#x27;slug&#x27;, &#x27;status&#x27;, &#x27;email&#x27;, &#x27;role&#x27;],
        tasks;

    // Special handling for id = &#x27;me&#x27;
    if (options.id === &#x27;me&#x27; &#x26;&#x26; options.context &#x26;&#x26; options.context.user) {
        options.id = options.context.user;
    }

<span class="apidocCodeCommentSpan">    /**
     * ### Model Query
     * Make the call to the Model layer
     * @param {Object} options
     * @returns {Object} options
     */
</span>    function doQuery(options) {
        return dataProvider.User.findOne(options.data, _.omit(options, [&#x27;data&#x27;]));
    }

    // Push all of our tasks into a `tasks` array in the correct order
    tasks = [
        utils.validate(docName, {attrs: attrs}),
        utils.handlePublicPermissions(docName, &#x27;read&#x27;),
        utils.convertOptions(allowedIncludes),
        doQuery
    ];

    // Pipeline calls each task passing the result of one to be the arguments for the next
    return pipeline(tasks, options).then(function formatResponse(result) {
        if (result) {
            return {users: [result.toJSON(options)]};
        }

        return Promise.reject(new errors.NotFoundError(i18n.t(&#x27;errors.api.users.userNotFound&#x27;)));
    });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    xmlrpc = require(&#x27;./data/xml/xmlrpc&#x27;),
    slack = require(&#x27;./data/slack&#x27;),
    GhostServer = require(&#x27;./ghost-server&#x27;),
    scheduling = require(&#x27;./scheduling&#x27;),
    dbHash;

function initDbHashAndFirstRun() {
    return api.settings.<span class="apidocCodeKeywordSpan">read</span>({key: &#x27;dbHash&#x27;, context: {internal: true}}).then
(function (response) {
var hash = response.settings[0].value,
    initHash;

dbHash = hash;

if (dbHash === null) {
    initHash = uuid.v4();
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ghost.users.transferOwnership" id="apidoc.element.ghost.users.transferOwnership">
        function <span class="apidocSignatureSpan">ghost.users.</span>transferOwnership
        <span class="apidocSignatureSpan">(object, options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function transferOwnership(object, options) {
    var tasks;

<span class="apidocCodeCommentSpan">    /**
     * ### Handle Permissions
     * We need to be an authorised user to perform this action
     * @param {Object} options
     * @returns {Object} options
     */
</span>    function handlePermissions(options) {
        return dataProvider.Role.findOne({name: &#x27;Owner&#x27;}).then(function (ownerRole) {
            return canThis(options.context).assign.role(ownerRole);
        }).then(function () {
            return options;
        }).catch(function (error) {
            return errors.formatAndRejectAPIError(error);
        });
    }

    /**
     * ### Model Query
     * Make the call to the Model layer
     * @param {Object} options
     * @returns {Object} options
     */
    function doQuery(options) {
        return dataProvider.User.transferOwnership(options.data.owner[0], _.omit(options, [&#x27;data&#x27;]));
    }

    // Push all of our tasks into a `tasks` array in the correct order
    tasks = [
        utils.validate(&#x27;owner&#x27;),
        handlePermissions,
        utils.convertOptions(allowedIncludes),
        doQuery
    ];

    // Pipeline calls each task passing the result of one to be the arguments for the next
    return pipeline(tasks, object, options).then(function formatResult(result) {
        return Promise.resolve({users: result});
    }).catch(function (error) {
        return errors.formatAndRejectAPIError(error);
    });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
/**
 * ### Model Query
 * Make the call to the Model layer
 * @param {Object} options
 * @returns {Object} options
 */
function doQuery(options) {
    return dataProvider.User.<span class="apidocCodeKeywordSpan">transferOwnership</span>(options.data.owner[0], _.omit(options, [&#
x27;data&#x27;]));
}

// Push all of our tasks into a `tasks` array in the correct order
tasks = [
    utils.validate(&#x27;owner&#x27;),
    handlePermissions,
    utils.convertOptions(allowedIncludes),
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.ghost.utils" id="apidoc.module.ghost.utils">module ghost.utils</a></h1>


    <h2>
        <a href="#apidoc.element.ghost.utils.applyPublicPermissions" id="apidoc.element.ghost.utils.applyPublicPermissions">
        function <span class="apidocSignatureSpan">ghost.utils.</span>applyPublicPermissions
        <span class="apidocSignatureSpan">(docName, method, options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function applyPublicPermissions(docName, method, options) {
    return permissions.applyPublicRules(docName, method, options);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
         * @param {Object} options
         * @returns {Object} options
         */
        return function doHandlePublicPermissions(options) {
var permsPromise;

if (utils.detectPublicContext(options)) {
    permsPromise = utils.<span class="apidocCodeKeywordSpan">applyPublicPermissions</span>(docName, method, options);
} else {
    permsPromise = permissions.canThis(options.context)[method][singular](options.data);
}

return permsPromise.then(function permissionGranted() {
    return options;
}).catch(function handleError(error) {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ghost.utils.checkFileExists" id="apidoc.element.ghost.utils.checkFileExists">
        function <span class="apidocSignatureSpan">ghost.utils.</span>checkFileExists
        <span class="apidocSignatureSpan">(fileData)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">checkFileExists = function (fileData) {
    return !!(fileData.mimetype &#x26;&#x26; fileData.path);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ghost.utils.checkFileIsValid" id="apidoc.element.ghost.utils.checkFileIsValid">
        function <span class="apidocSignatureSpan">ghost.utils.</span>checkFileIsValid
        <span class="apidocSignatureSpan">(fileData, types, extensions)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">checkFileIsValid = function (fileData, types, extensions) {
    var type = fileData.mimetype,
        ext = path.extname(fileData.name).toLowerCase();

    if (_.includes(types, type) &#x26;&#x26; _.includes(extensions, ext)) {
        return true;
    }
    return false;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ghost.utils.checkObject" id="apidoc.element.ghost.utils.checkObject">
        function <span class="apidocSignatureSpan">ghost.utils.</span>checkObject
        <span class="apidocSignatureSpan">(object, docName, editId)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">checkObject = function (object, docName, editId) {
    if (_.isEmpty(object) || _.isEmpty(object[docName]) || _.isEmpty(object[docName][0])) {
        return errors.logAndRejectError(new errors.BadRequestError(i18n.t(&#x27;errors.api.utils.noRootKeyProvided&#x27;, {docName: docName
})));
    }

    // convert author property to author_id to match the name in the database
    if (docName === &#x27;posts&#x27;) {
        if (object.posts[0].hasOwnProperty(&#x27;author&#x27;)) {
            object.posts[0].author_id = object.posts[0].author;
            delete object.posts[0].author;
        }
    }

    // will remove unwanted null values
    _.each(object[docName], function (value, index) {
        if (!_.isObject(object[docName][index])) {
            return;
        }

        object[docName][index] = _.omitBy(object[docName][index], _.isNull);
    });

    if (editId &#x26;&#x26; object[docName][0].id &#x26;&#x26; parseInt(editId, 10) !== parseInt(object[docName][0].id, 10)) {
        return errors.logAndRejectError(new errors.BadRequestError(i18n.t(&#x27;errors.api.utils.invalidIdProvided&#x27;)));
    }

    return Promise.resolve(object);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    };
}

function setupTasks(setupData) {
    var tasks;

    function validateData(setupData) {
        return utils.<span class="apidocCodeKeywordSpan">checkObject</span>(setupData, &#x27;setup&#x27;).then(function then(checked
) {
var data = checked.setup[0];

return {
    name: data.name,
    email: data.email,
    password: data.password,
    blogTitle: data.blogTitle,
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ghost.utils.convertOptions" id="apidoc.element.ghost.utils.convertOptions">
        function <span class="apidocSignatureSpan">ghost.utils.</span>convertOptions
        <span class="apidocSignatureSpan">(allowedIncludes)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function convertOptions(allowedIncludes) {
<span class="apidocCodeCommentSpan">    /**
     * Convert our options from API-style to Model-style
     * @param {Object} options
     * @returns {Object} options
     */
</span>    return function doConversion(options) {
        if (options.include) {
            options.include = utils.prepareInclude(options.include, allowedIncludes);
        }
        if (options.fields) {
            options.columns = utils.prepareFields(options.fields);
            delete options.fields;
        }

        return options;
    };
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
        return dataProvider.Post.findPage(options);
    }

    // Push all of our tasks into a `tasks` array in the correct order
    tasks = [
        utils.validate(docName, {opts: permittedOptions}),
        utils.handlePublicPermissions(docName, &#x27;browse&#x27;),
        utils.<span class="apidocCodeKeywordSpan">convertOptions</span>(allowedIncludes),
        modelQuery
    ];

    // Pipeline calls each task passing the result of one to be the arguments for the next
    return pipeline(tasks, options);
},
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ghost.utils.detectPublicContext" id="apidoc.element.ghost.utils.detectPublicContext">
        function <span class="apidocSignatureSpan">ghost.utils.</span>detectPublicContext
        <span class="apidocSignatureSpan">(options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function detectPublicContext(options) {
    options.context = permissions.parseContext(options.context);
    return options.context.public;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
         * Check if this is a public request, if so use the public permissions, otherwise use standard canThis
         * @param {Object} options
         * @returns {Object} options
         */
        return function doHandlePublicPermissions(options) {
var permsPromise;

if (utils.<span class="apidocCodeKeywordSpan">detectPublicContext</span>(options)) {
    permsPromise = utils.applyPublicPermissions(docName, method, options);
} else {
    permsPromise = permissions.canThis(options.context)[method][singular](options.data);
}

return permsPromise.then(function permissionGranted() {
    return options;
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ghost.utils.handlePermissions" id="apidoc.element.ghost.utils.handlePermissions">
        function <span class="apidocSignatureSpan">ghost.utils.</span>handlePermissions
        <span class="apidocSignatureSpan">(docName, method)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function handlePermissions(docName, method) {
    var singular = docName.replace(/s$/, &#x27;&#x27;);

<span class="apidocCodeCommentSpan">    /**
     * ### Handle Permissions
     * We need to be an authorised user to perform this action
     * @param {Object} options
     * @returns {Object} options
     */
</span>    return function doHandlePermissions(options) {
        var permsPromise = permissions.canThis(options.context)[method][singular](options.id);

        return permsPromise.then(function permissionGranted() {
            return options;
        }).catch(errors.NoPermissionError, function handleNoPermissionError(error) {
            // pimp error message
            error.message = i18n.t(&#x27;errors.api.utils.noPermissionToCall&#x27;, {method: method, docName: docName});
            // forward error to next catch()
            return Promise.reject(error);
        }).catch(function handleError(error) {
            return errors.formatAndRejectAPIError(error);
        });
    };
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
            return {db: [exportedData]};
        }).catch(function (error) {
            return Promise.reject(new errors.InternalServerError(error.message || error));
        });
    }

    tasks = [
        utils.<span class="apidocCodeKeywordSpan">handlePermissions</span>(docName, &#x27;exportContent&#x27;),
        exportContent
    ];

    return pipeline(tasks, options);
},
/**
 * ### Import Content
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ghost.utils.handlePublicPermissions" id="apidoc.element.ghost.utils.handlePublicPermissions">
        function <span class="apidocSignatureSpan">ghost.utils.</span>handlePublicPermissions
        <span class="apidocSignatureSpan">(docName, method)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function handlePublicPermissions(docName, method) {
    var singular = docName.replace(/s$/, &#x27;&#x27;);

<span class="apidocCodeCommentSpan">    /**
     * Check if this is a public request, if so use the public permissions, otherwise use standard canThis
     * @param {Object} options
     * @returns {Object} options
     */
</span>    return function doHandlePublicPermissions(options) {
        var permsPromise;

        if (utils.detectPublicContext(options)) {
            permsPromise = utils.applyPublicPermissions(docName, method, options);
        } else {
            permsPromise = permissions.canThis(options.context)[method][singular](options.data);
        }

        return permsPromise.then(function permissionGranted() {
            return options;
        }).catch(function handleError(error) {
            return errors.formatAndRejectAPIError(error);
        });
    };
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    return dataProvider.Client.findOne(options.data, _.omit(options, [&#x27;data&#x27;]));
}

// Push all of our tasks into a `tasks` array in the correct order
tasks = [
    utils.validate(docName, {attrs: attrs}),
    // TODO: add permissions
    // utils.<span class="apidocCodeKeywordSpan">handlePublicPermissions</span>(docName, &#x27;read&#x27;),
    doQuery
];

// Pipeline calls each task passing the result of one to be the arguments for the next
return pipeline(tasks, options).then(function formatResponse(result) {
    if (result) {
        return {clients: [result.toJSON(options)]};
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ghost.utils.prepareFields" id="apidoc.element.ghost.utils.prepareFields">
        function <span class="apidocSignatureSpan">ghost.utils.</span>prepareFields
        <span class="apidocSignatureSpan">(fields)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function prepareFields(fields) {
    return this.trimAndLowerCase(fields);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
     * @returns {Object} options
     */
    return function doConversion(options) {
        if (options.include) {
            options.include = utils.prepareInclude(options.include, allowedIncludes);
        }
        if (options.fields) {
            options.columns = utils.<span class="apidocCodeKeywordSpan">prepareFields</span>(options.fields);
            delete options.fields;
        }

        return options;
    };
},
/**
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ghost.utils.prepareInclude" id="apidoc.element.ghost.utils.prepareInclude">
        function <span class="apidocSignatureSpan">ghost.utils.</span>prepareInclude
        <span class="apidocSignatureSpan">(include, allowedIncludes)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function prepareInclude(include, allowedIncludes) {
    return _.intersection(this.trimAndLowerCase(include), allowedIncludes);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
        /**
         * Convert our options from API-style to Model-style
         * @param {Object} options
         * @returns {Object} options
         */
        return function doConversion(options) {
if (options.include) {
    options.include = utils.<span class="apidocCodeKeywordSpan">prepareInclude</span>(options.include, allowedIncludes);
}
if (options.fields) {
    options.columns = utils.prepareFields(options.fields);
    delete options.fields;
}

return options;
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ghost.utils.trimAndLowerCase" id="apidoc.element.ghost.utils.trimAndLowerCase">
        function <span class="apidocSignatureSpan">ghost.utils.</span>trimAndLowerCase
        <span class="apidocSignatureSpan">(params)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function trimAndLowerCase(params) {
    params = params || &#x27;&#x27;;
    if (_.isString(params)) {
        params = params.split(&#x27;,&#x27;);
    }

    return _.map(params, function (item) {
        return item.trim().toLowerCase();
    });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

    return _.map(params, function (item) {
        return item.trim().toLowerCase();
    });
},

prepareInclude: function prepareInclude(include, allowedIncludes) {
    return _.intersection(this.<span class="apidocCodeKeywordSpan">trimAndLowerCase</span>(include), allowedIncludes);
},

prepareFields: function prepareFields(fields) {
    return this.trimAndLowerCase(fields);
},

/**
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ghost.utils.validate" id="apidoc.element.ghost.utils.validate">
        function <span class="apidocSignatureSpan">ghost.utils.</span>validate
        <span class="apidocSignatureSpan">(docName, extras)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function validate(docName, extras) {
<span class="apidocCodeCommentSpan">    /**
     * ### Do Validate
     * Validate the object and options passed to an endpoint
     * @argument {...*} [arguments] object or object and options hash
     */
</span>    return function doValidate() {
        var object, options, permittedOptions;

        if (arguments.length === 2) {
            object = arguments[0];
            options = _.clone(arguments[1]) || {};
        } else if (arguments.length === 1) {
            options = _.clone(arguments[0]) || {};
        } else {
            options = {};
        }

        // Setup permitted options, starting with the global defaults
        permittedOptions = utils.globalDefaultOptions;

        // Add extra permitted options if any are passed in
        if (extras &#x26;&#x26; extras.opts) {
            permittedOptions = permittedOptions.concat(extras.opts);
        }

        // This request will have a data key added during validation
        if ((extras &#x26;&#x26; extras.attrs) || object) {
            permittedOptions = permittedOptions.concat(utils.dataDefaultOptions);
        }

        // If an &#x27;attrs&#x27; object is passed, we use this to pick from options and convert them to data
        if (extras &#x26;&#x26; extras.attrs) {
            options.data = _.pick(options, extras.attrs);
            options = _.omit(options, extras.attrs);
        }

        /**
         * ### Check Options
         * Ensure that the options provided match exactly with what is permitted
         * - incorrect option keys are sanitized
         * - incorrect option values are validated
         * @param {object} options
         * @returns {Promise&#x3c;options&#x3e;}
         */
        function checkOptions(options) {
            // @TODO: should we throw an error if there are incorrect options provided?
            options = _.pick(options, permittedOptions);

            var validationErrors = utils.validateOptions(options);

            if (_.isEmpty(validationErrors)) {
                return Promise.resolve(options);
            }

            // For now, we can only handle showing the first validation error
            return errors.logAndRejectError(validationErrors[0]);
        }

        // If we got an object, check that too
        if (object) {
            return utils.checkObject(object, docName, options.id).then(function (data) {
                options.data = data;

                return checkOptions(options);
            });
        }

        // Otherwise just check options and return
        return checkOptions(options);
    };
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    // only User Agent (type = `ua`) clients are available at the moment.
    options.data = _.extend(options.data, {type: &#x27;ua&#x27;});
    return dataProvider.Client.findOne(options.data, _.omit(options, [&#x27;data&#x27;]));
}

// Push all of our tasks into a `tasks` array in the correct order
tasks = [
    utils.<span class="apidocCodeKeywordSpan">validate</span>(docName, {attrs: attrs}),
    // TODO: add permissions
    // utils.handlePublicPermissions(docName, &#x27;read&#x27;),
    doQuery
];

// Pipeline calls each task passing the result of one to be the arguments for the next
return pipeline(tasks, options).then(function formatResponse(result) {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ghost.utils.validateOptions" id="apidoc.element.ghost.utils.validateOptions">
        function <span class="apidocSignatureSpan">ghost.utils.</span>validateOptions
        <span class="apidocSignatureSpan">(options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function validateOptions(options) {
    var globalValidations = {
            id: {matches: /^\d+|me$/},
            uuid: {isUUID: true},
            slug: {isSlug: true},
            page: {matches: /^\d+$/},
            limit: {matches: /^\d+|all$/},
            from: {isDate: true},
            to: {isDate: true},
            fields: {matches: /^[\w, ]+$/},
            order: {matches: /^[a-z0-9_,\. ]+$/i},
            name: {}
        },
        // these values are sanitised/validated separately
        noValidation = [&#x27;data&#x27;, &#x27;context&#x27;, &#x27;include&#x27;, &#x27;filter&#x27;, &#x27;forUpdate&#x27;, &#x27;transacting&#x27;],
        errors = [];

    _.each(options, function (value, key) {
        // data is validated elsewhere
        if (noValidation.indexOf(key) === -1) {
            if (globalValidations[key]) {
                errors = errors.concat(validation.validate(value, key, globalValidations[key]));
            } else {
                // all other keys should be alpha-numeric with dashes/underscores, like tag, author, status, etc
                errors = errors.concat(validation.validate(value, key, globalValidations.slug));
            }
        }
    });

    return errors;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
             * @param {object} options
             * @returns {Promise&#x3c;options&#x3e;}
             */
            function checkOptions(options) {
// @TODO: should we throw an error if there are incorrect options provided?
options = _.pick(options, permittedOptions);

var validationErrors = utils.<span class="apidocCodeKeywordSpan">validateOptions</span>(options);

if (_.isEmpty(validationErrors)) {
    return Promise.resolve(options);
}

// For now, we can only handle showing the first validation error
return errors.logAndRejectError(validationErrors[0]);
...</pre></li>
    </ul>










</div>

<div class="apidocFooterDiv">
    [ this document was created with
    <a href="https://github.com/kaizhu256/node-utility2" target="_blank">utility2</a>
    ]
</div>
</div>
